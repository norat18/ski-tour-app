<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Tour Decision - PNW Backcountry</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --cream: #F5F1E8;
            --burnt-orange: #D6622C;
            --forest-green: #2C5530;
            --dark-green: #1A3320;
            --steel-blue: #5B7C99;
            --warning-red: #C14236;
            --snow-white: #FDFCFA;
            --topo-gray: #8A8478;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Archivo', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #E8DCC8 100%);
            color: var(--dark-green);
            min-height: 100vh;
            padding: 2rem;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 49px, rgba(42, 85, 48, 0.03) 49px, rgba(42, 85, 48, 0.03) 50px),
                repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(42, 85, 48, 0.03) 49px, rgba(42, 85, 48, 0.03) 50px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--burnt-orange), var(--warning-red), var(--burnt-orange));
        }

        h1 {
            color: var(--snow-white);
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 0.5rem;
        }

        .location {
            color: var(--cream);
            font-family: 'Courier Prime', monospace;
            font-size: 0.95rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .setup-panel {
            background: var(--snow-white);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .setup-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--forest-green);
            margin-bottom: 1.5rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .input-sublabel {
            display: block;
            font-size: 0.8rem;
            color: var(--topo-gray);
            margin-bottom: 0.5rem;
        }

        input[type="text"], select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--cream);
            border-radius: 6px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--forest-green);
        }

        .btn {
            background: var(--forest-green);
            color: white;
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 85, 48, 0.3);
        }

        .btn:disabled {
            background: var(--topo-gray);
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--topo-gray);
            font-size: 1.1rem;
        }

        .spinner {
            border: 4px solid var(--cream);
            border-top: 4px solid var(--forest-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #FFE5E5;
            color: var(--warning-red);
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid var(--warning-red);
            margin-bottom: 1rem;
        }

        .date-banner {
            background: var(--burnt-orange);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(214, 98, 44, 0.3);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--snow-white);
            border-radius: 10px;
            padding: 1.75rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 2px solid rgba(44, 85, 48, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--cream);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--forest-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .danger-level {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .danger-low {
            background: #90EE90;
            color: #006400;
        }

        .danger-moderate {
            background: #FFB84D;
            color: #664400;
        }

        .danger-considerable {
            background: var(--burnt-orange);
            color: white;
        }

        .danger-high {
            background: var(--warning-red);
            color: white;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .weather-item {
            background: var(--cream);
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
        }

        .weather-label {
            font-size: 0.8rem;
            color: var(--topo-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .weather-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--forest-green);
            font-family: 'Courier Prime', monospace;
        }

        .fitness-slider {
            margin-top: 1.5rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--topo-gray);
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, var(--warning-red) 0%, #FFB84D 50%, var(--forest-green) 100%);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--dark-green);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--dark-green);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .fitness-status {
            text-align: center;
            margin-top: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--forest-green);
        }

        .tours-section {
            margin-top: 2rem;
        }

        .tour-card {
            background: var(--snow-white);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border-left: 6px solid var(--forest-green);
            transition: all 0.3s ease;
        }

        .tour-card:hover {
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .tour-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .tour-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--forest-green);
            margin-bottom: 0.5rem;
        }

        .tour-stats {
            font-family: 'Courier Prime', monospace;
            color: var(--topo-gray);
            font-size: 0.9rem;
        }

        .recommendation {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.95rem;
            min-width: 140px;
            text-align: center;
        }

        .rec-go {
            background: var(--forest-green);
            color: white;
        }

        .rec-maybe {
            background: #FFB84D;
            color: #664400;
        }

        .rec-no {
            background: var(--warning-red);
            color: white;
        }

        .tour-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
            background: var(--cream);
            border-radius: 8px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .detail-icon {
            font-size: 1.5rem;
        }

        .detail-text {
            font-size: 0.9rem;
        }

        .detail-label {
            color: var(--topo-gray);
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-weight: 600;
            color: var(--dark-green);
        }

        .footer {
            margin-top: 3rem;
            text-align: center;
            color: var(--topo-gray);
            font-size: 0.85rem;
            padding: 2rem;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
        }

        .footer a {
            color: var(--forest-green);
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Tour Log Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--forest-green);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0.5rem;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-green);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--forest-green);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 0.25rem;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        
        .star-rating input {
            display: none;
        }
        
        .star-rating label {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #FFD700;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--forest-green);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--dark-green);
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #ccc;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
        
        /* My Tours Section */
        .my-tours-toggle {
            background: var(--cream);
            border: 2px solid var(--forest-green);
            color: var(--forest-green);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .my-tours-toggle:hover {
            background: var(--forest-green);
            color: white;
        }
        
        .logged-tour-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--burnt-orange);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .logged-tour-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .logged-tour-name {
            font-weight: 700;
            color: var(--forest-green);
        }
        
        .logged-tour-date {
            font-size: 0.8rem;
            color: var(--topo-gray);
        }
        
        .logged-tour-stars {
            color: #FFD700;
            font-size: 1.1rem;
        }
        
        .logged-tour-notes {
            font-size: 0.9rem;
            color: #555;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .log-tour-btn {
            background: var(--burnt-orange);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }
        
        .log-tour-btn:hover {
            background: #c45a00;
            transform: translateY(-1px);
        }
        
        .log-tour-btn.logged {
            background: var(--forest-green);
        }
        
        /* Auth UI Styles */
        .auth-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .auth-user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .auth-user-details {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .auth-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--forest-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .auth-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .auth-name {
            font-weight: 600;
            color: var(--forest-green);
        }
        
        .auth-email {
            font-size: 0.8rem;
            color: var(--topo-gray);
        }
        
        .auth-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .btn-google {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-google:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }
        
        .btn-google img {
            width: 18px;
            height: 18px;
        }
        
        .auth-divider {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            color: var(--topo-gray);
            font-size: 0.85rem;
        }
        
        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #ddd;
        }
        
        .auth-divider span {
            padding: 0 1rem;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .auth-form input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .auth-form input:focus {
            outline: none;
            border-color: var(--forest-green);
        }
        
        .auth-form-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: var(--topo-gray);
        }
        
        .auth-toggle a {
            color: var(--forest-green);
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        .auth-error {
            background: #ffebee;
            color: #c62828;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }
        
        .sync-status {
            font-size: 0.75rem;
            color: var(--topo-gray);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .sync-status.synced {
            color: var(--forest-green);
        }

        #setupPanel {
            display: block;
        }

        /* #appContent is always visible - children control their own display */

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .weather-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tour-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .recommendation {
                width: 100%;
            }
        }

        .zone-selector-header {
            margin-top: 1rem;
        }

        .zone-selector-header select {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: 2px solid var(--forest-green);
            border-radius: 8px;
            background: white;
            color: var(--forest-green);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .zone-selector-header select:hover {
            background: var(--cream);
        }

        .zone-selector-header select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(45, 80, 45, 0.2);
        }

        .welcome-message {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin: 2rem 0;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .welcome-message h2 {
            color: var(--forest-green);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .welcome-message p {
            color: var(--topo-gray);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .welcome-message ul {
            list-style: none;
            padding: 0;
        }

        .welcome-message li {
            padding: 0.5rem 0;
            color: var(--topo-gray);
        }

        .welcome-message li::before {
            content: "‚úì ";
            color: var(--forest-green);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Safety Disclaimer Banner -->
    <div style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: white; padding: 0.75rem 1rem; text-align: center; font-weight: 600; font-size: 0.95rem; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
        ‚ö†Ô∏è DECISION SUPPORT TOOL ONLY ‚Äî Always make your own informed choices in the backcountry. Check official forecasts before every tour.
    </div>
    
    <div class="container">
        <header>
            <h1>‚õ∑Ô∏è Ski Tour Decision Dashboard</h1>
            <div class="zone-selector-header" style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; align-items: center;">
                <select id="nwacZone" onchange="onZoneChange()" style="flex: 1; min-width: 200px;">
                    <option value="">Choose your zone...</option>
                    <optgroup label="Washington Cascades - West">
                        <option value="west-slopes-north">West Slopes North (Mt Baker)</option>
                        <option value="stevens-pass">Stevens Pass</option>
                        <option value="west-slopes-central">West Slopes Central</option>
                        <option value="snoqualmie-pass">Snoqualmie Pass</option>
                        <option value="west-slopes-south">West Slopes South (White Pass)</option>
                    </optgroup>
                    <optgroup label="Washington Cascades - East">
                        <option value="east-slopes-north">East Slopes North</option>
                        <option value="east-slopes-central">East Slopes Central (Mission Ridge)</option>
                        <option value="east-slopes-south">East Slopes South</option>
                    </optgroup>
                    <optgroup label="Other Areas">
                        <option value="olympics">Olympics</option>
                        <option value="mt-hood">Mt Hood</option>
                    </optgroup>
                </select>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label for="tourDate" style="font-size: 0.9rem; color: white; font-weight: 600;">üìÖ Tour Date:</label>
                    <input type="date" id="tourDate" onchange="onDateChange()" 
                           style="padding: 0.7rem 1rem; font-size: 1rem; font-weight: 600; border: 2px solid var(--forest-green); 
                                  border-radius: 8px; background: white; color: var(--forest-green); cursor: pointer;">
                </div>
            </div>
        </header>

        <!-- Main App Content -->
        <div id="appContent">
            <!-- Welcome message shown before zone selection -->
            <div id="welcomeMessage" class="welcome-message" style="max-width: 750px; padding: 2rem;">
                <div class="welcome-icon" style="font-size: 4rem; margin-bottom: 1rem;">üèîÔ∏è</div>
                <h2 style="font-size: 1.8rem; margin-bottom: 0.75rem;">Welcome to PNW Ski Tours</h2>
                <p style="font-size: 1.15rem; margin-bottom: 2rem; color: #555;">Your backcountry ski tour planning companion for the Pacific Northwest</p>
                
                <div style="background: white; border-radius: 16px; padding: 2rem; text-align: left; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--forest-green); margin-bottom: 1.25rem; font-size: 1.2rem;">üéØ What This App Does</h3>
                    <p style="margin-bottom: 1.5rem; line-height: 1.7; font-size: 1rem;">
                        This app helps you find the right ski tour for today's conditions. It combines <strong>real-time avalanche forecasts</strong>, 
                        <strong>current weather</strong>, and <strong>snow data</strong> with your personal fitness and skill level to recommend 
                        tours that match both the conditions and your abilities.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.25rem;">
                        <div style="background: var(--cream); padding: 1.25rem; border-radius: 12px;">
                            <strong style="color: var(--forest-green); font-size: 1.05rem;">üèîÔ∏è 200+ Tours</strong>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">Across 10 NWAC zones from Mt. Baker to Mt. Hood</p>
                        </div>
                        <div style="background: var(--cream); padding: 1.25rem; border-radius: 12px;">
                            <strong style="color: var(--forest-green); font-size: 1.05rem;">üìä Live Data</strong>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">Real-time avalanche, weather, and snow conditions</p>
                        </div>
                        <div style="background: var(--cream); padding: 1.25rem; border-radius: 12px;">
                            <strong style="color: var(--forest-green); font-size: 1.05rem;">üéø Smart Matching</strong>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">Tours ranked by fit for you and today's conditions</p>
                        </div>
                        <div style="background: var(--cream); padding: 1.25rem; border-radius: 12px;">
                            <strong style="color: var(--forest-green); font-size: 1.05rem;">üìù Tour Logging</strong>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">Track your tours using AIARE debrief framework</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="openWalkthrough()" class="btn btn-secondary" style="margin-bottom: 2rem; padding: 0.75rem 1.5rem; font-size: 1rem;">
                    üìñ How to Use This App
                </button>
                
                <div style="background: #e8f5e9; border-radius: 16px; padding: 1.5rem; text-align: center;">
                    <p style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem; font-size: 1.1rem;">üëÜ Get Started</p>
                    <p style="font-size: 1rem;">Select your zone from the dropdown above to see today's tour recommendations</p>
                </div>
            </div>
            
            <!-- Walkthrough Modal -->
            <div id="walkthroughModal" class="modal-overlay">
                <div class="modal-content" style="max-width: 650px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h3>üìñ How to Use PNW Ski Tours</h3>
                        <button class="modal-close" onclick="closeWalkthrough()">&times;</button>
                    </div>
                    <div class="modal-body" style="text-align: left;">
                        <!-- Step 1 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">1</span>
                                <h4 style="color: var(--forest-green);">Select Your Zone</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                Choose the NWAC avalanche zone where you want to tour. The app covers all 10 zones from Mt. Baker to Mt. Hood. 
                                This determines which tours and forecasts you'll see.
                            </p>
                        </div>
                        
                        <!-- Step 2 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">2</span>
                                <h4 style="color: var(--forest-green);">Review Conditions</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                Check the <strong>Avalanche Forecast</strong> (from NWAC), <strong>Weather</strong> (from NWS), and 
                                <strong>Snow Report</strong> (from Synoptic weather stations). These update automatically for your selected zone and date.
                            </p>
                        </div>
                        
                        <!-- Step 3 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">3</span>
                                <h4 style="color: var(--forest-green);">Set Your Profile</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                Use the sliders to tell the app about yourself: <strong>Energy Level</strong> (how much vert you want today), 
                                <strong>Downhill Skiing</strong> (ability to ski steep/variable terrain), and <strong>Touring Skill</strong> 
                                (skinning, route-finding, avalanche awareness). This helps match you with appropriate tours.
                            </p>
                        </div>
                        
                        <!-- Step 4 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">4</span>
                                <h4 style="color: var(--forest-green);">Browse Tour Recommendations</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                Tours are sorted by how well they match you and today's conditions. Each card shows:
                            </p>
                            <ul style="margin-left: 2.5rem; font-size: 0.85rem; color: #555; margin-top: 0.5rem;">
                                <li><strong>Match score</strong> - How well the tour fits today</li>
                                <li><strong>Distance & elevation</strong> - Tour statistics</li>
                                <li><strong>Difficulty ratings</strong> - Fitness and skill required</li>
                                <li><strong>Aspect & elevation</strong> - Terrain characteristics</li>
                                <li><strong>Bonuses/warnings</strong> - Highlights and cautions</li>
                            </ul>
                        </div>
                        
                        <!-- Step 5 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">5</span>
                                <h4 style="color: var(--forest-green);">Plan Your Tour</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                Click <strong>üó∫Ô∏è View Map</strong> to search CalTopo for route information, or <strong>Directions üó∫Ô∏è</strong> for Google Maps driving directions to the trailhead. 
                                Use the <strong>date picker</strong> to plan up to 7 days ahead.
                            </p>
                        </div>
                        
                        <!-- Step 6 -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span style="background: var(--forest-green); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">6</span>
                                <h4 style="color: var(--forest-green);">Log Your Tours</h4>
                            </div>
                            <p style="margin-left: 2.5rem; font-size: 0.9rem; color: #555;">
                                After your tour, click <strong>üìù Log Tour</strong> to record conditions using the AIARE debrief framework. 
                                Track avalanche danger, snow conditions, signs of instability, and lessons learned. 
                                <strong>Sign in</strong> to sync your tour logs across devices.
                            </p>
                        </div>
                        
                        <!-- Safety Note -->
                        <div style="background: #fff3e0; padding: 1rem; border-radius: 8px; border-left: 4px solid #e65100;">
                            <p style="font-weight: 600; color: #e65100; margin-bottom: 0.5rem;">‚ö†Ô∏è Important Safety Note</p>
                            <p style="font-size: 0.85rem; color: #555;">
                                This app is a planning aid, not a substitute for avalanche education, proper equipment, and sound decision-making. 
                                Always check the official <a href="https://nwac.us" target="_blank" style="color: var(--forest-green);">NWAC forecast</a>, 
                                carry rescue gear, and travel with experienced partners.
                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="closeWalkthrough()">Got It!</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard content (hidden until zone selected) -->
            <div id="dashboardContent" style="display: none;">
                <!-- Auth Section -->
                <div id="authSection" class="auth-container">
                    <div id="authLoggedOut">
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <h3 style="color: var(--forest-green); margin-bottom: 0.5rem;">üîê Save Your Tours</h3>
                            <p style="font-size: 0.9rem; color: var(--topo-gray);">Sign in to sync tour logs across devices</p>
                        </div>
                        <button class="btn btn-google" onclick="signInWithGoogle()" style="width: 100%; justify-content: center;">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                            Sign in with Google
                        </button>
                        <div class="auth-divider"><span>or</span></div>
                        <div id="authError" class="auth-error" style="display: none;"></div>
                        <form id="authForm" class="auth-form" onsubmit="handleEmailAuth(event)">
                            <input type="email" id="authEmail" placeholder="Email" required>
                            <div style="position: relative;">
                                <input type="password" id="authPassword" placeholder="Password" required minlength="6">
                                <button type="button" onclick="togglePasswordVisibility('authPassword', this)" 
                                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); 
                                           background: none; border: none; cursor: pointer; font-size: 1.1rem; padding: 0.25rem;"
                                    title="Show/hide password">üëÅÔ∏è</button>
                            </div>
                            <div id="confirmPasswordGroup" style="display: none; position: relative;">
                                <input type="password" id="authConfirmPassword" placeholder="Confirm Password" minlength="6">
                                <button type="button" onclick="togglePasswordVisibility('authConfirmPassword', this)" 
                                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); 
                                           background: none; border: none; cursor: pointer; font-size: 1.1rem; padding: 0.25rem;"
                                    title="Show/hide password">üëÅÔ∏è</button>
                            </div>
                            <div class="auth-form-buttons">
                                <button type="submit" class="btn btn-primary" style="flex: 1;" id="authSubmitBtn">Sign In</button>
                            </div>
                        </form>
                        <div class="auth-toggle">
                            <span id="authToggleText">Don't have an account?</span>
                            <a onclick="toggleAuthMode()"><span id="authToggleLink">Sign Up</span></a>
                        </div>
                    </div>
                    <div id="authLoggedIn" style="display: none;">
                        <div class="auth-user-info">
                            <div class="auth-user-details">
                                <div class="auth-avatar" id="userAvatar">?</div>
                                <div>
                                    <div class="auth-name" id="userName">User</div>
                                    <div class="auth-email" id="userEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="166365736456736e777b667a733875797b">[email&#160;protected]</a></div>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                                <button class="btn btn-secondary btn-small" onclick="signOutUser()">Sign Out</button>
                                <div class="sync-status" id="syncStatus">
                                    <span>‚è≥</span> Checking sync...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="date-banner" id="dateBanner">
                    üìÖ Loading...
                </div>

                <div class="dashboard">
                    <!-- Avalanche Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üèîÔ∏è Avalanche Forecast</div>
                        </div>
                        <div id="avalancheContent">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading avalanche forecast...
                            </div>
                        </div>
                    </div>

                    <!-- Weather Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">‚õÖ Weather</div>
                        </div>
                        <div id="weatherContent">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading weather data...
                            </div>
                        </div>
                    </div>

                    <!-- Combined Fitness & Skill Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üéØ My Profile</div>
                        </div>
                        
                        <!-- Energy Section -->
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.25rem;">
                            <div style="font-size: 2rem; width: 50px; text-align: center;">üí™</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                    <span style="font-weight: 600; color: var(--forest-green); font-size: 0.9rem;">Today's Energy</span>
                                    <span id="fitnessStatus" style="font-weight: 700; color: var(--forest-green); font-size: 0.95rem;">Strong (7/10)</span>
                                </div>
                                <input type="range" id="fitnessSlider" min="1" max="10" value="7" step="1" style="margin: 0;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--topo-gray); margin-top: 0.25rem;">
                                    <span>Exhausted</span>
                                    <span>Peak Energy</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Downhill Skiing Skill Section -->
                        <div style="display: flex; align-items: center; gap: 1rem; padding-top: 1.25rem; border-top: 1px solid #eee;">
                            <div style="font-size: 2rem; width: 50px; text-align: center;">‚õ∑Ô∏è</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                    <span style="font-weight: 600; color: var(--forest-green); font-size: 0.9rem;">Downhill Skiing</span>
                                    <span id="downhillStatus" style="font-weight: 700; color: var(--forest-green); font-size: 0.95rem;">Intermediate (5/10)</span>
                                </div>
                                <input type="range" id="downhillSlider" min="1" max="10" value="5" step="1" style="margin: 0;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--topo-gray); margin-top: 0.25rem;">
                                    <span>Beginner</span>
                                    <span>Expert</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Touring Skill Section -->
                        <div style="display: flex; align-items: center; gap: 1rem; padding-top: 1.25rem; border-top: 1px solid #eee;">
                            <div style="font-size: 2rem; width: 50px; text-align: center;">üéø</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                    <span style="font-weight: 600; color: var(--forest-green); font-size: 0.9rem;">Touring Skill</span>
                                    <span id="touringStatus" style="font-weight: 700; color: var(--forest-green); font-size: 0.95rem;">Intermediate (5/10)</span>
                                </div>
                                <input type="range" id="touringSlider" min="1" max="10" value="5" step="1" style="margin: 0;">
                                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--topo-gray); margin-top: 0.25rem;">
                                    <span>Beginner</span>
                                    <span>Expert</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Skill Description -->
                        <div id="skillDescription" style="margin-top: 1rem; padding: 0.75rem; background: var(--cream); border-radius: 8px; font-size: 0.8rem; color: var(--topo-gray); line-height: 1.4;">
                            üí° Downhill: ability to ski varied terrain. Touring: skinning, route-finding, avalanche awareness.
                        </div>
                    </div>
                </div>

                <div class="tours-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="font-size: 2rem; color: var(--forest-green); margin: 0;">üìç Recommended Tours</h2>
                        <button onclick="refreshTours()" id="refreshToursBtn"
                                style="background: var(--forest-green); color: white; border: none; padding: 0.6rem 1.2rem; 
                                       border-radius: 8px; font-weight: 600; font-size: 0.85rem; cursor: pointer;
                                       display: flex; align-items: center; gap: 0.4rem; transition: all 0.2s ease;
                                       box-shadow: 0 2px 8px rgba(45, 80, 45, 0.2);">
                            üîÑ New Top 5
                        </button>
                    </div>
                    
                    <!-- My Profile Section -->
                    <div style="margin-bottom: 1rem;">
                        <button id="myProfileToggleBtn" class="my-tours-toggle" onclick="toggleMyProfile()" style="background: #e8f5e9;">
                            üë§ My Profile
                        </button>
                        <div id="myProfileSection" style="display: none; background: var(--cream); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4 style="margin: 0; color: var(--forest-green);">üë§ My Touring Profile</h4>
                                <button class="btn btn-secondary btn-small" onclick="openProfileModal()">‚úèÔ∏è Edit</button>
                            </div>
                            <div id="myProfileContent">
                                <!-- Rendered by renderMyProfile() -->
                                <p style="color: var(--topo-gray); font-size: 0.9rem;">No profile set up yet. Click Edit to create your touring profile!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- My Tours Section -->
                    <div style="margin-bottom: 1.5rem;">
                        <button id="myToursToggleBtn" class="my-tours-toggle" onclick="toggleMyTours()">
                            üìñ My Tours (0)
                        </button>
                        <div id="myToursSection" style="display: none; background: var(--cream); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 1rem 0; color: var(--forest-green);">üìñ My Tour Log</h4>
                            <div id="myToursContent">
                                <!-- Rendered by renderMyTours() -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Search Tours Section -->
                    <div style="margin-bottom: 1.5rem;">
                        <div style="background: white; border-radius: 10px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <span style="font-size: 1.25rem;">üîç</span>
                                <h4 style="margin: 0; color: var(--forest-green);">Search All Tours</h4>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <input type="text" id="tourSearchInput" placeholder="Search by tour name..." 
                                    style="flex: 1; min-width: 200px; padding: 0.6rem 1rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;"
                                    onkeyup="handleSearchKeyup(event)">
                                <select id="tourSearchZone" style="padding: 0.6rem 1rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; background: white;">
                                    <option value="all">All Zones</option>
                                    <option value="Mt Baker">Mt Baker</option>
                                    <option value="Stevens Pass">Stevens Pass</option>
                                    <option value="Snoqualmie Pass">Snoqualmie Pass</option>
                                    <option value="West Slopes North">West Slopes North</option>
                                    <option value="West Slopes Central">West Slopes Central</option>
                                    <option value="West Slopes South">West Slopes South</option>
                                    <option value="East Slopes North">East Slopes North</option>
                                    <option value="East Slopes Central">East Slopes Central</option>
                                    <option value="East Slopes South">East Slopes South</option>
                                    <option value="Mt Hood">Mt Hood</option>
                                </select>
                                <button class="btn btn-primary" onclick="searchTours()" style="padding: 0.6rem 1.25rem;">
                                    Search
                                </button>
                            </div>
                            <div id="searchResults" style="display: none; margin-top: 1rem;">
                                <!-- Search results rendered here -->
                            </div>
                        </div>
                    </div>
                    
                    <p id="toursSortMessage" style="font-size: 0.9rem; color: var(--topo-gray); margin-bottom: 1.5rem; padding: 1rem; background: var(--cream); border-radius: 6px;">
                        üí° Tours sorted by best match for your fitness. Loading...
                    </p>
                    <div id="toursContent">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading tour options...
                        </div>
                    </div>
                </div>

                <div class="footer">
                    <p style="margin-bottom: 0.75rem;">
                        <strong>Data Sources:</strong><br>
                        <a href="https://nwac.us/" target="_blank">NWAC</a> ‚Ä¢ 
                        <a href="https://avalanche.org/" target="_blank">Avalanche.org</a> ‚Ä¢ 
                        <a href="https://www.weather.gov/" target="_blank">NWS</a> ‚Ä¢ 
                        <a href="https://synopticdata.com/" target="_blank">Synoptic Data</a> ‚Ä¢ 
                        <a href="https://caltopo.com/" target="_blank">CalTopo</a>
                    </p>
                    
                    <div style="border-top: 1px solid #ddd; padding-top: 1rem; margin-top: 0.5rem;">
                        <p style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.5rem;">üí¨ Feedback</p>
                        <p style="font-size: 0.85rem; margin-bottom: 0.75rem;">
                            Have suggestions, found a bug, or want to add tours?
                        </p>
                        <a href="/cdn-cgi/l/email-protection#6f011b0e014101001d0e2f08020e0603410c0002501c1a0d050a0c1b523f21384a5d5f3c04064a5d5f3b001a1d1c4a5d5f290a0a0b0d0e0c04" style="display: inline-flex; align-items: center; gap: 0.3rem; background: var(--forest-green); 
                                  color: white; padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; 
                                  font-size: 0.85rem; font-weight: 600;">
                            ‚úâÔ∏è Contact
                        </a>
                        <p style="margin-top: 1.5rem; font-size: 0.9rem; color: #666;">
                            Created by <a href="https://www.linkedin.com/in/nora-tan/" target="_blank" style="color: var(--forest-green); text-decoration: none; font-weight: 600;">Nora Tan</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Edit Modal -->
    <div id="profileModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>üë§ Edit My Touring Profile</h3>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: left;">
                
                <!-- Basic Info -->
                <div style="background: var(--cream); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">üìã Basic Info</div>
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Name</label>
                        <input type="text" id="profileName" placeholder="Your name">
                    </div>
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Phone</label>
                        <input type="tel" id="profilePhone" placeholder="(555) 123-4567">
                    </div>
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Social Media (Instagram, etc.)</label>
                        <input type="text" id="profileSocial" placeholder="@username">
                    </div>
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Nearest City</label>
                        <input type="text" id="profileCity" placeholder="Seattle, WA">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Introduction</label>
                        <textarea id="profileIntro" rows="2" placeholder="A few words about yourself..."></textarea>
                    </div>
                </div>
                
                <!-- Experience & Background -->
                <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: #1565c0; margin-bottom: 0.75rem;">üéø Experience & Background</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Experience Overview</label>
                        <textarea id="profileExperience" rows="2" placeholder="How long have you been backcountry skiing? What's your background?"></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Skill Level</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <input type="range" id="profileSkillLevel" min="1" max="5" value="3" style="flex: 1;">
                            <span id="profileSkillLabel" style="font-weight: 600; min-width: 100px;">Intermediate</span>
                        </div>
                        <p style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">1 = Beginner, 3 = Intermediate, 5 = Expert</p>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">What kind of tours are you looking to do?</label>
                        <textarea id="profileTourTypes" rows="2" placeholder="Mellow powder days, long traverses, steep couloirs..."></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Ski Pass?</label>
                        <input type="text" id="profileSkiPass" placeholder="Ikon, Epic, Crystal, Stevens, etc.">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Medical / Avalanche Training</label>
                        <input type="text" id="profileTraining" placeholder="AIARE 1, AIARE 2, WFR, Pro 1, etc.">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Backcountry Ski / Board Preference</label>
                        <select id="profileGear">
                            <option value="">-- Select --</option>
                            <option value="ski">Skis</option>
                            <option value="splitboard">Splitboard</option>
                            <option value="snowboard">Snowboard (w/ snowshoes)</option>
                            <option value="both">Both ski and splitboard</option>
                        </select>
                    </div>
                </div>
                
                <!-- Touring Preferences -->
                <div style="background: #e8f5e9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">‚õ∞Ô∏è Touring Preferences</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Preferred Pace (uphill)</label>
                        <select id="profilePace">
                            <option value="">-- Select --</option>
                            <option value="chill">&lt;1000 ft/hr - Chill / social pace</option>
                            <option value="moderate">~1000 ft/hr - Moderate / steady</option>
                            <option value="fast">&gt;1000 ft/hr - Fast / fitness-focused</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Availability</label>
                        <select id="profileAvailability">
                            <option value="">-- Select --</option>
                            <option value="weekends">Weekends only</option>
                            <option value="weekdays">Weekdays only</option>
                            <option value="both">Both weekends & weekdays</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Favorite Areas</label>
                        <input type="text" id="profileFavoriteAreas" placeholder="Crystal, Baker, Alpental, Artist Point...">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Open to Traveling?</label>
                        <select id="profileTravel">
                            <option value="">-- Select --</option>
                            <option value="local">Prefer to stay local</option>
                            <option value="regional">Open to regional trips (2-3 hrs)</option>
                            <option value="anywhere">Down to travel anywhere!</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Can you drive to trailheads?</label>
                        <select id="profileCanDrive">
                            <option value="">-- Select --</option>
                            <option value="yes-awd">Yes - AWD/4WD vehicle</option>
                            <option value="yes-2wd">Yes - 2WD with chains</option>
                            <option value="sometimes">Sometimes / depends</option>
                            <option value="no">No - need a ride</option>
                        </select>
                    </div>
                </div>
                
                <!-- Fun Stuff -->
                <div style="background: #fff3e0; padding: 1rem; border-radius: 8px; margin-bottom: 0;">
                    <div style="font-weight: 600; color: #e65100; margin-bottom: 0.75rem;">üçï The Important Stuff</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Favorite Food Stop (post-tour)</label>
                        <input type="text" id="profileFoodStop" placeholder="Taco Time, Sultan Bakery, Freeride Pizza...">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Favorite Mountain Snack</label>
                        <input type="text" id="profileSnack" placeholder="Stroopwafels, PB&J, trail mix...">
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProfileModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfile()">üíæ Save Profile</button>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBdsvWuplxxg3DRbT-wUb4n-u4W1HU89wY",
            authDomain: "pnw-ski-tours.firebaseapp.com",
            projectId: "pnw-ski-tours",
            storageBucket: "pnw-ski-tours.firebasestorage.app",
            messagingSenderId: "127747659158",
            appId: "1:127747659158:web:b117223702d49617adf9b7"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Current user state
        let currentUser = null;
        let isAuthModeSignUp = false;
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        // Listen for auth state changes
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            updateAuthUI();
            
            if (user) {
                console.log('üë§ User signed in:', user.email);
                // Sync local data to cloud and load cloud data
                await syncTourLogs();
                await syncProfile();
            } else {
                console.log('üë§ User signed out');
            }
        });
        
        // Update the auth UI based on login state
        function updateAuthUI() {
            const loggedOutEl = document.getElementById('authLoggedOut');
            const loggedInEl = document.getElementById('authLoggedIn');
            
            if (currentUser) {
                loggedOutEl.style.display = 'none';
                loggedInEl.style.display = 'block';
                
                // Update user info
                document.getElementById('userName').textContent = currentUser.displayName || 'Ski Enthusiast';
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Avatar
                const avatarEl = document.getElementById('userAvatar');
                if (currentUser.photoURL) {
                    avatarEl.innerHTML = `<img src="${currentUser.photoURL}" alt="Avatar">`;
                } else {
                    const initial = (currentUser.displayName || currentUser.email || '?')[0].toUpperCase();
                    avatarEl.innerHTML = initial;
                }
            } else {
                loggedOutEl.style.display = 'block';
                loggedInEl.style.display = 'none';
            }
        }
        
        // Sign in with Google
        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                showToast('‚úÖ Signed in successfully!');
            } catch (error) {
                console.error('Google sign in error:', error);
                showAuthError(error.message);
            }
        }
        
        // Handle email/password auth
        async function handleEmailAuth(event) {
            event.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            
            hideAuthError();
            
            // Validate password confirmation for sign up
            if (isAuthModeSignUp) {
                if (password !== confirmPassword) {
                    showAuthError('Passwords do not match. Please try again.');
                    return;
                }
            }
            
            try {
                if (isAuthModeSignUp) {
                    // Sign up
                    await auth.createUserWithEmailAndPassword(email, password);
                    showToast('‚úÖ Account created successfully!');
                } else {
                    // Sign in
                    await auth.signInWithEmailAndPassword(email, password);
                    showToast('‚úÖ Signed in successfully!');
                }
            } catch (error) {
                console.error('Email auth error:', error);
                let message = error.message;
                if (error.code === 'auth/user-not-found') {
                    message = 'No account found with this email. Click "Sign Up" to create one.';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Incorrect password. Please try again.';
                } else if (error.code === 'auth/email-already-in-use') {
                    message = 'An account with this email already exists. Try signing in.';
                } else if (error.code === 'auth/weak-password') {
                    message = 'Password should be at least 6 characters.';
                } else if (error.code === 'auth/invalid-credential') {
                    message = 'Invalid email or password. Please try again.';
                }
                showAuthError(message);
            }
        }
        
        // Toggle between sign in and sign up
        function toggleAuthMode() {
            isAuthModeSignUp = !isAuthModeSignUp;
            
            document.getElementById('authSubmitBtn').textContent = isAuthModeSignUp ? 'Sign Up' : 'Sign In';
            document.getElementById('authToggleText').textContent = isAuthModeSignUp ? 'Already have an account?' : "Don't have an account?";
            document.getElementById('authToggleLink').textContent = isAuthModeSignUp ? 'Sign In' : 'Sign Up';
            
            // Show/hide confirm password field
            const confirmGroup = document.getElementById('confirmPasswordGroup');
            const confirmInput = document.getElementById('authConfirmPassword');
            if (isAuthModeSignUp) {
                confirmGroup.style.display = 'block';
                confirmInput.required = true;
            } else {
                confirmGroup.style.display = 'none';
                confirmInput.required = false;
                confirmInput.value = '';
            }
            
            hideAuthError();
        }
        
        // Toggle password visibility
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
                button.title = 'Hide password';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
                button.title = 'Show password';
            }
        }
        
        // Sign out
        async function signOutUser() {
            try {
                await auth.signOut();
                showToast('üëã Signed out');
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }
        
        // Show auth error
        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        // Hide auth error
        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }
        
        // ============================================
        // CLOUD SYNC FUNCTIONS
        // ============================================
        
        // Sync tour logs between local storage and Firestore
        async function syncTourLogs() {
            if (!currentUser) return;
            
            updateSyncStatus('syncing');
            
            try {
                const userDocRef = db.collection('users').doc(currentUser.uid);
                const logsDocRef = userDocRef.collection('tourLogs').doc('data');
                
                // Get local logs
                const localLogs = getTourLogs();
                
                // Get cloud logs
                const cloudDoc = await logsDocRef.get();
                const cloudLogs = cloudDoc.exists ? cloudDoc.data().logs || {} : {};
                
                console.log('‚òÅÔ∏è Local logs:', Object.keys(localLogs).length);
                console.log('‚òÅÔ∏è Cloud logs:', Object.keys(cloudLogs).length);
                
                // Merge: cloud wins for conflicts, but keep all unique entries
                const mergedLogs = { ...localLogs };
                
                for (const [key, cloudLog] of Object.entries(cloudLogs)) {
                    if (!mergedLogs[key]) {
                        // New from cloud
                        mergedLogs[key] = cloudLog;
                    } else {
                        // Both have it - keep the newer one
                        const localTime = new Date(mergedLogs[key].loggedAt || 0).getTime();
                        const cloudTime = new Date(cloudLog.loggedAt || 0).getTime();
                        if (cloudTime > localTime) {
                            mergedLogs[key] = cloudLog;
                        }
                    }
                }
                
                // Save merged to local
                saveTourLogs(mergedLogs);
                
                // Save merged to cloud
                await logsDocRef.set({ 
                    logs: mergedLogs,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('‚úÖ Synced', Object.keys(mergedLogs).length, 'tour logs');
                updateSyncStatus('synced');
                
                // Refresh UI
                if (config.nwacZone) {
                    loadTours();
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error');
            }
        }
        
        // Save tour log to cloud (called after saving locally)
        async function saveTourLogToCloud(logs) {
            if (!currentUser) return;
            
            try {
                const logsDocRef = db.collection('users').doc(currentUser.uid)
                    .collection('tourLogs').doc('data');
                
                await logsDocRef.set({ 
                    logs: logs,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                updateSyncStatus('synced');
                console.log('‚òÅÔ∏è Saved to cloud');
            } catch (error) {
                console.error('Cloud save error:', error);
                updateSyncStatus('error');
            }
        }
        
        // Update sync status indicator
        function updateSyncStatus(status) {
            const statusEl = document.getElementById('syncStatus');
            if (!statusEl) return;
            
            switch (status) {
                case 'syncing':
                    statusEl.innerHTML = '<span>‚è≥</span> Syncing...';
                    statusEl.className = 'sync-status';
                    break;
                case 'synced':
                    statusEl.innerHTML = '<span>‚úÖ</span> Synced to cloud';
                    statusEl.className = 'sync-status synced';
                    break;
                case 'error':
                    statusEl.innerHTML = '<span>‚ö†Ô∏è</span> Sync error';
                    statusEl.className = 'sync-status';
                    break;
                default:
                    statusEl.innerHTML = '<span>üì±</span> Local only';
                    statusEl.className = 'sync-status';
            }
        }
        
        // Default coordinates for each NWAC zone
        const zoneDefaults = {
            'west-slopes-north': { lat: 48.868, lon: -121.813, name: 'Mt Baker Area' },
            'stevens-pass': { lat: 47.745, lon: -121.089, name: 'Stevens Pass' },
            'west-slopes-central': { lat: 47.500, lon: -121.400, name: 'West Slopes Central' },
            'snoqualmie-pass': { lat: 47.424, lon: -121.413, name: 'Snoqualmie Pass' },
            'west-slopes-south': { lat: 46.600, lon: -121.400, name: 'White Pass Area' },
            'east-slopes-north': { lat: 48.500, lon: -120.650, name: 'North Cascades East' },
            'east-slopes-central': { lat: 47.250, lon: -120.650, name: 'Mission Ridge Area' },
            'east-slopes-south': { lat: 47.250, lon: -120.900, name: 'Wenatchee Mountains' },
            'olympics': { lat: 47.900, lon: -123.600, name: 'Olympic Mountains' },
            'mt-hood': { lat: 45.330, lon: -121.710, name: 'Mt Hood' }
        };

        // Configuration
        let config = {
            location: null,
            nwacZone: null,
            caltopoMapId: null,
            fitnessLevel: 7,
            downhillSkill: 5,
            touringSkill: 5,
            tourDate: new Date().toISOString().split('T')[0] // Today's date
        };

        // Initialize date picker on page load
        document.addEventListener('DOMContentLoaded', function() {
            const datePicker = document.getElementById('tourDate');
            const today = new Date();
            const maxDate = new Date(today.getTime() + 6 * 24 * 60 * 60 * 1000); // 7 days from now
            
            datePicker.value = today.toISOString().split('T')[0];
            datePicker.min = today.toISOString().split('T')[0];
            datePicker.max = maxDate.toISOString().split('T')[0];
            
            config.tourDate = datePicker.value;
        });

        function onDateChange() {
            const selectedDate = document.getElementById('tourDate').value;
            console.log('üìÖ Date changed to:', selectedDate);
            config.tourDate = selectedDate;
            
            // Reload weather and avalanche data for new date
            if (config.nwacZone) {
                updateDate();
                loadWeatherData();
                loadAvalancheForecast();
            }
        }

        // Fetch trailhead elevation from Open Topo Data API
        // Uses NED 10m dataset for US - free, no API key required
        // Rate limit: 1 call/sec, 1000 calls/day
        const elevationQueue = [];
        let isProcessingQueue = false;
        
        async function fetchTrailheadElevation(lat, lon, elementId) {
            // Add to queue instead of fetching immediately
            elevationQueue.push({ lat, lon, elementId });
            processElevationQueue();
        }
        
        async function processElevationQueue() {
            if (isProcessingQueue || elevationQueue.length === 0) return;
            isProcessingQueue = true;
            
            while (elevationQueue.length > 0) {
                const { lat, lon, elementId } = elevationQueue.shift();
                
                try {
                    const url = `https://api.opentopodata.org/v1/ned10m?locations=${lat},${lon}`;
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'OK' && data.results && data.results[0]) {
                            const elevMeters = data.results[0].elevation;
                            if (elevMeters != null) {
                                const elevFeet = Math.round(elevMeters * 3.28084);
                                const element = document.getElementById(elementId);
                                if (element) {
                                    element.textContent = elevFeet.toLocaleString() + ' ft';
                                    console.log(`üó∫Ô∏è Elevation for ${elementId}: ${elevFeet} ft`);
                                }
                            }
                        }
                    }
                } catch (err) {
                    console.warn('üó∫Ô∏è Elevation API error:', err.message);
                }
                
                // Wait 200ms between requests to respect rate limit (5 req/sec max)
                if (elevationQueue.length > 0) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            isProcessingQueue = false;
        }

        // Tour database organized by zone
        const toursByZone = {
            'west-slopes-north': [
                // Mt Baker Area - Artist Point/Heather Meadows trailhead: 48.8456, -121.6926
                // Twin Lakes trailhead: 48.9550, -121.6400
                // Hannegan Pass trailhead: 48.9067, -121.5867
                // Nooksack Cirque/Coleman: 48.8100, -121.8100
                // Baker Lake area: 48.7200, -121.6700
                { name: "Winchester Mountain and Mount Larrabee", location: "Mt Baker", elevationGain: 7513, distance: 14, maxElevation: 8000, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.9550, trailheadLon: -121.6400 },
                { name: "Tomyhoi Peak", location: "Mt Baker", elevationGain: 3500, distance: 11, maxElevation: 7500, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.9550, trailheadLon: -121.6400 },
                { name: "Goat Mt.", location: "Mt Baker", elevationGain: 3000, distance: 8.8, maxElevation: 6800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.9067, trailheadLon: -121.5867 },
                { name: "Ruth Mt.", location: "Mt Baker", elevationGain: 4035, distance: 8, maxElevation: 7100, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.9067, trailheadLon: -121.5867 },
                { name: "Skyline Divide", location: "Mt Baker", elevationGain: 2500, distance: 9, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 48.8900, trailheadLon: -121.8500 },
                { name: "Chowder Ridge", location: "Mt Baker", elevationGain: 2800, distance: 10, maxElevation: 6200, aspect: "Multiple", terrain: "Exposed ridge", trailheadLat: 48.8900, trailheadLon: -121.8500 },
                { name: "Herman Saddle", location: "Mt Baker", elevationGain: 1500, distance: 9, maxElevation: 5400, aspect: "Multiple", terrain: "Open bowls, 30-35¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Table Mountain Circumnav", location: "Mt Baker", elevationGain: 1900, distance: 5, maxElevation: 5742, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Stoneman Couloir", location: "Mt Baker", elevationGain: 3020, distance: 5.5, maxElevation: 6000, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Mount Ann", location: "Mt Baker", elevationGain: 2500, distance: 9, maxElevation: 5900, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Coleman Pinnacle", location: "Mt Baker", elevationGain: 2800, distance: 9, maxElevation: 6400, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Sholes Glacier", location: "Mt Baker", elevationGain: 3000, distance: 9, maxElevation: 6500, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Coleman Glacier", location: "Mt Baker", elevationGain: 7111, distance: 11, maxElevation: 10781, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.8100, trailheadLon: -121.8100 },
                { name: "Mount Shuksan: North Face", location: "Mt Baker", elevationGain: 6280, distance: 10, maxElevation: 9131, aspect: "Multiple", terrain: "Glacier travel, 40-50¬∞", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Mount Shuksan: White Salmon Glacier", location: "Mt Baker", elevationGain: 6600, distance: 11, maxElevation: 9131, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.8200, trailheadLon: -121.5800 },
                { name: "Mt Shuksan", location: "Mt Baker", elevationGain: 5000, distance: 12, maxElevation: 9131, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.8456, trailheadLon: -121.6926 },
                { name: "Mount Baker: Park Glacier", location: "Mt Baker", elevationGain: 9600, distance: 20, maxElevation: 10781, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.7200, trailheadLon: -121.6700 },
                { name: "Mt Baker: Easton Glacier", location: "Mt Baker", elevationGain: 7000, distance: 12, maxElevation: 10781, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.7100, trailheadLon: -121.7600 },
                { name: "Colfax Peak: South Couloir", location: "Mt Baker", elevationGain: 6100, distance: 10, maxElevation: 9400, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 48.8100, trailheadLon: -121.8100 },
                { name: "Mt. Baker: Boulder Glacier", location: "Mt Baker", elevationGain: 8040, distance: 16, maxElevation: 10781, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.7200, trailheadLon: -121.6700 },
                { name: "Pickets Traverse", location: "North Cascades", elevationGain: 25000, distance: 50, maxElevation: 8200, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.8500, trailheadLon: -121.2500 },
                { name: "Park Butte", location: "Mt Baker", elevationGain: 2000, distance: 8, maxElevation: 5450, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 48.7100, trailheadLon: -121.8100 },
                { name: "Twin Sisters", location: "Mt Baker", elevationGain: 2500, distance: 7, maxElevation: 6932, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.7400, trailheadLon: -122.0600 },
                { name: "Mt. Watson", location: "North Cascades", elevationGain: 2500, distance: 10, maxElevation: 6200, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.7500, trailheadLon: -121.6000 },
                { name: "Bacon Peak", location: "North Cascades", elevationGain: 4500, distance: 17, maxElevation: 7066, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.6500, trailheadLon: -121.5000 },
                { name: "Ruby Mountain", location: "North Cascades", elevationGain: 5230, distance: 8, maxElevation: 7408, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.7800, trailheadLon: -120.9500 },
                { name: "Neve Glacier", location: "North Cascades", elevationGain: 4000, distance: 11, maxElevation: 8000, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.7000, trailheadLon: -121.1500 },
                { name: "Isolation Traverse", location: "North Cascades", elevationGain: 13000, distance: 28, maxElevation: 8200, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.7000, trailheadLon: -121.1500 },
                { name: "Teebone Ridge", location: "North Cascades", elevationGain: 4500, distance: 14, maxElevation: 7200, aspect: "Multiple", terrain: "Exposed ridge", trailheadLat: 48.5500, trailheadLon: -121.2000 },
                { name: "Forbidden Tour", location: "North Cascades", elevationGain: 10315, distance: 28, maxElevation: 8800, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Mt. Buckner: North Face", location: "North Cascades", elevationGain: 9300, distance: 20, maxElevation: 9112, aspect: "Multiple", terrain: "Glacier travel, 40-50¬∞", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Eldorado", location: "North Cascades", elevationGain: 5500, distance: 12, maxElevation: 8868, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.5600, trailheadLon: -121.1000 },
                { name: "Sauk Mt", location: "North Cascades", elevationGain: 2000, distance: 6, maxElevation: 5541, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5300, trailheadLon: -121.5000 },
                { name: "Hidden Lake Peaks", location: "North Cascades", elevationGain: 4689, distance: 8, maxElevation: 7088, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5000, trailheadLon: -121.2000 },
                { name: "Boston Basin", location: "North Cascades", elevationGain: 3500, distance: 8, maxElevation: 8065, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Sahale Arm/Peak", location: "North Cascades", elevationGain: 5440, distance: 12, maxElevation: 8680, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Cascade-Johannesburg Couloir", location: "North Cascades", elevationGain: 3160, distance: 7, maxElevation: 8200, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Snowking Mt", location: "North Cascades", elevationGain: 4000, distance: 12, maxElevation: 7433, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.4800, trailheadLon: -121.3000 },
                { name: "Spider Mountain: North Face", location: "North Cascades", elevationGain: 9980, distance: 16, maxElevation: 8300, aspect: "Multiple", terrain: "Exposed couloirs, 40-50¬∞", trailheadLat: 48.1700, trailheadLon: -120.9500 },
                { name: "Ptarmigan Traverse", location: "North Cascades", elevationGain: 14000, distance: 40, maxElevation: 8200, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "Dome Peak", location: "North Cascades", elevationGain: 8500, distance: 36, maxElevation: 8920, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.2000, trailheadLon: -121.0500 },
                { name: "Whitehorse Mt.", location: "North Cascades", elevationGain: 5925, distance: 8, maxElevation: 6852, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.2200, trailheadLon: -121.7000 }
            ],
            'stevens-pass': [
                // Tours accessed directly from Highway 2 near Stevens Pass
                { name: "Cowboy Mt.", location: "Stevens Pass", elevationGain: 1500, distance: 1.5, maxElevation: 5850, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Skyline Ridge", location: "Stevens Pass", elevationGain: 2900, distance: 3, maxElevation: 5978, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Big Chief Mt.", location: "Stevens Pass", elevationGain: 3200, distance: 7, maxElevation: 6440, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Lichtenberg Mt", location: "Stevens Pass", elevationGain: 2700, distance: 8, maxElevation: 5844, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7172, trailheadLon: -121.1412 },
                { name: "Union Peak", location: "Stevens Pass", elevationGain: 2600, distance: 11, maxElevation: 6200, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7172, trailheadLon: -121.1412 },
                { name: "Jove Peak", location: "Stevens Pass", elevationGain: 2500, distance: 10, maxElevation: 6007, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7172, trailheadLon: -121.1412 },
                { name: "Yodelin", location: "Stevens Pass", elevationGain: 2000, distance: 4, maxElevation: 5400, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Jim Hill Mt.", location: "Stevens Pass", elevationGain: 3130, distance: 8, maxElevation: 6765, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.7103, trailheadLon: -121.1495 },
                { name: "Rock Mt.", location: "Stevens Pass", elevationGain: 3500, distance: 9, maxElevation: 6852, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.7925, trailheadLon: -121.0156 },
                { name: "Mt Mastiff", location: "Stevens Pass", elevationGain: 4000, distance: 9, maxElevation: 7200, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.7925, trailheadLon: -121.0156 },
                { name: "Alpine Lookout", location: "Stevens Pass", elevationGain: 3500, distance: 18, maxElevation: 6250, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7925, trailheadLon: -121.0156 },
                { name: "Skyline Lake", location: "Stevens Pass", elevationGain: 1400, distance: 4, maxElevation: 5092, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Lanham Lake", location: "Stevens Pass", elevationGain: 1200, distance: 5, maxElevation: 4800, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.7172, trailheadLon: -121.1412 },
                { name: "Josephine Lake", location: "Stevens Pass", elevationGain: 1600, distance: 6, maxElevation: 5000, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.7172, trailheadLon: -121.1412 },
                { name: "Tye Ridge", location: "Stevens Pass", elevationGain: 1800, distance: 4, maxElevation: 5600, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7454, trailheadLon: -121.0890 },
                { name: "Labyrinth Mountain", location: "Stevens Pass", elevationGain: 2800, distance: 8, maxElevation: 6376, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.7668, trailheadLon: -121.0603 }
            ],
            'west-slopes-central': [
                // Glacier Peak Wilderness, Chiwaukum Range, Mountain Loop Highway area
                { name: "Mt. Maude", location: "Entiat Mountains", elevationGain: 8400, distance: 14, maxElevation: 9082, aspect: "Multiple", terrain: "Exposed ridge, 40-45¬∞", trailheadLat: 47.9400, trailheadLon: -120.6800 },
                { name: "Chiwawa Mt.", location: "Chiwawa River", elevationGain: 5000, distance: 19, maxElevation: 8459, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.9200, trailheadLon: -120.7600 },
                { name: "Glacier Peak (North)", location: "Glacier Peak Wilderness", elevationGain: 8000, distance: 24, maxElevation: 10541, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.1100, trailheadLon: -121.1200 },
                { name: "Glacier Peak (South)", location: "Glacier Peak Wilderness", elevationGain: 12960, distance: 24, maxElevation: 10541, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.0500, trailheadLon: -120.9300 },
                { name: "North Central Cascades Traverse", location: "Glacier Peak Wilderness", elevationGain: 30290, distance: 60, maxElevation: 10541, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.5300, trailheadLon: -121.0700 },
                { name: "The Dakobed Traverse", location: "Glacier Peak Wilderness", elevationGain: 17990, distance: 40, maxElevation: 9000, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.0500, trailheadLon: -121.0000 },
                { name: "Clark Mt", location: "Entiat Mountains", elevationGain: 4500, distance: 24, maxElevation: 8600, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.9000, trailheadLon: -120.7000 },
                { name: "Chiwaukum Mts", location: "Chiwaukum Range", elevationGain: 5500, distance: 16, maxElevation: 7200, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.7000, trailheadLon: -120.8500 },
                { name: "Chiwaukum Traverse", location: "Chiwaukum Range", elevationGain: 9800, distance: 24, maxElevation: 7200, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.7000, trailheadLon: -120.8500 },
                { name: "Big Jim Mt", location: "Chiwaukum Range", elevationGain: 4000, distance: 14, maxElevation: 7763, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.7300, trailheadLon: -120.8800 },
                { name: "Green Mountain", location: "Mountain Loop Hwy", elevationGain: 2500, distance: 8, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.1100, trailheadLon: -121.4500 },
                { name: "Mt Pilchuck", location: "Mountain Loop Hwy", elevationGain: 2650, distance: 4, maxElevation: 5324, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.0700, trailheadLon: -121.8100 },
                { name: "Three Fingers", location: "Mountain Loop Hwy", elevationGain: 4000, distance: 13, maxElevation: 6854, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.1600, trailheadLon: -121.6800 },
                { name: "Vesper Peak", location: "Mountain Loop Hwy", elevationGain: 4150, distance: 6, maxElevation: 6214, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.0600, trailheadLon: -121.4900 },
                { name: "Kyes Peak", location: "Mountain Loop Hwy", elevationGain: 6160, distance: 16, maxElevation: 7280, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.9300, trailheadLon: -121.3600 },
                { name: "Bandit Peak: Black Hole Couloir", location: "Nason Ridge", elevationGain: 5900, distance: 15, maxElevation: 7500, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 47.7800, trailheadLon: -121.0200 },
                { name: "Johnson Ridge", location: "Mountain Loop Hwy", elevationGain: 2500, distance: 11, maxElevation: 6000, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 48.0900, trailheadLon: -121.3600 },
                { name: "Rock Mt. to Mt. Mastiff Traverse", location: "Nason Ridge", elevationGain: 7740, distance: 11, maxElevation: 7200, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.7925, trailheadLon: -121.0156 },
                { name: "Arrowhead Mountain", location: "Nason Ridge", elevationGain: 2000, distance: 4.5, maxElevation: 6030, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.7800, trailheadLon: -121.0500 }
            ],
            'snoqualmie-pass': [
                { name: "Big Snow Mt.", location: "Snoqualmie Pass", elevationGain: 3500, distance: 15, maxElevation: 6680, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.5200, trailheadLon: -121.3500 },
                { name: "Wedge Mt.", location: "Snoqualmie Pass", elevationGain: 2000, distance: 10, maxElevation: 6000, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.5000, trailheadLon: -121.3600 },
                { name: "Ingalls Peak", location: "Snoqualmie Pass", elevationGain: 3500, distance: 11, maxElevation: 7662, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.4411, trailheadLon: -120.9389 },
                { name: "Mt. Stuart", location: "Snoqualmie Pass", elevationGain: 8185, distance: 14, maxElevation: 9415, aspect: "Multiple", terrain: "Exposed ridge, 40-45¬∞", trailheadLat: 47.4411, trailheadLon: -120.9389 },
                { name: "Enchantments / Central Cascades Traverse", location: "Snoqualmie Pass", elevationGain: 7250, distance: 50, maxElevation: 8500, aspect: "Multiple", terrain: "Exposed ridge", trailheadLat: 47.5280, trailheadLon: -120.8264 },
                { name: "Cashmere Mt.", location: "Snoqualmie Pass", elevationGain: 5000, distance: 18, maxElevation: 8501, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.5100, trailheadLon: -120.6800 },
                { name: "Icicle Ridge", location: "Snoqualmie Pass", elevationGain: 3000, distance: 14, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.5947, trailheadLon: -120.7025 },
                { name: "Cannon Mountain Couloir", location: "Snoqualmie Pass", elevationGain: 5620, distance: 8.5, maxElevation: 8638, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 47.5000, trailheadLon: -120.8000 },
                { name: "Colchuck Peak / Porcupine Creek", location: "Snoqualmie Pass", elevationGain: 6705, distance: 22, maxElevation: 8705, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.5280, trailheadLon: -120.8264 },
                { name: "Dragontail Peak", location: "Snoqualmie Pass", elevationGain: 5500, distance: 14, maxElevation: 8840, aspect: "Multiple", terrain: "Exposed couloirs, 40-45¬∞", trailheadLat: 47.5280, trailheadLon: -120.8264 },
                { name: "Mt. Daniel", location: "Snoqualmie Pass", elevationGain: 5380, distance: 14, maxElevation: 7986, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.5600, trailheadLon: -121.1800 },
                { name: "Jolly Mt.", location: "Snoqualmie Pass", elevationGain: 2500, distance: 12, maxElevation: 6443, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3400, trailheadLon: -121.1200 },
                { name: "Howson Creek", location: "Snoqualmie Pass", elevationGain: 1500, distance: 6, maxElevation: 4800, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.3600, trailheadLon: -121.3200 },
                { name: "Forest Road 800", location: "Snoqualmie Pass", elevationGain: 800, distance: 6, maxElevation: 3800, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 47.3400, trailheadLon: -121.4000 },
                { name: "Hog Loppet", location: "Snoqualmie Pass", elevationGain: 1200, distance: 21, maxElevation: 4200, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 47.3400, trailheadLon: -121.4000 },
                { name: "Mission Peak", location: "Snoqualmie Pass", elevationGain: 1000, distance: 2, maxElevation: 6876, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3266, trailheadLon: -120.3970 },
                { name: "Haney Meadow", location: "Snoqualmie Pass", elevationGain: 2000, distance: 9, maxElevation: 5500, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 47.2800, trailheadLon: -121.0500 },
                { name: "Diamond Head", location: "Snoqualmie Pass", elevationGain: 2200, distance: 5, maxElevation: 5915, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3000, trailheadLon: -121.0800 },
                { name: "Tronsen Meadows", location: "Snoqualmie Pass", elevationGain: 800, distance: 3, maxElevation: 4600, aspect: "Multiple", terrain: "Open meadow, <25¬∞", trailheadLat: 47.3800, trailheadLon: -120.6000 },
                { name: "Mt. Thompson", location: "Snoqualmie Pass", elevationGain: 4000, distance: 16, maxElevation: 6554, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.4500, trailheadLon: -121.3800 },
                { name: "Snoqualmie Haute Route", location: "Snoqualmie Pass", elevationGain: 20000, distance: 50, maxElevation: 8500, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Little Snoqualmie Haute Route", location: "Snoqualmie Pass", elevationGain: 8000, distance: 24, maxElevation: 7000, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Overcoat Peak", location: "Snoqualmie Pass", elevationGain: 4000, distance: 9, maxElevation: 6720, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.5400, trailheadLon: -121.2500 },
                { name: "Alaska Mt.", location: "Snoqualmie Pass", elevationGain: 3500, distance: 10, maxElevation: 5800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4600, trailheadLon: -121.3800 },
                { name: "Mt. Roosevelt", location: "Snoqualmie Pass", elevationGain: 2500, distance: 6, maxElevation: 5800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4600, trailheadLon: -121.3700 },
                { name: "Kaleetan Peak", location: "Snoqualmie Pass", elevationGain: 3500, distance: 7, maxElevation: 6259, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.4428, trailheadLon: -121.4256 },
                { name: "Chair Peak Circumnavigation", location: "Snoqualmie Pass", elevationGain: 4510, distance: 7, maxElevation: 6238, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.4428, trailheadLon: -121.4256 },
                { name: "Chair Peak Basin", location: "Snoqualmie Pass", elevationGain: 2500, distance: 5, maxElevation: 6238, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.4428, trailheadLon: -121.4256 },
                { name: "Pineapple Pass", location: "Snoqualmie Pass", elevationGain: 2000, distance: 4, maxElevation: 5200, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4428, trailheadLon: -121.4256 },
                { name: "Snow Lake Divide", location: "Snoqualmie Pass", elevationGain: 2500, distance: 4, maxElevation: 5400, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4428, trailheadLon: -121.4256 },
                { name: "Mt. Snoqualmie", location: "Snoqualmie Pass", elevationGain: 4000, distance: 6, maxElevation: 6278, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Kendall Peak", location: "Snoqualmie Pass", elevationGain: 2000, distance: 4, maxElevation: 5784, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Kendall Ridge", location: "Snoqualmie Pass", elevationGain: 2500, distance: 8, maxElevation: 5784, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Lundin Peak", location: "Snoqualmie Pass", elevationGain: 3000, distance: 6, maxElevation: 5920, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Red Mt.", location: "Snoqualmie Pass", elevationGain: 3500, distance: 10, maxElevation: 5890, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.4289, trailheadLon: -121.4178 },
                { name: "Silver Peak", location: "Snoqualmie Pass", elevationGain: 3000, distance: 8, maxElevation: 5605, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3980, trailheadLon: -121.4663 },
                { name: "Granite Mt.", location: "Snoqualmie Pass", elevationGain: 3800, distance: 8, maxElevation: 5629, aspect: "Multiple", terrain: "Exposed ridge", trailheadLat: 47.3980, trailheadLon: -121.4872 },
                { name: "Humpback Mt.", location: "Snoqualmie Pass", elevationGain: 2000, distance: 9, maxElevation: 5174, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3500, trailheadLon: -121.5000 },
                { name: "Mt. Margaret", location: "Snoqualmie Pass", elevationGain: 2500, distance: 15, maxElevation: 5500, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 47.3200, trailheadLon: -121.5300 },
                { name: "Mt. Hyak", location: "Snoqualmie Pass", elevationGain: 1000, distance: 2, maxElevation: 5300, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3936, trailheadLon: -121.3975 },
                { name: "Mt. Catherine", location: "Snoqualmie Pass", elevationGain: 2000, distance: 5, maxElevation: 5052, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.3936, trailheadLon: -121.3975 },
                { name: "Amabilis Mt.", location: "Snoqualmie Pass", elevationGain: 1800, distance: 8, maxElevation: 4554, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.3500, trailheadLon: -121.3200 },
                { name: "McClellan Butte", location: "Snoqualmie Pass", elevationGain: 3714, distance: 7, maxElevation: 5162, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.3936, trailheadLon: -121.4653 },
                { name: "Keechelus Ridge", location: "Snoqualmie Pass", elevationGain: 1500, distance: 8.4, maxElevation: 5000, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.3572, trailheadLon: -121.3680 },
                { name: "Roaring Ridge", location: "Snoqualmie Pass", elevationGain: 2000, distance: 6, maxElevation: 4800, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.3400, trailheadLon: -121.3500 }
            ],
            'west-slopes-south': [
                // Crystal Mountain area: 46.9350, -121.5040
                // Chinook Pass: 46.8690, -121.5180
                // Paradise/Mt Rainier: 46.7867, -121.7367
                // White Pass: 46.6370, -121.3890
                // Sunrise: 46.9100, -121.6400
                { name: "Silver King", location: "Mt Rainier", elevationGain: 2000, distance: 5, maxElevation: 5400, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.9350, trailheadLon: -121.5040 },
                { name: "Corral Pass", location: "Mt Rainier", elevationGain: 1500, distance: 12, maxElevation: 5600, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 46.9800, trailheadLon: -121.4600 },
                { name: "Chinook Pass to Crystal", location: "Mt Rainier", elevationGain: 6000, distance: 9, maxElevation: 7000, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.8690, trailheadLon: -121.5180 },
                { name: "Sheep Lake Couloir", location: "Mt Rainier", elevationGain: 5100, distance: 7, maxElevation: 6600, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 46.8690, trailheadLon: -121.5180 },
                { name: "Norse Peak", location: "Mt Rainier", elevationGain: 2500, distance: 7, maxElevation: 6856, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9500, trailheadLon: -121.4800 },
                { name: "Union Creek", location: "Mt Rainier", elevationGain: 2000, distance: 9, maxElevation: 6000, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9200, trailheadLon: -121.5200 },
                { name: "East Peak", location: "Mt Rainier", elevationGain: 2300, distance: 4, maxElevation: 6260, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.8690, trailheadLon: -121.5180 },
                { name: "Crystal Basin", location: "Mt Rainier", elevationGain: 6300, distance: 6, maxElevation: 7000, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.9350, trailheadLon: -121.5040 },
                { name: "Yakima Peak", location: "Mt Rainier", elevationGain: 1500, distance: 2, maxElevation: 6226, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.8690, trailheadLon: -121.5180 },
                { name: "Naches Peak", location: "Mt Rainier", elevationGain: 1000, distance: 2, maxElevation: 6000, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.8690, trailheadLon: -121.5180 },
                { name: "Bear Gap", location: "Mt Rainier", elevationGain: 1200, distance: 4, maxElevation: 5800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9350, trailheadLon: -121.5040 },
                { name: "Summerland", location: "Mt Rainier", elevationGain: 3000, distance: 9, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9100, trailheadLon: -121.5700 },
                { name: "Goat Island", location: "Mt Rainier", elevationGain: 2500, distance: 14, maxElevation: 6800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9100, trailheadLon: -121.5700 },
                { name: "Cowlitz Chimneys", location: "Mt Rainier", elevationGain: 4300, distance: 13, maxElevation: 7600, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 46.9100, trailheadLon: -121.5700 },
                { name: "Interglacier", location: "Mt Rainier", elevationGain: 3500, distance: 12, maxElevation: 8200, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.9100, trailheadLon: -121.6400 },
                { name: "Mt Rainier Circumnav", location: "Mt Rainier", elevationGain: 16000, distance: 40, maxElevation: 14411, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Burroughs Mt.", location: "Mt Rainier", elevationGain: 2500, distance: 8, maxElevation: 7800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.9100, trailheadLon: -121.6400 },
                { name: "Fryingpan Creek Couloir", location: "Mt Rainier", elevationGain: 3600, distance: 7, maxElevation: 7200, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 46.9100, trailheadLon: -121.5700 },
                { name: "Liberty Ridge", location: "Mt Rainier", elevationGain: 11200, distance: 24, maxElevation: 14411, aspect: "Multiple", terrain: "Glacier travel, 40-50¬∞", trailheadLat: 46.9100, trailheadLon: -121.6400 },
                { name: "Emmons Glacier", location: "Mt Rainier", elevationGain: 10400, distance: 24, maxElevation: 14411, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.9100, trailheadLon: -121.6400 },
                { name: "Carbon Glacier", location: "Mt Rainier", elevationGain: 5000, distance: 10, maxElevation: 10000, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.9900, trailheadLon: -121.8300 },
                { name: "Russell Glacier", location: "Mt Rainier", elevationGain: 4500, distance: 10, maxElevation: 9500, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.9100, trailheadLon: -121.6400 },
                { name: "Puyallap Cleaver", location: "Mt Rainier", elevationGain: 5000, distance: 16, maxElevation: 11000, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.7700, trailheadLon: -121.8500 },
                { name: "Fuhrer Finger", location: "Mt Rainier", elevationGain: 9030, distance: 24, maxElevation: 14411, aspect: "Multiple", terrain: "Couloir, 40-50¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Muir Snowfield", location: "Mt Rainier", elevationGain: 4660, distance: 9, maxElevation: 10080, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Van Trump Park", location: "Mt Rainier", elevationGain: 6750, distance: 8, maxElevation: 10000, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Golden Gate Bowls", location: "Mt Rainier", elevationGain: 2000, distance: 2.8, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Nisqually Glacier", location: "Mt Rainier", elevationGain: 5000, distance: 9, maxElevation: 10000, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Alta Vista", location: "Mt Rainier", elevationGain: 800, distance: 1, maxElevation: 5900, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Paradise Glacier", location: "Mt Rainier", elevationGain: 3000, distance: 7, maxElevation: 7500, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Little Tahoma", location: "Mt Rainier", elevationGain: 5718, distance: 10, maxElevation: 11138, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Devil's Dip", location: "Mt Rainier", elevationGain: 600, distance: 2, maxElevation: 5500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Paradise Valley", location: "Mt Rainier", elevationGain: 400, distance: 0.4, maxElevation: 5400, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Mazama Ridge", location: "Mt Rainier", elevationGain: 1200, distance: 3, maxElevation: 5600, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Edith's Rib", location: "Mt Rainier", elevationGain: 1000, distance: 2.2, maxElevation: 5600, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.7867, trailheadLon: -121.7367 },
                { name: "Reflection Lakes", location: "Mt Rainier", elevationGain: 600, distance: 6.8, maxElevation: 5000, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.7700, trailheadLon: -121.7300 },
                { name: "Tatoosh Range", location: "Mt Rainier", elevationGain: 3500, distance: 7, maxElevation: 6310, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 46.7700, trailheadLon: -121.7300 },
                { name: "Tatoosh Traverse", location: "Mt Rainier", elevationGain: 6080, distance: 16, maxElevation: 6310, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 46.7700, trailheadLon: -121.7300 },
                { name: "Lane Peak: The Zipper", location: "Mt Rainier", elevationGain: 1700, distance: 4, maxElevation: 6013, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.7700, trailheadLon: -121.7300 },
                { name: "West Side Road", location: "Mt Rainier", elevationGain: 1000, distance: 9.6, maxElevation: 4500, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.7500, trailheadLon: -121.8500 },
                { name: "Longmire Area", location: "Mt Rainier", elevationGain: 600, distance: 3, maxElevation: 3000, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.7500, trailheadLon: -121.8100 },
                { name: "White Pass", location: "White Pass", elevationGain: 2000, distance: 6, maxElevation: 5800, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.6370, trailheadLon: -121.3890 },
                { name: "Goat Rocks", location: "White Pass", elevationGain: 5000, distance: 17, maxElevation: 8200, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 46.5000, trailheadLon: -121.4500 },
                { name: "Forest Rd 1284", location: "White Pass", elevationGain: 1000, distance: 3.5, maxElevation: 4500, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.6500, trailheadLon: -121.4000 },
                { name: "Goat Rocks: Gilbert Peak", location: "White Pass", elevationGain: 4200, distance: 16, maxElevation: 8201, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 46.5000, trailheadLon: -121.4500 },
                { name: "North Fork Tieton River", location: "White Pass", elevationGain: 1000, distance: 9.8, maxElevation: 4000, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.6800, trailheadLon: -121.2500 },
                { name: "Sand Lake", location: "White Pass", elevationGain: 1500, distance: 4, maxElevation: 5200, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 46.6370, trailheadLon: -121.3890 },
                { name: "Round Mt.", location: "White Pass", elevationGain: 2000, distance: 8.8, maxElevation: 5970, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 46.6370, trailheadLon: -121.3890 }
            ],
            'east-slopes-north': [
                // Methow Valley / Harts Pass area: 48.7100, -120.6600
                // Washington Pass: 48.5200, -120.6500
                // Rainy Pass: 48.5100, -120.7200
                { name: "Slate Peak", location: "Methow Valley", elevationGain: 1500, distance: 4, maxElevation: 7440, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.7400, trailheadLon: -120.6900 },
                { name: "Delancy Ridge", location: "Methow Valley", elevationGain: 2500, distance: 4, maxElevation: 7000, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.7100, trailheadLon: -120.6600 },
                { name: "Mesahchie Peak", location: "Methow Valley", elevationGain: 5200, distance: 8, maxElevation: 8795, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 48.6500, trailheadLon: -120.8000 },
                { name: "Silver Star Mt", location: "Methow Valley", elevationGain: 5436, distance: 8, maxElevation: 8876, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.5200, trailheadLon: -120.6500 },
                { name: "Cutthroat Pass Alternative", location: "Methow Valley", elevationGain: 2000, distance: 10, maxElevation: 6800, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 48.5400, trailheadLon: -120.7100 },
                { name: "Cutthroat Pass", location: "Methow Valley", elevationGain: 2200, distance: 15.6, maxElevation: 6820, aspect: "Multiple", terrain: "Open slopes, <30¬∞", trailheadLat: 48.5400, trailheadLon: -120.7100 },
                { name: "Heather and Maple Pass", location: "Methow Valley", elevationGain: 4200, distance: 6.5, maxElevation: 7000, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5100, trailheadLon: -120.7300 },
                { name: "Black Peak: South Face", location: "Methow Valley", elevationGain: 4630, distance: 10, maxElevation: 8970, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 48.5100, trailheadLon: -120.7200 },
                { name: "Washington Pass Birthday Tour", location: "Methow Valley", elevationGain: 3600, distance: 5, maxElevation: 6500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5200, trailheadLon: -120.6500 },
                { name: "Early Winters", location: "Methow Valley", elevationGain: 1800, distance: 4, maxElevation: 6200, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 48.5900, trailheadLon: -120.5200 },
                { name: "Loup Loup", location: "Methow Valley", elevationGain: 800, distance: 10, maxElevation: 4400, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 48.3900, trailheadLon: -119.9100 },
                { name: "North Star Mt", location: "Methow Valley", elevationGain: 5500, distance: 26, maxElevation: 8300, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 48.5500, trailheadLon: -120.6000 },
                { name: "Bonanza West Peak", location: "Methow Valley", elevationGain: 8300, distance: 30, maxElevation: 9511, aspect: "Multiple", terrain: "Exposed ridge, 40-45¬∞", trailheadLat: 48.2000, trailheadLon: -120.7500 }
            ],
            'olympics': [
                // Hurricane Ridge: 47.9700, -123.4980
                // Deer Park: 47.9500, -123.2600
                // Staircase: 47.5200, -123.3300
                { name: "Lodge Run & Toilet Bowl", location: "Olympics", elevationGain: 500, distance: 1, maxElevation: 5200, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Mt. Angeles", location: "Olympics", elevationGain: 1500, distance: 2, maxElevation: 6454, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Mount Angeles with Klahhane Ridge", location: "Olympics", elevationGain: 4400, distance: 6, maxElevation: 6454, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Wolf Creek Trail", location: "Olympics", elevationGain: 1500, distance: 8.7, maxElevation: 5000, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Waterhole Trail", location: "Olympics", elevationGain: 1200, distance: 8, maxElevation: 4500, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Obstruction Point", location: "Olympics", elevationGain: 3500, distance: 16, maxElevation: 6450, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9200, trailheadLon: -123.3800 },
                { name: "Hurricane Hill", location: "Olympics", elevationGain: 2000, distance: 6, maxElevation: 5757, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Second Peak", location: "Olympics", elevationGain: 2500, distance: 8, maxElevation: 5500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9700, trailheadLon: -123.4980 },
                { name: "Deer Park", location: "Olympics", elevationGain: 2500, distance: 14, maxElevation: 6007, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9500, trailheadLon: -123.2600 },
                { name: "High Divide", location: "Olympics", elevationGain: 4000, distance: 17, maxElevation: 5500, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.9600, trailheadLon: -123.8000 },
                { name: "Potholes", location: "Olympics", elevationGain: 2500, distance: 10, maxElevation: 5000, aspect: "Multiple", terrain: "Open slopes, 30-35¬∞", trailheadLat: 47.8000, trailheadLon: -123.6000 },
                { name: "Mt Ellinor", location: "Olympics", elevationGain: 3280, distance: 8, maxElevation: 5944, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 47.5100, trailheadLon: -123.2400 },
                { name: "Olympic Hot Springs", location: "Olympics", elevationGain: 1000, distance: 7.6, maxElevation: 3000, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 47.9800, trailheadLon: -123.6900 },
                { name: "Mount Deception", location: "Olympics", elevationGain: 5000, distance: 16, maxElevation: 7788, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.8200, trailheadLon: -123.1500 },
                { name: "The Brothers: East Basin", location: "Olympics", elevationGain: 6740, distance: 12, maxElevation: 6866, aspect: "Multiple", terrain: "Exposed ridge, 35-40¬∞", trailheadLat: 47.6900, trailheadLon: -123.0900 }
            ],
            'mt-hood': [
                // Mt Adams South Climb: 46.1500, -121.4900
                // Mt St Helens Climbers Bivouac: 46.1460, -122.1820
                { name: "Mt. Adams", location: "Mt Adams", elevationGain: 6756, distance: 10, maxElevation: 12276, aspect: "Multiple", terrain: "Glacier travel", trailheadLat: 46.1500, trailheadLon: -121.4900 },
                { name: "Mt Saint Helens", location: "Mt St Helens", elevationGain: 5665, distance: 8, maxElevation: 8363, aspect: "Multiple", terrain: "Open slopes, 35-40¬∞", trailheadLat: 46.1460, trailheadLon: -122.1820 },
                { name: "Marble Mt.", location: "Mt St Helens", elevationGain: 1500, distance: 12, maxElevation: 4128, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.1200, trailheadLon: -122.1500 },
                { name: "June Lake", location: "Mt St Helens", elevationGain: 1500, distance: 4.8, maxElevation: 4200, aspect: "Multiple", terrain: "Treed, <30¬∞", trailheadLat: 46.1400, trailheadLon: -122.1700 },
                { name: "Aiken Lava Bed", location: "Mt Adams", elevationGain: 1200, distance: 7.6, maxElevation: 4000, aspect: "Multiple", terrain: "Treed, <25¬∞", trailheadLat: 46.1300, trailheadLon: -121.5200 },
                { name: "Mt Adams: North Face", location: "Mt Adams", elevationGain: 8970, distance: 16, maxElevation: 12276, aspect: "Multiple", terrain: "Exposed ridge, 40-45¬∞", trailheadLat: 46.2500, trailheadLon: -121.5100 }
            ],
        };

        const fitnessLabels = {
            1: 'Exhausted', 2: 'Very Tired', 3: 'Tired', 4: 'Below Average',
            5: 'Average', 6: 'Good', 7: 'Strong', 8: 'Very Strong',
            9: 'Excellent', 10: 'Peak Energy'
        };

        const skillLabels = {
            1: 'First Timer', 2: 'Novice', 3: 'Beginner', 4: 'Developing',
            5: 'Intermediate', 6: 'Competent', 7: 'Advanced', 8: 'Expert',
            9: 'Very Expert', 10: 'Professional Guide'
        };

        const skillDescriptions = {
            1: 'New to backcountry skiing. Stick to groomed sidecountry or guided tours.',
            2: 'Learning basics. Need easy, well-traveled routes with low avalanche terrain.',
            3: 'Know the basics. Can handle mellow terrain, needs mentorship on longer tours.',
            4: 'Building skills. Comfortable skinning, learning avalanche assessment.',
            5: 'Can handle moderate terrain, some route-finding, comfortable with avalanche basics.',
            6: 'Solid skills. Can plan tours, read terrain, make good decisions in variable conditions.',
            7: 'Strong all-around. Handles complex terrain, glacier travel, leads groups safely.',
            8: 'Expert level. Comfortable in steep couloirs, technical terrain, alpine starts.',
            9: 'Highly skilled. Multi-day traverses, extreme terrain, rescue leadership.',
            10: 'Professional guide level. Certified, can handle any objective safely.'
        };

        function onZoneChange() {
            const nwacZone = document.getElementById('nwacZone').value;
            console.log('üîÑ onZoneChange called, zone:', nwacZone);
            
            const welcomeEl = document.getElementById('welcomeMessage');
            const dashboardEl = document.getElementById('dashboardContent');
            
            console.log('üìã Welcome element:', welcomeEl);
            console.log('üìã Dashboard element:', dashboardEl);
            
            if (!nwacZone) {
                console.log('‚ùå No zone selected, showing welcome');
                if (welcomeEl) welcomeEl.style.display = 'block';
                if (dashboardEl) dashboardEl.style.display = 'none';
                return;
            }
            
            console.log('‚úÖ Zone selected:', nwacZone);
            console.log('üìã Hiding welcome, showing dashboard...');
            
            if (welcomeEl) {
                welcomeEl.style.display = 'none';
                console.log('üìã Welcome display now:', welcomeEl.style.display);
            }
            if (dashboardEl) {
                dashboardEl.style.display = 'block';
                console.log('üìã Dashboard display now:', dashboardEl.style.display);
            }
            
            // Update config
            config.nwacZone = nwacZone;
            config.location = zoneDefaults[nwacZone];
            config.excludedTours = []; // Reset excluded tours for new zone
            
            console.log('‚úÖ Config updated:', JSON.stringify(config));
            console.log('üìç Location set to:', config.location);
            
            // Load all data
            console.log('üìã Calling loadDashboard...');
            loadDashboard();
        }

        async function loadDashboard() {
            console.log('üìä loadDashboard() called');
            console.log('üìä Zone:', config.nwacZone);
            console.log('üìä Location:', config.location);
            
            // Update date
            console.log('üìä Calling updateDate...');
            updateDate();

            // Load all data
            console.log('üìä Loading avalanche, weather, and tours...');
            try {
                await Promise.all([
                    loadAvalancheForecast(),
                    loadWeatherData(),
                    loadTours()
                ]);
                console.log('‚úÖ All data loaded successfully!');
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                console.error('‚ùå Error stack:', error.stack);
            }
        }

        function updateDate() {
            const selectedDate = new Date(config.tourDate + 'T12:00:00'); // Add time to avoid timezone issues
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = selectedDate.toLocaleDateString('en-US', options);
            
            // Calculate days from now
            const diffDays = Math.round((selectedDate - today) / (1000 * 60 * 60 * 24));
            
            let prefix = 'üìÖ';
            let suffix = '';
            if (diffDays === 0) {
                prefix = 'üìÖ Today:';
            } else if (diffDays === 1) {
                prefix = 'üìÖ Tomorrow:';
            } else {
                prefix = 'üìÖ Tour Date:';
                suffix = ` (${diffDays} days away)`;
            }
            
            document.getElementById('dateBanner').textContent = `${prefix} ${dateStr}${suffix}`;
        }

        async function loadAvalancheForecast() {
            const content = document.getElementById('avalancheContent');
            console.log('üèîÔ∏è Loading avalanche forecast for:', config.nwacZone);
            
            // NWAC zone URLs mapping
            const nwacZoneUrls = {
                'west-slopes-north': 'https://nwac.us/avalanche-forecast/#/west-slopes-north',
                'stevens-pass': 'https://nwac.us/avalanche-forecast/#/stevens-pass',
                'west-slopes-central': 'https://nwac.us/avalanche-forecast/#/west-slopes-central',
                'snoqualmie-pass': 'https://nwac.us/avalanche-forecast/#/snoqualmie-pass',
                'west-slopes-south': 'https://nwac.us/avalanche-forecast/#/west-slopes-south',
                'east-slopes-north': 'https://nwac.us/avalanche-forecast/#/east-slopes-north',
                'east-slopes-central': 'https://nwac.us/avalanche-forecast/#/east-slopes-central',
                'east-slopes-south': 'https://nwac.us/avalanche-forecast/#/east-slopes-south',
                'olympics': 'https://nwac.us/avalanche-forecast/#/olympics',
                'mt-hood': 'https://nwac.us/avalanche-forecast/#/mt-hood'
            };
            
            const zoneUrl = nwacZoneUrls[config.nwacZone] || 'https://nwac.us/avalanche-forecast/';
            const zoneName = getZoneName(config.nwacZone);
            
            // Show loading state
            content.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üèîÔ∏è</div>
                    <div style="color: var(--topo-gray);">Loading avalanche forecast...</div>
                </div>
            `;
            
            try {
                // Use the official avalanche.org map-layer API
                const apiUrl = 'https://api.avalanche.org/v2/public/products/map-layer/NWAC';
                console.log('üèîÔ∏è Fetching from avalanche.org API:', apiUrl);
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }
                
                const geoData = await response.json();
                console.log('üèîÔ∏è Avalanche.org API response:', geoData);
                
                // Find the forecast for our zone by matching zone name
                const zoneNameMap = {
                    'west-slopes-north': ['Mt Baker', 'West Slopes North', 'Baker'],
                    'stevens-pass': ['Stevens Pass'],
                    'west-slopes-central': ['West Slopes Central', 'Central'],
                    'snoqualmie-pass': ['Snoqualmie Pass'],
                    'west-slopes-south': ['West Slopes South', 'White Pass'],
                    'east-slopes-north': ['East Slopes North'],
                    'east-slopes-central': ['East Slopes Central', 'Mission Ridge'],
                    'east-slopes-south': ['East Slopes South'],
                    'olympics': ['Olympics', 'Olympic'],
                    'mt-hood': ['Mt Hood', 'Mount Hood']
                };
                
                let forecast = null;
                const searchNames = zoneNameMap[config.nwacZone] || [zoneName];
                
                if (geoData && geoData.features && Array.isArray(geoData.features)) {
                    forecast = geoData.features.find(f => {
                        const name = f.properties?.name?.toLowerCase() || '';
                        return searchNames.some(s => name.includes(s.toLowerCase()));
                    });
                }
                
                if (forecast && forecast.properties) {
                    const props = forecast.properties;
                    
                    // Get danger level (1-5 scale, or -1 for no rating)
                    const dangerLevel = props.danger_level || 0;
                    const dangerText = props.danger || 'No Rating';
                    const dangerColor = props.color || '#cccccc';
                    const fontColor = props.font_color || '#333';
                    const travelAdvice = props.travel_advice || '';
                    const forecastLink = props.link || zoneUrl;
                    
                    // Format dates
                    const issueDate = props.start_date ? new Date(props.start_date).toLocaleDateString('en-US', {
                        weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
                    }) : '';
                    
                    // Check if viewing a future date
                    // Parse tour date as local date (YYYY-MM-DD)
                    const tourDateParts = config.tourDate.split('-');
                    const tourDate = new Date(tourDateParts[0], tourDateParts[1] - 1, tourDateParts[2]);
                    tourDate.setHours(12, 0, 0, 0);
                    
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const diffTime = tourDate.getTime() - today.getTime();
                    const daysFromNow = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    const isFutureDate = daysFromNow > 0;
                    
                    console.log('üìÖ Avalanche date check:', { tourDate: config.tourDate, daysFromNow, isFutureDate });
                    
                    content.innerHTML = `
                        <div style="text-align: center;">
                            <!-- Future Date Warning -->
                            ${isFutureDate ? `
                            <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 0.6rem; margin-bottom: 0.75rem;">
                                <div style="font-size: 0.75rem; color: #856404;">
                                    ‚ö†Ô∏è <strong>Viewing ${daysFromNow === 1 ? 'tomorrow' : daysFromNow + ' days ahead'}</strong><br>
                                    <span style="font-size: 0.7rem;">This is today's forecast. A new forecast will be issued daily at 6 PM. Check again before your tour.</span>
                                </div>
                            </div>
                            ` : ''}
                            
                            <!-- Zone Name & Issue Date -->
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 1.1rem; font-weight: 700; color: var(--forest-green);">
                                    ${props.name || zoneName}
                                </div>
                                ${issueDate ? `<div style="font-size: 0.7rem; color: var(--topo-gray);">Updated: ${issueDate}</div>` : ''}
                            </div>
                            
                            <!-- Danger Rating Display -->
                            <div style="background: ${dangerColor}; color: ${fontColor}; padding: 1.25rem; border-radius: 12px; margin-bottom: 1rem; ${isFutureDate ? 'opacity: 0.85;' : ''}">
                                <div style="font-size: 0.7rem; text-transform: uppercase; opacity: 0.9; margin-bottom: 0.25rem;">${isFutureDate ? "Today's " : ''}Avalanche Danger</div>
                                <div style="font-size: 2rem; font-weight: 700; text-transform: uppercase;">${dangerText}</div>
                            </div>
                            
                            <!-- Travel Advice -->
                            ${travelAdvice ? `
                            <div style="background: var(--cream); border-radius: 10px; padding: 0.75rem; margin-bottom: 1rem; text-align: left;">
                                <div style="font-size: 0.7rem; color: var(--topo-gray); text-transform: uppercase; margin-bottom: 0.4rem;">Travel Advice</div>
                                <div style="font-size: 0.8rem; color: #333; line-height: 1.4;">${travelAdvice}</div>
                            </div>
                            ` : ''}
                            
                            <!-- Danger Scale Legend -->
                            <div style="background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); border-radius: 10px; padding: 0.75rem; margin-bottom: 1rem;">
                                <div style="font-size: 0.65rem; color: var(--topo-gray); text-transform: uppercase; margin-bottom: 0.4rem;">
                                    Danger Scale
                                </div>
                                <div style="display: flex; justify-content: center; gap: 0.3rem; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 0.15rem; background: white; padding: 0.25rem 0.4rem; border-radius: 4px; ${dangerLevel === 1 ? 'border: 2px solid #333;' : ''}">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #50B848;"></div>
                                        <span style="font-size: 0.6rem; font-weight: 600;">Low</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.15rem; background: white; padding: 0.25rem 0.4rem; border-radius: 4px; ${dangerLevel === 2 ? 'border: 2px solid #333;' : ''}">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #FFF200; border: 1px solid #ddd;"></div>
                                        <span style="font-size: 0.6rem; font-weight: 600;">Mod</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.15rem; background: white; padding: 0.25rem 0.4rem; border-radius: 4px; ${dangerLevel === 3 ? 'border: 2px solid #333;' : ''}">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #F7941E;"></div>
                                        <span style="font-size: 0.6rem; font-weight: 600;">Cons</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.15rem; background: white; padding: 0.25rem 0.4rem; border-radius: 4px; ${dangerLevel === 4 ? 'border: 2px solid #333;' : ''}">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ED1C24;"></div>
                                        <span style="font-size: 0.6rem; font-weight: 600;">High</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.15rem; background: white; padding: 0.25rem 0.4rem; border-radius: 4px; ${dangerLevel === 5 ? 'border: 2px solid #333;' : ''}">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #000000;"></div>
                                        <span style="font-size: 0.6rem; font-weight: 600;">Ext</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CTA Button -->
                            <a href="${forecastLink}" target="_blank" 
                               style="display: inline-block; background: var(--forest-green); color: white; 
                                      padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; 
                                      font-weight: 700; font-size: 0.9rem; margin-bottom: 0.75rem;
                                      box-shadow: 0 4px 12px rgba(45, 80, 45, 0.3);">
                                üèîÔ∏è Full Forecast ‚Üí
                            </a>
                            
                            <!-- Quick Links -->
                            <div style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap;">
                                <a href="https://nwac.us/observations/" target="_blank" 
                                   style="color: var(--forest-green); font-size: 0.75rem; text-decoration: none;">
                                    üëÅÔ∏è Observations
                                </a>
                                <a href="https://nwac.us/weatherdata/" target="_blank" 
                                   style="color: var(--forest-green); font-size: 0.75rem; text-decoration: none;">
                                    üå°Ô∏è Weather Stations
                                </a>
                            </div>
                        </div>
                    `;
                    console.log('‚úÖ Avalanche forecast loaded from API for zone:', config.nwacZone);
                } else {
                    throw new Error('Zone forecast not found in API response');
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Avalanche API failed, showing fallback:', error.message);
                
                // Fallback to static display with link
                content.innerHTML = `
                    <div style="text-align: center;">
                        <!-- Zone Name -->
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--forest-green); margin-bottom: 1rem;">
                            ${zoneName}
                        </div>
                        
                        <!-- Danger Scale Legend -->
                        <div style="background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.7rem; color: var(--topo-gray); text-transform: uppercase; margin-bottom: 0.5rem;">
                                Danger Scale
                            </div>
                            <div style="display: flex; justify-content: center; gap: 0.4rem; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 0.2rem; background: white; padding: 0.3rem 0.5rem; border-radius: 5px;">
                                    <div style="width: 14px; height: 14px; border-radius: 50%; background: #50B848;"></div>
                                    <span style="font-size: 0.65rem; font-weight: 600;">Low</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.2rem; background: white; padding: 0.3rem 0.5rem; border-radius: 5px;">
                                    <div style="width: 14px; height: 14px; border-radius: 50%; background: #FFF200; border: 1px solid #ddd;"></div>
                                    <span style="font-size: 0.65rem; font-weight: 600;">Mod</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.2rem; background: white; padding: 0.3rem 0.5rem; border-radius: 5px;">
                                    <div style="width: 14px; height: 14px; border-radius: 50%; background: #F7941E;"></div>
                                    <span style="font-size: 0.65rem; font-weight: 600;">Cons</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.2rem; background: white; padding: 0.3rem 0.5rem; border-radius: 5px;">
                                    <div style="width: 14px; height: 14px; border-radius: 50%; background: #ED1C24;"></div>
                                    <span style="font-size: 0.65rem; font-weight: 600;">High</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.2rem; background: white; padding: 0.3rem 0.5rem; border-radius: 5px;">
                                    <div style="width: 14px; height: 14px; border-radius: 50%; background: #000000;"></div>
                                    <span style="font-size: 0.65rem; font-weight: 600;">Ext</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Warning -->
                        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 0.75rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.8rem; color: #856404;">
                                ‚ö†Ô∏è <strong>Check NWAC for current conditions</strong>
                            </div>
                        </div>
                        
                        <!-- CTA Button -->
                        <a href="${zoneUrl}" target="_blank" 
                           style="display: inline-block; background: var(--forest-green); color: white; 
                                  padding: 1rem 2rem; border-radius: 10px; text-decoration: none; 
                                  font-weight: 700; font-size: 1rem; margin-bottom: 0.75rem;
                                  box-shadow: 0 4px 12px rgba(45, 80, 45, 0.3);">
                            üèîÔ∏è View Forecast
                        </a>
                        
                        <!-- Quick Links -->
                        <div style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap;">
                            <a href="https://nwac.us/avalanche-forecast/" target="_blank" 
                               style="color: var(--forest-green); font-size: 0.75rem; text-decoration: none;">
                                üìç All Zones
                            </a>
                            <a href="https://nwac.us/observations/" target="_blank" 
                               style="color: var(--forest-green); font-size: 0.75rem; text-decoration: none;">
                                üëÅÔ∏è Observations
                            </a>
                        </div>
                    </div>
                `;
            }
        }

        // ============================================
        // SYNOPTIC DATA API CONFIGURATION
        // Aggregates data from SNOTEL, NWAC, ski resorts, etc.
        // Sign up free at: https://customer.synopticdata.com/signup
        // ============================================
        const SYNOPTIC_TOKEN = 'f26f2eb1c2c04cef95b94b2405949325';
        
        // Zone center coordinates for Synoptic radius search
        const zoneCoordinates = {
            'west-slopes-north': { lat: 48.85, lon: -121.68, name: 'Mt Baker Area' },
            'stevens-pass': { lat: 47.745, lon: -121.089, name: 'Stevens Pass' },
            'west-slopes-central': { lat: 47.50, lon: -121.40, name: 'Central Cascades' },
            'snoqualmie-pass': { lat: 47.40, lon: -121.40, name: 'Snoqualmie Pass' },
            'west-slopes-south': { lat: 46.85, lon: -121.75, name: 'Paradise/Rainier' },
            'east-slopes-north': { lat: 48.50, lon: -120.50, name: 'East North Cascades' },
            'east-slopes-central': { lat: 47.30, lon: -120.60, name: 'Mission Ridge Area' },
            'east-slopes-south': { lat: 46.60, lon: -121.00, name: 'East South Cascades' },
            'olympics': { lat: 47.80, lon: -123.50, name: 'Olympics' },
            'mt-hood': { lat: 45.37, lon: -121.70, name: 'Mt Hood' }
        };

        async function loadWeatherData() {
            const content = document.getElementById('weatherContent');
            console.log('‚õÖ Loading weather data for:', config.location, 'Date:', config.tourDate);
            
            const zoneInfo = zoneCoordinates[config.nwacZone] || zoneCoordinates['stevens-pass'];
            
            try {
                // ============================================
                // ALL WEATHER DATA FROM NATIONAL WEATHER SERVICE
                // ============================================
                const pointsUrl = `https://api.weather.gov/points/${config.location.lat},${config.location.lon}`;
                const pointsResponse = await fetch(pointsUrl);
                
                if (!pointsResponse.ok) {
                    throw new Error(`Weather.gov returned ${pointsResponse.status}`);
                }
                
                const pointsData = await pointsResponse.json();
                const forecastUrl = pointsData.properties.forecast;
                const forecastResponse = await fetch(forecastUrl);
                
                if (!forecastResponse.ok) {
                    throw new Error(`Forecast request returned ${forecastResponse.status}`);
                }
                
                const forecastData = await forecastResponse.json();
                const allPeriods = forecastData.properties.periods;
                
                // Find the forecast period matching the selected tour date
                const tourDate = new Date(config.tourDate + 'T12:00:00');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const daysFromNow = Math.round((tourDate - today) / (1000 * 60 * 60 * 24));
                
                console.log('üìÖ Looking for forecast:', daysFromNow, 'days from now');
                
                // NWS returns day/night pairs. Find the daytime period for our date.
                let selectedPeriod = allPeriods[0]; // Default to current
                let nextPeriod = allPeriods[1]; // For day/night pair
                
                if (daysFromNow > 0) {
                    // Find the period that matches our target date
                    for (let i = 0; i < allPeriods.length; i++) {
                        const period = allPeriods[i];
                        const periodDate = new Date(period.startTime);
                        periodDate.setHours(0, 0, 0, 0);
                        const periodDaysFromNow = Math.round((periodDate - today) / (1000 * 60 * 60 * 24));
                        
                        if (periodDaysFromNow === daysFromNow && period.isDaytime) {
                            selectedPeriod = period;
                            nextPeriod = allPeriods[i + 1] || null; // Night period
                            console.log('üìÖ Found matching period:', period.name);
                            break;
                        }
                    }
                }
                
                const temp = selectedPeriod.temperature;
                const windSpeed = selectedPeriod.windSpeed;
                const periodName = selectedPeriod.name;
                const nightTemp = nextPeriod ? nextPeriod.temperature : null;
                
                console.log('‚úÖ NWS Weather loaded for', periodName, ':', { temp, windSpeed, conditions: selectedPeriod.shortForecast });
                
                // ============================================
                // SNOW DATA FROM SYNOPTIC DATA API
                // Aggregates SNOTEL, NWAC, ski resorts, etc.
                // ============================================
                let snowDepth = '--';
                let newSnow24h = '--';
                let newSnow7d = '--';
                let snowDataSource = '';
                let snowDataWorking = false;
                
                // Helper function to safely extract numeric value from Synoptic observation
                const extractValue = (obs, key) => {
                    if (!obs || !obs[key]) return null;
                    const data = obs[key];
                    // Handle direct number
                    if (typeof data === 'number') return data;
                    // Handle {value: X} object
                    if (typeof data === 'object' && data.value != null) return data.value;
                    // Handle array of values - take most recent (last)
                    if (Array.isArray(data) && data.length > 0) {
                        const last = data[data.length - 1];
                        if (typeof last === 'number') return last;
                        if (typeof last === 'object' && last.value != null) return last.value;
                    }
                    return null;
                };
                
                // Helper to find any key containing a pattern
                const findObsKey = (obs, patterns) => {
                    if (!obs) return null;
                    const keys = Object.keys(obs);
                    for (const pattern of patterns) {
                        const match = keys.find(k => k.toLowerCase().includes(pattern.toLowerCase()));
                        if (match) return match;
                    }
                    return null;
                };
                
                try {
                    console.log('‚ùÑÔ∏è Fetching Synoptic snow data for:', zoneInfo.name);
                    console.log('‚ùÑÔ∏è Coordinates:', zoneInfo.lat, zoneInfo.lon);
                    
                    // Primary request: Get latest observations from nearby stations
                    const synopticUrl = `https://api.synopticdata.com/v2/stations/latest?` +
                        `token=${SYNOPTIC_TOKEN}` +
                        `&radius=${zoneInfo.lat},${zoneInfo.lon},50` +  // 50 mile radius
                        `&vars=snow_depth,snow_accum,snow_accum_24_hour,precip_accum_24_hour,precip_accum_one_hour` +
                        `&within=1440` +  // Data within last 24 hours (minutes)
                        `&units=english` +
                        `&status=active`;
                    
                    console.log('‚ùÑÔ∏è Synoptic URL:', synopticUrl);
                    const synopticResponse = await fetch(synopticUrl);
                    
                    if (!synopticResponse.ok) {
                        const errorText = await synopticResponse.text();
                        console.error('‚ùÑÔ∏è Synoptic HTTP error:', synopticResponse.status, errorText);
                        throw new Error(`HTTP ${synopticResponse.status}`);
                    }
                    
                    const synopticData = await synopticResponse.json();
                    console.log('‚ùÑÔ∏è Synoptic response:', synopticData);
                    
                    // Check API response status
                    if (synopticData.SUMMARY) {
                        console.log('‚ùÑÔ∏è API Response Code:', synopticData.SUMMARY.RESPONSE_CODE);
                        console.log('‚ùÑÔ∏è API Message:', synopticData.SUMMARY.RESPONSE_MESSAGE);
                        console.log('‚ùÑÔ∏è Stations found:', synopticData.SUMMARY.NUMBER_OF_OBJECTS);
                    }
                    
                    if (synopticData.SUMMARY?.RESPONSE_CODE !== 1) {
                        console.warn('‚ùÑÔ∏è Synoptic API error:', synopticData.SUMMARY?.RESPONSE_MESSAGE);
                        throw new Error(synopticData.SUMMARY?.RESPONSE_MESSAGE || 'API error');
                    }
                    
                    if (synopticData.STATION && synopticData.STATION.length > 0) {
                        // Log all stations for debugging
                        console.log('‚ùÑÔ∏è Available stations:');
                        synopticData.STATION.forEach((s, i) => {
                            const obs = s.OBSERVATIONS || {};
                            const keys = Object.keys(obs);
                            console.log(`  ${i + 1}. ${s.NAME} (${s.STID}) - ${s.ELEVATION}ft - Keys: ${keys.join(', ')}`);
                        });
                        
                        // Find best station: prioritize stations with snow_depth data at high elevation
                        let bestStation = null;
                        let bestScore = -1;
                        
                        synopticData.STATION.forEach(station => {
                            const elev = parseFloat(station.ELEVATION) || 0;
                            const obs = station.OBSERVATIONS || {};
                            const keys = Object.keys(obs);
                            
                            // Score based on: has snow data (100 pts) + elevation bonus
                            let score = elev / 100; // Base score from elevation
                            
                            // Bonus for snow-specific data
                            if (keys.some(k => k.toLowerCase().includes('snow_depth'))) score += 200;
                            if (keys.some(k => k.toLowerCase().includes('snow_accum'))) score += 150;
                            if (keys.some(k => k.toLowerCase().includes('precip'))) score += 50;
                            
                            if (score > bestScore) {
                                bestScore = score;
                                bestStation = station;
                            }
                        });
                        
                        if (bestStation) {
                            const obs = bestStation.OBSERVATIONS || {};
                            snowDataSource = `${bestStation.NAME || bestStation.STID} (${Math.round(bestStation.ELEVATION)}')`;
                            snowDataWorking = true;
                            
                            console.log('‚ùÑÔ∏è Selected station:', bestStation.NAME, 'Score:', bestScore);
                            console.log('‚ùÑÔ∏è Station observations:', obs);
                            
                            // Extract snow depth
                            const depthKey = findObsKey(obs, ['snow_depth', 'snowdepth']);
                            if (depthKey) {
                                const depth = extractValue(obs, depthKey);
                                if (depth != null && depth >= 0) {
                                    snowDepth = Math.round(depth) + '"';
                                    console.log('‚úÖ Snow depth:', depth, 'from', depthKey);
                                }
                            }
                            
                            // Extract 24hr snow accumulation
                            const snow24Key = findObsKey(obs, ['snow_accum_24', 'snow_24', 'snow_accum']);
                            if (snow24Key) {
                                const snow24 = extractValue(obs, snow24Key);
                                if (snow24 != null && snow24 >= 0) {
                                    newSnow24h = Math.round(snow24 * 10) / 10 + '"';
                                    console.log('‚úÖ 24hr snow:', snow24, 'from', snow24Key);
                                }
                            }
                            
                            // Fallback: estimate from precipitation (10:1 ratio)
                            if (newSnow24h === '--') {
                                const precipKey = findObsKey(obs, ['precip_accum_24', 'precip_24', 'precip_accum']);
                                if (precipKey) {
                                    const precip = extractValue(obs, precipKey);
                                    if (precip != null && precip > 0) {
                                        const estimatedSnow = Math.round(precip * 10);
                                        newSnow24h = estimatedSnow + '"*';
                                        console.log('‚úÖ 24hr snow (estimated from precip):', precip, '* 10 =', estimatedSnow);
                                    }
                                }
                            }
                        }
                        
                        // Second request: Get 7-day snow accumulation from timeseries
                        try {
                            const now = new Date();
                            const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            
                            // Format dates as YYYYMMDDHHmm
                            const formatDate = (d) => {
                                return d.toISOString().replace(/[-:T]/g, '').slice(0, 12);
                            };
                            
                            const timeseriesUrl = `https://api.synopticdata.com/v2/stations/timeseries?` +
                                `token=${SYNOPTIC_TOKEN}` +
                                `&radius=${zoneInfo.lat},${zoneInfo.lon},50` +
                                `&start=${formatDate(sevenDaysAgo)}&end=${formatDate(now)}` +
                                `&vars=snow_depth,precip_accum` +
                                `&units=english` +
                                `&obtimezone=local`;
                            
                            console.log('‚ùÑÔ∏è Fetching 7-day timeseries...');
                            const tsResponse = await fetch(timeseriesUrl);
                            
                            if (tsResponse.ok) {
                                const tsData = await tsResponse.json();
                                console.log('‚ùÑÔ∏è Timeseries stations:', tsData.SUMMARY?.NUMBER_OF_OBJECTS || 0);
                                
                                if (tsData.STATION && tsData.STATION.length > 0) {
                                    // Find station with snow_depth timeseries
                                    for (const station of tsData.STATION) {
                                        const obs = station.OBSERVATIONS || {};
                                        const depthKey = Object.keys(obs).find(k => k.includes('snow_depth'));
                                        
                                        if (depthKey && Array.isArray(obs[depthKey])) {
                                            const depths = obs[depthKey].filter(v => v != null && !isNaN(v));
                                            if (depths.length >= 2) {
                                                // Calculate total new snow as max increase
                                                let totalNewSnow = 0;
                                                for (let i = 1; i < depths.length; i++) {
                                                    const increase = depths[i] - depths[i-1];
                                                    if (increase > 0) totalNewSnow += increase;
                                                }
                                                if (totalNewSnow > 0) {
                                                    newSnow7d = Math.round(totalNewSnow) + '"';
                                                    console.log('‚úÖ 7-day snow from depth changes:', totalNewSnow, 'from', station.NAME);
                                                    break;
                                                }
                                            }
                                        }
                                    }
                                    
                                    // Fallback: use precip accumulation
                                    if (newSnow7d === '--') {
                                        for (const station of tsData.STATION) {
                                            const obs = station.OBSERVATIONS || {};
                                            const precipKey = Object.keys(obs).find(k => k.includes('precip_accum'));
                                            
                                            if (precipKey && Array.isArray(obs[precipKey])) {
                                                const precips = obs[precipKey].filter(v => v != null && !isNaN(v));
                                                if (precips.length >= 2) {
                                                    const totalPrecip = Math.max(...precips) - Math.min(...precips);
                                                    if (totalPrecip > 0) {
                                                        newSnow7d = Math.round(totalPrecip * 10) + '"*';
                                                        console.log('‚úÖ 7-day snow (from precip):', totalPrecip * 10, 'from', station.NAME);
                                                        break;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        } catch (tsErr) {
                            console.warn('‚ùÑÔ∏è Timeseries request failed:', tsErr.message);
                        }
                        
                    } else {
                        console.warn('‚ùÑÔ∏è No stations found in radius');
                    }
                    
                } catch (synopticErr) {
                    console.error('‚ùÑÔ∏è Synoptic API error:', synopticErr.message);
                    
                    // Fallback to Open-Meteo if Synoptic fails
                    console.log('‚ùÑÔ∏è Falling back to Open-Meteo...');
                    try {
                        const openMeteoUrl = `https://api.open-meteo.com/v1/forecast?` +
                            `latitude=${zoneInfo.lat}&longitude=${zoneInfo.lon}` +
                            `&current=snow_depth&daily=snowfall_sum` +
                            `&timezone=America/Los_Angeles&past_days=7`;
                        
                        const meteoResponse = await fetch(openMeteoUrl);
                        if (meteoResponse.ok) {
                            const meteoData = await meteoResponse.json();
                            snowDataWorking = true;
                            snowDataSource = `${zoneInfo.name} (model)`;
                            
                            if (meteoData.current?.snow_depth != null) {
                                snowDepth = Math.round(meteoData.current.snow_depth / 2.54) + '"';
                            }
                            if (meteoData.daily?.snowfall_sum) {
                                const sum = meteoData.daily.snowfall_sum.reduce((a, b) => a + (b || 0), 0);
                                newSnow7d = Math.round(sum / 2.54) + '"';
                            }
                            console.log('‚úÖ Open-Meteo fallback data:', { snowDepth, newSnow7d });
                        }
                    } catch (fallbackErr) {
                        console.warn('‚ùÑÔ∏è Fallback also failed:', fallbackErr.message);
                    }
                }
                
                // ============================================
                // RENDER WEATHER DISPLAY
                // ============================================
                const isToday = daysFromNow === 0;
                const dateLabel = isToday ? 'Current' : periodName;
                
                // Calculate 7-day snow forecast from NWS periods
                let snowForecastHtml = '';
                try {
                    const forecastDays = [];
                    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    
                    // Group periods by day and extract snow/precipitation info
                    for (let i = 0; i < Math.min(allPeriods.length, 14); i++) {
                        const period = allPeriods[i];
                        if (!period.isDaytime) continue; // Only use daytime periods
                        
                        const periodDate = new Date(period.startTime);
                        const dayName = dayNames[periodDate.getDay()];
                        const forecast = period.shortForecast.toLowerCase();
                        const detailed = period.detailedForecast.toLowerCase();
                        
                        // Check for snow in forecast
                        let snowAmount = '';
                        let hasSnow = forecast.includes('snow') || detailed.includes('snow');
                        
                        // Try to extract snow amounts from detailed forecast
                        const snowMatch = detailed.match(/(\d+)\s*to\s*(\d+)\s*inch/i) || 
                                         detailed.match(/around\s*(\d+)\s*inch/i) ||
                                         detailed.match(/(\d+)\s*inch/i);
                        
                        if (snowMatch) {
                            if (snowMatch[2]) {
                                snowAmount = `${snowMatch[1]}-${snowMatch[2]}"`;
                            } else {
                                snowAmount = `${snowMatch[1]}"`;
                            }
                        } else if (hasSnow) {
                            // Check for trace/light/heavy descriptors
                            if (detailed.includes('heavy snow')) snowAmount = '4"+';
                            else if (detailed.includes('moderate snow')) snowAmount = '2-4"';
                            else if (detailed.includes('light snow')) snowAmount = '<2"';
                            else if (detailed.includes('snow likely')) snowAmount = '1-3"';
                            else if (detailed.includes('chance of snow')) snowAmount = 'Poss';
                            else if (detailed.includes('snow showers')) snowAmount = '1-2"';
                            else snowAmount = '‚ùÑÔ∏è';
                        }
                        
                        // Weather icon
                        let icon = '‚òÄÔ∏è';
                        if (forecast.includes('snow')) icon = 'üå®Ô∏è';
                        else if (forecast.includes('rain') && forecast.includes('snow')) icon = 'üå®Ô∏è';
                        else if (forecast.includes('rain')) icon = 'üåßÔ∏è';
                        else if (forecast.includes('shower')) icon = 'üå¶Ô∏è';
                        else if (forecast.includes('cloud')) icon = '‚òÅÔ∏è';
                        else if (forecast.includes('partly')) icon = '‚õÖ';
                        else if (forecast.includes('fog')) icon = 'üå´Ô∏è';
                        
                        forecastDays.push({
                            day: dayName,
                            icon: icon,
                            high: period.temperature,
                            snow: snowAmount,
                            hasSnow: hasSnow
                        });
                        
                        if (forecastDays.length >= 7) break;
                    }
                    
                    // Calculate total projected snow
                    let totalSnowMin = 0;
                    let totalSnowMax = 0;
                    forecastDays.forEach(d => {
                        if (d.snow) {
                            const match = d.snow.match(/(\d+)(?:-(\d+))?/);
                            if (match) {
                                totalSnowMin += parseInt(match[1]) || 0;
                                totalSnowMax += parseInt(match[2] || match[1]) || 0;
                            }
                        }
                    });
                    
                    const totalSnowStr = totalSnowMax > 0 
                        ? (totalSnowMin === totalSnowMax ? `${totalSnowMin}"` : `${totalSnowMin}-${totalSnowMax}"`)
                        : 'None';
                    
                    snowForecastHtml = `
                        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <div style="font-size: 0.7rem; color: #1565c0; text-transform: uppercase; letter-spacing: 0.5px;">
                                    üå®Ô∏è 7-Day Snow Forecast
                                </div>
                                <div style="background: ${totalSnowMax > 0 ? '#1565c0' : '#78909c'}; color: white; padding: 0.25rem 0.6rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                    ${totalSnowStr} Total
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; gap: 0.25rem; overflow-x: auto;">
                                ${forecastDays.map((d, i) => `
                                    <div style="text-align: center; min-width: 42px; padding: 0.4rem 0.2rem; 
                                                ${i === 0 ? 'background: rgba(21, 101, 192, 0.1); border-radius: 6px;' : ''}
                                                ${d.hasSnow ? 'background: rgba(21, 101, 192, 0.15); border-radius: 6px;' : ''}">
                                        <div style="font-size: 0.65rem; color: #666; font-weight: ${i === 0 ? '700' : '500'};">${d.day}</div>
                                        <div style="font-size: 1.1rem; margin: 0.2rem 0;">${d.icon}</div>
                                        <div style="font-size: 0.7rem; font-weight: 600; color: #333;">${d.high}¬∞</div>
                                        ${d.snow ? `<div style="font-size: 0.65rem; color: #1565c0; font-weight: 600; margin-top: 0.15rem;">${d.snow}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } catch (forecastErr) {
                    console.warn('‚ùÑÔ∏è Snow forecast parse error:', forecastErr.message);
                }
                
                content.innerHTML = `
                    <div style="text-align: center; padding: 0.5rem 0;">
                        <!-- Forecast period label -->
                        ${!isToday ? `
                        <div style="background: var(--forest-green); color: white; padding: 0.4rem 0.8rem; border-radius: 6px; display: inline-block; margin-bottom: 0.75rem; font-size: 0.8rem; font-weight: 600;">
                            üìÖ Forecast for ${periodName}
                        </div>
                        ` : ''}
                        
                        <!-- Temperature from NWS -->
                        <div style="margin-bottom: 1.25rem;">
                            <div style="font-size: 3rem; font-weight: 700; color: var(--forest-green); line-height: 1;">
                                ${temp}¬∞<span style="font-size: 1.25rem;">F</span>
                            </div>
                            <div style="font-size: 1rem; color: var(--topo-gray); margin-top: 0.4rem;">
                                ${selectedPeriod.shortForecast}
                            </div>
                            ${nightTemp !== null ? `
                            <div style="font-size: 0.85rem; color: var(--topo-gray); margin-top: 0.25rem;">
                                üåô Night: ${nightTemp}¬∞F
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Weather stats from NWS -->
                        <div style="display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 1.25rem; flex-wrap: wrap;">
                            <div style="text-align: center; background: var(--cream); padding: 0.6rem 1rem; border-radius: 8px;">
                                <div style="font-size: 0.65rem; color: var(--topo-gray); text-transform: uppercase;">Wind</div>
                                <div style="font-size: 1rem; font-weight: 600; color: var(--forest-green);">üí® ${windSpeed}</div>
                            </div>
                            <div style="text-align: center; background: var(--cream); padding: 0.6rem 1rem; border-radius: 8px;">
                                <div style="font-size: 0.65rem; color: var(--topo-gray); text-transform: uppercase;">High / Low</div>
                                <div style="font-size: 1rem; font-weight: 600; color: var(--forest-green);">‚òÄÔ∏è ${temp}¬∞ ${nightTemp !== null ? `/ üåô ${nightTemp}¬∞` : ''}</div>
                            </div>
                        </div>
                        
                        <!-- Snow Data from Open-Meteo -->
                        <div style="background: linear-gradient(135deg, #e8f4fd 0%, #d4e9f7 100%); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.7rem; color: #1565c0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">
                                ‚ùÑÔ∏è Recent Snow ${!isToday ? '(Current)' : ''}
                            </div>
                            <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                                <div style="text-align: center; min-width: 70px;">
                                    <div style="font-size: 1.4rem; font-weight: 700; color: #1565c0;">${snowDepth}</div>
                                    <div style="font-size: 0.65rem; color: var(--topo-gray);">Base Depth</div>
                                </div>
                                <div style="text-align: center; min-width: 70px;">
                                    <div style="font-size: 1.4rem; font-weight: 700; color: #1565c0;">${newSnow24h}</div>
                                    <div style="font-size: 0.65rem; color: var(--topo-gray);">Last 24hrs</div>
                                </div>
                                <div style="text-align: center; min-width: 70px;">
                                    <div style="font-size: 1.4rem; font-weight: 700; color: #1565c0;">${newSnow7d}</div>
                                    <div style="font-size: 0.65rem; color: var(--topo-gray);">Last 7 Days</div>
                                </div>
                            </div>
                            ${snowDataWorking ? `
                            <div style="font-size: 0.7rem; color: var(--topo-gray); margin-top: 0.5rem;">
                                üìç ${snowDataSource}
                            </div>
                            ` : `
                            <div style="font-size: 0.7rem; color: #856404; margin-top: 0.5rem; background: #fff3cd; padding: 0.5rem; border-radius: 6px;">
                                ‚ö†Ô∏è Snow data loading...
                            </div>
                            `}
                        </div>
                        
                        <!-- 7-Day Snow Forecast -->
                        ${snowForecastHtml}
                        
                        <!-- NWS Detailed Forecast -->
                        <div style="background: var(--cream); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.7rem; color: var(--topo-gray); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.4rem;">
                                ${periodName} Forecast
                            </div>
                            <div style="font-size: 0.85rem; color: #333; line-height: 1.5;">
                                ${selectedPeriod.detailedForecast}
                            </div>
                        </div>
                        
                        <!-- Data source links -->
                        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                            <a href="https://opensnow.com/location/stevenspass" target="_blank" 
                               style="display: inline-flex; align-items: center; gap: 0.3rem; color: var(--forest-green); 
                                      font-size: 0.75rem; text-decoration: none; padding: 0.4rem 0.8rem; 
                                      background: var(--cream); border-radius: 6px;">
                                üéø OpenSnow
                            </a>
                            <a href="https://nwac.us/weatherdata/" target="_blank" 
                               style="display: inline-flex; align-items: center; gap: 0.3rem; color: var(--forest-green); 
                                      font-size: 0.75rem; text-decoration: none; padding: 0.4rem 0.8rem; 
                                      background: var(--cream); border-radius: 6px;">
                                üèîÔ∏è NWAC Stations
                            </a>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('‚ùå Weather API failed:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p style="color: var(--warning-red); font-size: 1.1rem; margin-bottom: 1rem;">
                            ‚ö†Ô∏è Unable to fetch weather from Weather.gov
                        </p>
                        <p style="font-size: 0.9rem; color: var(--topo-gray); margin-bottom: 1rem;">
                            Error: ${error.message}
                        </p>
                        <p style="font-size: 0.85rem; color: var(--topo-gray);">
                            Check <a href="https://www.weather.gov/" target="_blank" style="color: var(--forest-green);">Weather.gov</a> or 
                            <a href="https://www.mountain-forecast.com/" target="_blank" style="color: var(--forest-green);">Mountain-Forecast.com</a>
                        </p>
                    </div>
                `;
            }
        }

        function refreshTours() {
            const btn = document.getElementById('refreshToursBtn');
            const tours = toursByZone[config.nwacZone] || [];
            
            // Visual feedback
            btn.innerHTML = 'üîÑ Loading...';
            btn.disabled = true;
            btn.style.opacity = '0.7';
            
            // Check if we have enough tours to show new ones
            const shownCount = config.excludedTours ? config.excludedTours.length : 0;
            const remainingTours = tours.length - shownCount;
            
            if (remainingTours < 5 && tours.length > 5) {
                // Reset excluded list to start fresh
                config.excludedTours = [];
            }
            
            // Small delay for visual feedback
            setTimeout(() => {
                loadTours();
                btn.innerHTML = 'üîÑ New Top 5';
                btn.disabled = false;
                btn.style.opacity = '1';
            }, 300);
        }

        async function loadTours() {
            const content = document.getElementById('toursContent');
            console.log('üìç Loading tours for zone:', config.nwacZone, 'with fitness:', config.fitnessLevel, 'downhill:', config.downhillSkill, 'touring:', config.touringSkill);
            
            const zoneName = getZoneName(config.nwacZone);
            
            // Update the sort message
            document.getElementById('toursSortMessage').innerHTML = `
                üí° Showing <strong>top 5 tours</strong> for <strong>${zoneName}</strong> based on:
                <br>Energy: <strong>${fitnessLabels[config.fitnessLevel]}</strong> (${config.fitnessLevel}/10) ‚Ä¢ 
                Downhill: <strong>${skillLabels[config.downhillSkill]}</strong> ‚Ä¢ 
                Touring: <strong>${skillLabels[config.touringSkill]}</strong>
            `;
            
            const tours = toursByZone[config.nwacZone] || [];
            
            if (tours.length === 0) {
                content.innerHTML = `
                    <div class="tour-card">
                        <div style="text-align: center; padding: 2rem;">
                            <p style="font-size: 1.1rem; color: var(--topo-gray); margin-bottom: 1rem;">
                                No sample tours available for this zone yet.
                            </p>
                            <p style="font-size: 0.9rem; color: var(--topo-gray);">
                                Add your own tours by editing the <code>toursByZone</code> object!
                            </p>
                        </div>
                    </div>
                `;
                return;
            }
            
            console.log(`‚úÖ Loaded ${tours.length} tours for ${config.nwacZone} - Calculating recommendations with fitness ${config.fitnessLevel}/10`);
            
            // Calculate recommendations for all tours
            const toursWithRecs = tours.map((tour) => {
                const rec = calculateRecommendation(tour);
                return { tour, rec };
            });
            
            // Sort by recommendation score (highest first) with randomization for similar scores
            toursWithRecs.sort((a, b) => {
                const scoreDiff = b.rec.score - a.rec.score;
                // If scores are within 2 points, randomize order
                if (Math.abs(scoreDiff) <= 2) {
                    return Math.random() - 0.5;
                }
                return scoreDiff;
            });
            
            // Filter out previously shown tours if refreshing
            let availableTours = toursWithRecs;
            if (config.excludedTours && config.excludedTours.length > 0) {
                availableTours = toursWithRecs.filter(t => 
                    !config.excludedTours.includes(t.tour.name)
                );
                // If we've excluded too many, reset
                if (availableTours.length < 5) {
                    config.excludedTours = [];
                    availableTours = toursWithRecs;
                }
            }
            
            // Take top 5 from available tours
            const topTours = availableTours.slice(0, 5);
            
            // Track these tours as shown
            if (!config.excludedTours) config.excludedTours = [];
            topTours.forEach(t => {
                if (!config.excludedTours.includes(t.tour.name)) {
                    config.excludedTours.push(t.tour.name);
                }
            });
            
            console.log('üìä Top 5 tours by score:', topTours.map(t => ({ 
                name: t.tour.name, 
                score: t.rec.score, 
                level: t.rec.level 
            })));
            
            // Generate HTML for top 5 tours
            content.innerHTML = topTours.map(({ tour, rec }, index) => {
                return generateTourCard(tour, rec, index + 1);
            }).join('');
            
            // Add note if there are more tours available
            if (tours.length > 5) {
                const remainingTours = tours.length - (config.excludedTours ? config.excludedTours.length : 0);
                content.innerHTML += `
                    <div style="text-align: center; padding: 1.5rem; color: var(--topo-gray); font-size: 0.9rem; background: var(--cream); border-radius: 8px; margin-top: 1rem;">
                        <p style="margin: 0;">
                            üìä Showing 5 of ${tours.length} tours in this zone
                            ${remainingTours > 0 && remainingTours < tours.length ? 
                                `<br><span style="font-size: 0.8rem;">Click "New Top 5" to see ${Math.min(5, remainingTours)} more options</span>` : 
                                ''}
                        </p>
                    </div>
                `;
            }
            
            // Update My Tours button count
            const logCount = Object.keys(getTourLogs()).length;
            const myToursBtn = document.getElementById('myToursToggleBtn');
            if (myToursBtn && !myToursBtn.innerHTML.includes('Hide')) {
                myToursBtn.innerHTML = `üìñ My Tours (${logCount})`;
            }
        }

        function calculateRecommendation(tour) {
            const fitness = config.fitnessLevel;
            const downhillSkill = config.downhillSkill;
            const touringSkill = config.touringSkill;
            const elevGain = tour.elevationGain;
            const distance = tour.distance;
            const terrain = tour.terrain.toLowerCase();
            const maxElev = tour.maxElevation;
            const aspect = (tour.aspect || '').toLowerCase();
            
            let score = 0;
            let warnings = [];
            let bonuses = [];
            
            // ============================================
            // TOUR DIFFICULTY RATING (1-10 scale)
            // ============================================
            
            // Physical difficulty based on elevation gain (more granular)
            // Typical day tour ranges from 2000-4000ft gain
            let physicalDifficulty = 1;
            if (elevGain < 1000) physicalDifficulty = 1;
            else if (elevGain < 1500) physicalDifficulty = 2;
            else if (elevGain < 2000) physicalDifficulty = 3;
            else if (elevGain < 2500) physicalDifficulty = 4;
            else if (elevGain < 3000) physicalDifficulty = 5;
            else if (elevGain < 4000) physicalDifficulty = 6;
            else if (elevGain < 5000) physicalDifficulty = 7;
            else if (elevGain < 6500) physicalDifficulty = 8;
            else if (elevGain < 8000) physicalDifficulty = 9;
            else physicalDifficulty = 10;
            
            // Adjust for distance (skinning efficiency matters)
            // Typical day tour is 6-12 miles
            if (distance > 10) physicalDifficulty = Math.min(10, physicalDifficulty + 0.5);
            if (distance > 14) physicalDifficulty = Math.min(10, physicalDifficulty + 0.5);
            if (distance > 18) physicalDifficulty = Math.min(10, physicalDifficulty + 1);
            if (distance > 25) physicalDifficulty = Math.min(10, physicalDifficulty + 1);
            
            // Calculate vertical-to-distance ratio (steeper = harder skinning but shorter)
            const vertPerMile = elevGain / Math.max(distance, 1);
            
            // Technical difficulty based on terrain description (for downhill skiing)
            let technicalDifficulty = 3; // default moderate
            
            // Slope angle parsing
            if (terrain.includes('<25') || terrain.includes('< 25') || terrain.includes('mellow')) {
                technicalDifficulty = 2;
            }
            if (terrain.includes('25-30') || terrain.includes('<30') || terrain.includes('treed')) {
                technicalDifficulty = 2;
            }
            if (terrain.includes('30-35') || terrain.includes('moderate')) {
                technicalDifficulty = 4;
            }
            if (terrain.includes('35-40') || terrain.includes('steep')) {
                technicalDifficulty = 5;
            }
            if (terrain.includes('40-45') || terrain.includes('very steep')) {
                technicalDifficulty = 7;
            }
            if (terrain.includes('45-50') || terrain.includes('40-50')) {
                technicalDifficulty = 8;
            }
            if (terrain.includes('>50') || terrain.includes('50+')) {
                technicalDifficulty = 9;
            }
            
            // Terrain features that add difficulty
            if (terrain.includes('couloir')) technicalDifficulty = Math.max(technicalDifficulty, 8);
            if (terrain.includes('glacier')) technicalDifficulty = Math.max(technicalDifficulty, 6);
            if (terrain.includes('exposed') || terrain.includes('exposure')) technicalDifficulty = Math.min(10, technicalDifficulty + 1);
            if (terrain.includes('ridge')) technicalDifficulty = Math.min(10, technicalDifficulty + 0.5);
            if (terrain.includes('alpine')) technicalDifficulty = Math.min(10, technicalDifficulty + 0.5);
            if (terrain.includes('complex') || terrain.includes('variable')) technicalDifficulty = Math.min(10, technicalDifficulty + 1);
            
            // Easier terrain indicators
            if (terrain.includes('mellow') || terrain.includes('gentle') || terrain.includes('beginner')) {
                technicalDifficulty = Math.max(1, technicalDifficulty - 1);
            }
            if (terrain.includes('road') || terrain.includes('trail')) {
                technicalDifficulty = Math.max(1, technicalDifficulty - 0.5);
            }
            
            // High elevation adds challenge (altitude, weather exposure, navigation)
            if (maxElev > 7000) technicalDifficulty = Math.min(10, technicalDifficulty + 0.5);
            if (maxElev > 9000) technicalDifficulty = Math.min(10, technicalDifficulty + 0.5);
            if (maxElev > 11000) technicalDifficulty = Math.min(10, technicalDifficulty + 1);
            
            // Round to nearest 0.5
            physicalDifficulty = Math.round(physicalDifficulty * 2) / 2;
            technicalDifficulty = Math.round(technicalDifficulty * 2) / 2;
            
            // ============================================
            // FITNESS MATCHING (physical capacity)
            // ============================================
            // Goal: Match tour difficulty to energy level
            // Perfect match = difficulty equals fitness level
            
            const fitnessDiff = fitness - physicalDifficulty;
            
            // Ideal match: tour difficulty is 0-2 points below fitness level
            if (fitnessDiff >= 0 && fitnessDiff <= 2) {
                score += 3;
                bonuses.push('Good match for energy level');
            } else if (fitnessDiff > 2 && fitnessDiff <= 4) {
                // Tour is easier than capacity - fine for easy day
                score += 2;
                bonuses.push('Comfortable day within your capacity');
            } else if (fitnessDiff > 4) {
                // Tour is much easier than capacity
                score += 1;
                if (fitness >= 7) bonuses.push('Easy day - great for recovery');
            } else if (fitnessDiff >= -1 && fitnessDiff < 0) {
                // Slightly challenging
                score += 2;
                bonuses.push('Achievable challenge');
            } else if (fitnessDiff >= -2 && fitnessDiff < -1) {
                // Challenging
                score += 0;
                warnings.push('Physically demanding for current energy');
            } else if (fitnessDiff >= -3 && fitnessDiff < -2) {
                // Hard
                score -= 2;
                warnings.push('Tour exceeds current energy level');
            } else {
                // Way too hard
                score -= 4;
                warnings.push('Tour is too physically demanding today');
            }
            
            // ============================================
            // SKILL MATCHING (separate downhill and touring)
            // ============================================
            // Downhill skill: matches technical terrain difficulty
            // Touring skill: route-finding, avalanche awareness, efficiency
            
            const downhillDiff = downhillSkill - technicalDifficulty;
            
            // Ideal: terrain is at or slightly below downhill skill level
            if (downhillDiff >= 0 && downhillDiff <= 2) {
                score += 3;
                bonuses.push('Terrain matches your skiing ability');
            } else if (downhillDiff > 2 && downhillDiff <= 4) {
                score += 2;
                bonuses.push('Skiing well within your abilities');
            } else if (downhillDiff > 4) {
                score += 1;
                // Very easy terrain for skill level
            } else if (downhillDiff >= -1 && downhillDiff < 0) {
                // Slightly above skill
                score += 1;
                warnings.push('Terrain at the edge of your skiing ability');
            } else if (downhillDiff >= -2 && downhillDiff < -1) {
                // Above skill
                score -= 1;
                warnings.push('Terrain exceeds current skiing ability - go with experienced partners');
            } else if (downhillDiff >= -3 && downhillDiff < -2) {
                // Well above skill
                score -= 3;
                warnings.push('Terrain too technical for current skiing level');
            } else {
                // Way above skill
                score -= 5;
                warnings.push('Not recommended - terrain far exceeds skiing ability');
            }
            
            // Touring skill affects route-finding, complex terrain navigation
            // Higher touring difficulty for longer tours, complex routes, glacier travel
            let touringDifficulty = Math.round((physicalDifficulty + technicalDifficulty) / 2);
            if (terrain.includes('glacier')) touringDifficulty = Math.min(10, touringDifficulty + 2);
            if (terrain.includes('route-finding') || terrain.includes('complex')) touringDifficulty = Math.min(10, touringDifficulty + 1);
            if (distance > 12) touringDifficulty = Math.min(10, touringDifficulty + 1);
            
            const touringDiff = touringSkill - touringDifficulty;
            if (touringDiff >= 0 && touringDiff <= 2) {
                score += 2;
            } else if (touringDiff < 0 && touringDiff >= -2) {
                score -= 1;
                warnings.push('Tour complexity at edge of touring experience');
            } else if (touringDiff < -2) {
                score -= 2;
                warnings.push('Consider simpler tours to build experience');
            }
            
            // ============================================
            // SYNERGY BONUS
            // ============================================
            // Tours that match BOTH fitness and skills get a bonus
            
            if (fitnessDiff >= -1 && fitnessDiff <= 2 && downhillDiff >= -1 && downhillDiff <= 2) {
                score += 2;
                bonuses.push('Great overall match');
            }
            
            // ============================================
            // SPECIAL TERRAIN CONSIDERATIONS
            // ============================================
            
            // Glacier travel requirements
            if (terrain.includes('glacier')) {
                if (touringSkill < 6) {
                    score -= 3;
                    warnings.push('Glacier travel requires crevasse rescue training');
                } else if (touringSkill < 8) {
                    warnings.push('Glacier travel - ensure rope team skills');
                }
            }
            
            // Couloir skiing requirements
            if (terrain.includes('couloir')) {
                if (downhillSkill < 7) {
                    score -= 3;
                    warnings.push('Couloir skiing requires expert skiing ability');
                }
                if (fitness < 6) {
                    score -= 1;
                    warnings.push('Couloir approaches are often strenuous');
                }
            }
            
            // Exposed terrain
            if (terrain.includes('exposed') && skill < 5) {
                score -= 1;
                warnings.push('Exposed terrain requires solid skills');
            }
            
            // High alpine
            if (maxElev > 10000) {
                if (touringSkill < 5) {
                    score -= 1;
                    warnings.push('High alpine requires mountain experience');
                }
                if (fitness < 5) {
                    score -= 1;
                    warnings.push('Altitude adds physical challenge');
                }
            }
            
            // Long days / multi-day indicators
            if (elevGain > 6000 || distance > 20) {
                if (fitness < 6) {
                    score -= 2;
                    warnings.push('Big day - requires high fitness');
                }
                if (touringSkill < 5) {
                    score -= 1;
                    warnings.push('Long tour - navigation and pacing skills important');
                }
            }
            
            // Multi-day tours
            if (elevGain > 10000 || distance > 30) {
                if (touringSkill < 7 || fitness < 7) {
                    score -= 3;
                    warnings.push('Multi-day objective requires advanced fitness and skills');
                }
            }
            
            // ============================================
            // ASPECT CONSIDERATIONS (avalanche terrain)
            // ============================================
            
            if (aspect.includes('north') || aspect.includes('n-facing')) {
                // North aspects hold snow longer, can be more persistent slab prone
                if (touringSkill < 4) {
                    warnings.push('North aspects require avalanche awareness');
                }
            }
            
            // Multiple aspects = more complex avalanche assessment
            if (aspect.includes('multiple') || aspect.includes('all') || aspect.includes('various')) {
                if (touringSkill < 5) {
                    score -= 0.5;
                    warnings.push('Multiple aspects require careful terrain selection');
                }
            }
            
            // ============================================
            // USER RATING BOOST (from logged tours)
            // ============================================
            
            const userLogs = getTourLogHistory(tour.name);
            if (userLogs.length > 0) {
                const avgRating = userLogs.reduce((sum, log) => sum + log.rating, 0) / userLogs.length;
                const wouldRepeatCount = userLogs.filter(log => log.wouldRepeat).length;
                const wouldRepeatRatio = wouldRepeatCount / userLogs.length;
                
                // Boost score based on user's past ratings
                if (avgRating >= 4.5) {
                    score += 2;
                    bonuses.push('You loved this tour! (' + avgRating.toFixed(1) + '‚òÖ)');
                } else if (avgRating >= 3.5) {
                    score += 1;
                    bonuses.push('You enjoyed this previously (' + avgRating.toFixed(1) + '‚òÖ)');
                } else if (avgRating <= 2) {
                    score -= 1;
                    warnings.push('You rated this tour low previously');
                }
                
                // Adjust based on "would repeat"
                if (wouldRepeatRatio >= 0.8) {
                    score += 0.5;
                } else if (wouldRepeatRatio <= 0.2 && userLogs.length >= 2) {
                    score -= 1;
                    warnings.push('You wouldn\'t repeat this tour');
                }
                
                // Slight variety penalty - don't always recommend the same tours
                const lastLog = userLogs[0];
                const daysSinceLastLog = Math.floor((new Date() - new Date(lastLog.date)) / (1000 * 60 * 60 * 24));
                if (daysSinceLastLog < 14) {
                    score -= 0.5; // Small penalty for recently done tours
                } else if (daysSinceLastLog > 365) {
                    score += 0.5; // Bonus for tours you haven't done in a while
                    bonuses.push('Great time to revisit!');
                }
            }
            
            // ============================================
            // GENERATE RECOMMENDATION
            // ============================================
            
            // Remove duplicate warnings/bonuses
            warnings = [...new Set(warnings)];
            bonuses = [...new Set(bonuses)];
            
            const analysisIntro = bonuses.length > 0 ? bonuses[0] + '. ' : '';
            const warningText = warnings.length > 0 ? warnings.join('. ') + '.' : '';
            
            // Determine recommendation level based on score
            // 4 tiers: Good Choice, Doable, Stretch, Not Today
            let level, text;
            if (score >= 3) {
                level = 'go';
                text = '‚úÖ Good Choice';
            } else if (score >= 1) {
                level = 'maybe';
                text = '‚ö†Ô∏è Doable';
            } else if (score >= -2) {
                level = 'maybe';
                text = '‚ö†Ô∏è Stretch';
            } else {
                level = 'no';
                text = 'üõë Not Today';
            }
            
            // Build analysis text
            let analysis = '';
            if (level === 'go') {
                analysis = `${analysisIntro}This tour aligns well with your energy (${fitness}/10) and skill (${skill}/10). ${warningText || 'Enjoy the day!'}`;
            } else if (text.includes('Doable')) {
                analysis = `${analysisIntro}Within reach but consider the challenges. ${warningText || 'Be prepared and conservative.'}`;
            } else if (text.includes('Stretch')) {
                analysis = `${analysisIntro}Pushing your limits. ${warningText || 'Have a backup plan and trusted partners.'}`;
            } else {
                analysis = `${warningText || 'This tour exceeds your current capacity.'} Consider a different objective or wait for a better day.`;
            }
            
            return { 
                level, 
                text, 
                analysis,
                score: Math.round(score * 10) / 10,
                physicalDifficulty,
                technicalDifficulty,
                warnings,
                bonuses
            };
        }

        function generateTourCard(tour, rec, rank = null) {
            const rankBadge = rank ? `<div style="display: inline-block; background: var(--burnt-orange); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-weight: 700; font-size: 0.85rem; margin-right: 0.5rem;">#${rank}</div>` : '';
            
            // Create difficulty bars
            const physBar = createDifficultyBar(rec.physicalDifficulty || 5, 'Physical');
            const techBar = createDifficultyBar(rec.technicalDifficulty || 5, 'Technical');
            
            // Calculate starting elevation (if not provided, estimate from max - gain)
            // Will be updated by API call if trailhead coordinates exist
            const estimatedStart = tour.maxElevation - tour.elevationGain;
            const startElevation = tour.startElevation || estimatedStart;
            const startElevId = `start-elev-${tour.name.replace(/[^a-zA-Z0-9]/g, '-')}`;
            
            // If tour has trailhead coordinates, fetch real elevation
            if (tour.trailheadLat && tour.trailheadLon && !tour.startElevation) {
                fetchTrailheadElevation(tour.trailheadLat, tour.trailheadLon, startElevId);
            }
            
            // Generate Google Maps link and coordinates display
            const hasCoords = tour.trailheadLat && tour.trailheadLon;
            const googleMapsUrl = hasCoords ? `https://www.google.com/maps/dir/?api=1&destination=${tour.trailheadLat},${tour.trailheadLon}` : null;
            const coordsDisplay = hasCoords 
                ? `<a href="${googleMapsUrl}" target="_blank" rel="noopener" style="color: var(--sky-blue); text-decoration: none;">Directions üó∫Ô∏è</a>`
                : '<span style="color: #999;">Not available</span>';
            
            // Generate CalTopo search URL
            const caltopoSearchUrl = `https://caltopo.com/map.html#ll=${hasCoords ? tour.trailheadLat + ',' + tour.trailheadLon : '47.5,-121.5'}&z=14&b=mbt`;
            
            // Check if tour has been logged and get rating info
            const isLogged = isTourLogged(tour.name);
            const avgRating = getTourAverageRating(tour.name);
            const logHistory = getTourLogHistory(tour.name);
            const logCount = logHistory.length;
            
            // Build user rating display
            let userRatingHtml = '';
            if (avgRating !== null) {
                const stars = '‚òÖ'.repeat(Math.round(avgRating)) + '‚òÜ'.repeat(5 - Math.round(avgRating));
                userRatingHtml = `
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                        <span style="color: #FFD700; font-size: 1rem;">${stars}</span>
                        <span style="font-size: 0.8rem; color: var(--topo-gray);">Your rating (${logCount} ${logCount === 1 ? 'trip' : 'trips'})</span>
                    </div>
                `;
            }
            
            // Escape tour name for onclick
            const escapedName = tour.name.replace(/'/g, "\\'");
            const escapedZone = config.nwacZone.replace(/'/g, "\\'");
            
            return `
                <div class="tour-card">
                    <div class="tour-header">
                        <div>
                            <div class="tour-name">${rankBadge}${tour.name}</div>
                            <div class="tour-stats">
                                ${tour.location} ‚Ä¢ ${tour.elevationGain.toLocaleString()} ft gain ‚Ä¢ ${tour.distance} mi RT
                            </div>
                            ${userRatingHtml}
                        </div>
                        <div class="recommendation rec-${rec.level}">${rec.text}</div>
                    </div>
                    <div class="tour-details">
                        <div class="detail-item">
                            <div class="detail-icon">üìç</div>
                            <div class="detail-text">
                                <span class="detail-label">Trailhead</span>
                                <span class="detail-value">${coordsDisplay}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üó∫Ô∏è</div>
                            <div class="detail-text">
                                <span class="detail-label">View Map</span>
                                <span class="detail-value"><a href="${caltopoSearchUrl}" target="_blank" rel="noopener" style="color: var(--forest-green); text-decoration: none;">CalTopo ‚Üó</a></span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üÖøÔ∏è</div>
                            <div class="detail-text">
                                <span class="detail-label">Start Elevation</span>
                                <span class="detail-value" id="${startElevId}">${startElevation.toLocaleString()} ft${tour.trailheadLat ? '' : '*'}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üèîÔ∏è</div>
                            <div class="detail-text">
                                <span class="detail-label">Max Elevation</span>
                                <span class="detail-value">${tour.maxElevation.toLocaleString()} ft</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚õ∞Ô∏è</div>
                            <div class="detail-text">
                                <span class="detail-label">Terrain</span>
                                <span class="detail-value">${tour.terrain}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">üí™</div>
                            <div class="detail-text">
                                <span class="detail-label">Physical</span>
                                ${physBar}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">‚õ∑Ô∏è</div>
                            <div class="detail-text">
                                <span class="detail-label">Technical</span>
                                ${techBar}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; padding: 0.75rem; background: var(--cream); border-radius: 6px; font-size: 0.85rem; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                            <div><strong>Energy:</strong> ${config.fitnessLevel}/10</div>
                            <div><strong>Downhill:</strong> ${config.downhillSkill}/10</div>
                            <div><strong>Touring:</strong> ${config.touringSkill}/10</div>
                        </div>
                        <button class="log-tour-btn ${isLogged ? 'logged' : ''}" onclick="openTourLogModal('${escapedName}', '${escapedZone}')">
                            ${isLogged ? 'üìù Log Again' : 'üìù Log Tour'}
                        </button>
                    </div>
                    <p style="margin-top: 1rem; color: var(--topo-gray); font-size: 0.9rem; line-height: 1.6;">
                        <strong>Analysis:</strong> ${rec.analysis}
                    </p>
                </div>
            `;
        }

        function createDifficultyBar(level, label) {
            const colors = ['#50B848', '#50B848', '#8BC34A', '#FFF200', '#FFC107', '#F7941E', '#FF5722', '#ED1C24', '#D32F2F', '#880E4F'];
            const color = colors[Math.min(level - 1, 9)];
            const width = level * 10;
            return `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="flex: 1; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                        <div style="width: ${width}%; height: 100%; background: ${color}; border-radius: 4px;"></div>
                    </div>
                    <span style="font-size: 0.8rem; font-weight: 600; color: ${color};">${level}/10</span>
                </div>
            `;
        }

        // ============================================
        // TOUR LOGGING SYSTEM
        // Stores user's completed tours with ratings
        // ============================================
        
        const TOUR_LOG_KEY = 'skiTourLogs';
        let currentLogTour = null;
        
        // Get all logged tours from localStorage
        function getTourLogs() {
            try {
                const logs = localStorage.getItem(TOUR_LOG_KEY);
                return logs ? JSON.parse(logs) : {};
            } catch (e) {
                console.error('Error reading tour logs:', e);
                return {};
            }
        }
        
        // Save tour logs to localStorage
        function saveTourLogs(logs) {
            try {
                localStorage.setItem(TOUR_LOG_KEY, JSON.stringify(logs));
                console.log('üíæ Tour logs saved locally:', Object.keys(logs).length, 'entries');
                
                // Also save to cloud if user is signed in
                if (currentUser) {
                    saveTourLogToCloud(logs);
                }
            } catch (e) {
                console.error('Error saving tour logs:', e);
            }
        }
        
        // Generate a unique ID for a tour
        function getTourId(tourName) {
            return tourName.toLowerCase().replace(/[^a-z0-9]/g, '-');
        }
        
        // Check if a tour has been logged
        function isTourLogged(tourName) {
            const logs = getTourLogs();
            const tourId = getTourId(tourName);
            return Object.keys(logs).some(key => key.startsWith(tourId + '_'));
        }
        
        // Get all logs for a specific tour
        function getTourLogHistory(tourName) {
            const logs = getTourLogs();
            const tourId = getTourId(tourName);
            return Object.entries(logs)
                .filter(([key]) => key.startsWith(tourId + '_'))
                .map(([key, value]) => ({ id: key, ...value }))
                .sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        // Get average rating for a tour
        function getTourAverageRating(tourName) {
            const history = getTourLogHistory(tourName);
            if (history.length === 0) return null;
            const sum = history.reduce((acc, log) => acc + log.rating, 0);
            return sum / history.length;
        }
        
        // ============================================
        // WALKTHROUGH MODAL FUNCTIONS
        // ============================================
        
        function openWalkthrough() {
            document.getElementById('walkthroughModal').classList.add('active');
        }
        
        function closeWalkthrough() {
            document.getElementById('walkthroughModal').classList.remove('active');
        }
        
        // ============================================
        // USER PROFILE FUNCTIONS
        // ============================================
        
        const PROFILE_KEY = 'pnw_ski_tours_profile';
        
        function getProfile() {
            try {
                const profile = localStorage.getItem(PROFILE_KEY);
                return profile ? JSON.parse(profile) : null;
            } catch (e) {
                console.error('Error reading profile:', e);
                return null;
            }
        }
        
        function saveProfileToStorage(profile) {
            try {
                localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
                console.log('üíæ Profile saved locally');
                
                // Also save to cloud if user is signed in
                if (currentUser) {
                    saveProfileToCloud(profile);
                }
            } catch (e) {
                console.error('Error saving profile:', e);
            }
        }
        
        async function saveProfileToCloud(profile) {
            if (!currentUser) return;
            
            try {
                updateSyncStatus('syncing');
                await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').set({
                    ...profile,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                updateSyncStatus('synced');
                console.log('‚òÅÔ∏è Profile synced to cloud');
            } catch (e) {
                console.error('Error saving profile to cloud:', e);
                updateSyncStatus('error');
            }
        }
        
        async function syncProfile() {
            if (!currentUser) return;
            
            try {
                const doc = await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').get();
                if (doc.exists) {
                    const cloudProfile = doc.data();
                    const localProfile = getProfile();
                    
                    // If cloud is newer or local doesn't exist, use cloud
                    if (!localProfile || (cloudProfile.updatedAt && (!localProfile.updatedAt || cloudProfile.updatedAt.toDate() > new Date(localProfile.updatedAt)))) {
                        localStorage.setItem(PROFILE_KEY, JSON.stringify(cloudProfile));
                        console.log('‚òÅÔ∏è Profile synced from cloud');
                    }
                }
                renderMyProfile();
            } catch (e) {
                console.error('Error syncing profile:', e);
            }
        }
        
        function toggleMyProfile() {
            const section = document.getElementById('myProfileSection');
            const btn = document.getElementById('myProfileToggleBtn');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                btn.innerHTML = 'üë§ Hide Profile';
                renderMyProfile();
            } else {
                section.style.display = 'none';
                btn.innerHTML = 'üë§ My Profile';
            }
        }
        
        function openProfileModal() {
            const profile = getProfile() || {};
            
            // Populate form fields
            document.getElementById('profileName').value = profile.name || '';
            document.getElementById('profilePhone').value = profile.phone || '';
            document.getElementById('profileSocial').value = profile.social || '';
            document.getElementById('profileCity').value = profile.city || '';
            document.getElementById('profileIntro').value = profile.intro || '';
            
            document.getElementById('profileExperience').value = profile.experience || '';
            document.getElementById('profileSkillLevel').value = profile.skillLevel || 3;
            updateProfileSkillLabel();
            document.getElementById('profileTourTypes').value = profile.tourTypes || '';
            document.getElementById('profileSkiPass').value = profile.skiPass || '';
            document.getElementById('profileTraining').value = profile.training || '';
            document.getElementById('profileGear').value = profile.gear || '';
            
            document.getElementById('profilePace').value = profile.pace || '';
            document.getElementById('profileAvailability').value = profile.availability || '';
            document.getElementById('profileFavoriteAreas').value = profile.favoriteAreas || '';
            document.getElementById('profileTravel').value = profile.travel || '';
            document.getElementById('profileCanDrive').value = profile.canDrive || '';
            
            document.getElementById('profileFoodStop').value = profile.foodStop || '';
            document.getElementById('profileSnack').value = profile.snack || '';
            
            document.getElementById('profileModal').classList.add('active');
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }
        
        function updateProfileSkillLabel() {
            const level = parseInt(document.getElementById('profileSkillLevel').value);
            const labels = ['Beginner', 'Beginner-Int', 'Intermediate', 'Int-Advanced', 'Expert'];
            document.getElementById('profileSkillLabel').textContent = labels[level - 1];
        }
        
        // Add event listener for skill slider
        document.addEventListener('DOMContentLoaded', function() {
            const skillSlider = document.getElementById('profileSkillLevel');
            if (skillSlider) {
                skillSlider.addEventListener('input', updateProfileSkillLabel);
            }
        });
        
        function saveProfile() {
            const profile = {
                // Basic Info
                name: document.getElementById('profileName').value.trim(),
                phone: document.getElementById('profilePhone').value.trim(),
                social: document.getElementById('profileSocial').value.trim(),
                city: document.getElementById('profileCity').value.trim(),
                intro: document.getElementById('profileIntro').value.trim(),
                
                // Experience
                experience: document.getElementById('profileExperience').value.trim(),
                skillLevel: parseInt(document.getElementById('profileSkillLevel').value),
                tourTypes: document.getElementById('profileTourTypes').value.trim(),
                skiPass: document.getElementById('profileSkiPass').value.trim(),
                training: document.getElementById('profileTraining').value.trim(),
                gear: document.getElementById('profileGear').value,
                
                // Preferences
                pace: document.getElementById('profilePace').value,
                availability: document.getElementById('profileAvailability').value,
                favoriteAreas: document.getElementById('profileFavoriteAreas').value.trim(),
                travel: document.getElementById('profileTravel').value,
                canDrive: document.getElementById('profileCanDrive').value,
                
                // Fun
                foodStop: document.getElementById('profileFoodStop').value.trim(),
                snack: document.getElementById('profileSnack').value.trim(),
                
                updatedAt: new Date().toISOString()
            };
            
            saveProfileToStorage(profile);
            closeProfileModal();
            renderMyProfile();
            
            // Show confirmation
            alert('‚úÖ Profile saved!');
        }
        
        function renderMyProfile() {
            const container = document.getElementById('myProfileContent');
            const profile = getProfile();
            
            if (!profile || !profile.name) {
                container.innerHTML = '<p style="color: var(--topo-gray); font-size: 0.9rem;">No profile set up yet. Click Edit to create your touring profile!</p>';
                return;
            }
            
            const skillLabels = ['Beginner', 'Beginner-Int', 'Intermediate', 'Int-Advanced', 'Expert'];
            const paceLabels = { 'chill': '<1000 ft/hr (chill)', 'moderate': '~1000 ft/hr', 'fast': '>1000 ft/hr (fast)' };
            const availLabels = { 'weekends': 'Weekends', 'weekdays': 'Weekdays', 'both': 'Weekends & Weekdays' };
            const gearLabels = { 'ski': '‚õ∑Ô∏è Skis', 'splitboard': 'üèÇ Splitboard', 'snowboard': 'üèÇ Snowboard', 'both': '‚õ∑Ô∏èüèÇ Both' };
            const travelLabels = { 'local': 'Prefer local', 'regional': 'Regional trips OK', 'anywhere': 'Down to travel!' };
            const driveLabels = { 'yes-awd': '‚úÖ Yes (AWD/4WD)', 'yes-2wd': '‚úÖ Yes (2WD+chains)', 'sometimes': 'ü§∑ Sometimes', 'no': 'üöó Need a ride' };
            
            container.innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    <!-- Header with name -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 60px; height: 60px; background: var(--forest-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700;">
                            ${profile.name.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--forest-green);">${profile.name}</div>
                            ${profile.city ? `<div style="font-size: 0.9rem; color: var(--topo-gray);">üìç ${profile.city}</div>` : ''}
                        </div>
                    </div>
                    
                    ${profile.intro ? `<p style="font-style: italic; color: #555;">"${profile.intro}"</p>` : ''}
                    
                    <!-- Contact -->
                    ${(profile.phone || profile.social) ? `
                    <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; font-size: 0.85rem;">
                        ${profile.phone ? `<span>üìû ${profile.phone}</span>` : ''}
                        ${profile.social ? `<span>üì± ${profile.social}</span>` : ''}
                    </div>` : ''}
                    
                    <!-- Experience badges -->
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <span style="background: #e3f2fd; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">
                            üéø ${skillLabels[profile.skillLevel - 1] || 'Intermediate'}
                        </span>
                        ${profile.gear ? `<span style="background: #e3f2fd; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">${gearLabels[profile.gear] || profile.gear}</span>` : ''}
                        ${profile.pace ? `<span style="background: #e8f5e9; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">‚è±Ô∏è ${paceLabels[profile.pace] || profile.pace}</span>` : ''}
                        ${profile.availability ? `<span style="background: #e8f5e9; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">üìÖ ${availLabels[profile.availability] || profile.availability}</span>` : ''}
                        ${profile.canDrive ? `<span style="background: #f5f5f5; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">${driveLabels[profile.canDrive] || profile.canDrive}</span>` : ''}
                    </div>
                    
                    <!-- Details -->
                    ${profile.training ? `<div style="font-size: 0.85rem;"><strong>üéì Training:</strong> ${profile.training}</div>` : ''}
                    ${profile.experience ? `<div style="font-size: 0.85rem;"><strong>üìù Experience:</strong> ${profile.experience}</div>` : ''}
                    ${profile.tourTypes ? `<div style="font-size: 0.85rem;"><strong>üéØ Looking for:</strong> ${profile.tourTypes}</div>` : ''}
                    ${profile.favoriteAreas ? `<div style="font-size: 0.85rem;"><strong>‚ù§Ô∏è Favorite areas:</strong> ${profile.favoriteAreas}</div>` : ''}
                    ${profile.skiPass ? `<div style="font-size: 0.85rem;"><strong>üé´ Ski pass:</strong> ${profile.skiPass}</div>` : ''}
                    ${profile.travel ? `<div style="font-size: 0.85rem;"><strong>‚úàÔ∏è Travel:</strong> ${travelLabels[profile.travel] || profile.travel}</div>` : ''}
                    
                    <!-- Fun stuff -->
                    ${(profile.foodStop || profile.snack) ? `
                    <div style="background: #fff3e0; padding: 0.75rem; border-radius: 8px; font-size: 0.85rem;">
                        ${profile.foodStop ? `<div>üçï <strong>Post-tour food:</strong> ${profile.foodStop}</div>` : ''}
                        ${profile.snack ? `<div>üç´ <strong>Mountain snack:</strong> ${profile.snack}</div>` : ''}
                    </div>` : ''}
                </div>
            `;
        }
        
        // Open the tour log modal
        function openTourLogModal(tourName, tourZone) {
            currentLogTour = { name: tourName, zone: tourZone };
            
            document.getElementById('logTourName').textContent = tourName;
            
            // Basic info
            document.getElementById('logTourDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logTourGroupSize').value = '3';
            
            // Conditions
            document.getElementById('logAvyDanger').value = 'moderate';
            document.getElementById('logAvyProblem').value = 'none';
            document.getElementById('logAvyProblem2').value = 'none';
            
            // Snow conditions by time of day
            document.getElementById('logSnowAM').value = '';
            document.getElementById('logSnowMidday').value = '';
            document.getElementById('logSnowPM').value = '';
            
            // Weather by category
            document.getElementById('logWeatherPrecip').value = 'clear';
            document.getElementById('logWeatherWind').value = 'calm';
            document.getElementById('logWeatherVis').value = 'good';
            document.getElementById('logWeatherTemp').value = 'stable-cold';
            document.getElementById('logPrecipAmount').value = 'none';
            
            // Signs of instability - reset all (optional, may have none)
            document.getElementById('logSignRecent').checked = false;
            document.getElementById('logSignWhumpf').checked = false;
            document.getElementById('logSignCracking').checked = false;
            document.getElementById('logSignLoading').checked = false;
            document.getElementById('logSignCornice').checked = false;
            document.getElementById('logSignRollerballs').checked = false;
            document.getElementById('logSignWindDrift').checked = false;
            document.getElementById('logSignSluffs').checked = false;
            
            // Terrain
            document.getElementById('logTerrainMindset').value = 'moderate';
            document.getElementById('logStuckToPlan').value = 'yes';
            
            // Decision review
            document.getElementById('logExposure').value = '';
            document.getElementById('logLessons').value = '';
            
            // Overall
            document.getElementById('star3').checked = true;
            document.getElementById('logTourNotes').value = '';
            document.getElementById('logTourWouldRepeat').checked = true;
            
            document.getElementById('tourLogModal').classList.add('active');
        }
        
        // Close the tour log modal
        function closeTourLogModal() {
            document.getElementById('tourLogModal').classList.remove('active');
            currentLogTour = null;
        }
        
        // Save a tour log entry
        function saveTourLog() {
            if (!currentLogTour) return;
            
            // Basic info
            const date = document.getElementById('logTourDate').value;
            const groupSize = document.getElementById('logTourGroupSize').value;
            
            // Conditions (AIARE: Summarize Conditions)
            const avyDanger = document.getElementById('logAvyDanger').value;
            const avyProblem = document.getElementById('logAvyProblem').value;
            const avyProblem2 = document.getElementById('logAvyProblem2').value;
            
            // Snow conditions by time of day
            const snowConditions = {
                am: document.getElementById('logSnowAM').value,
                midday: document.getElementById('logSnowMidday').value,
                pm: document.getElementById('logSnowPM').value
            };
            
            // Weather by category
            const weather = {
                precip: document.getElementById('logWeatherPrecip').value,
                wind: document.getElementById('logWeatherWind').value,
                visibility: document.getElementById('logWeatherVis').value,
                temperature: document.getElementById('logWeatherTemp').value
            };
            
            const precipAmount = document.getElementById('logPrecipAmount').value;
            
            // Signs of instability (optional - may have none)
            const signsOfInstability = {
                recentAvalanches: document.getElementById('logSignRecent').checked,
                whumpfing: document.getElementById('logSignWhumpf').checked,
                shootingCracks: document.getElementById('logSignCracking').checked,
                heavyLoading: document.getElementById('logSignLoading').checked,
                corniceDevelopment: document.getElementById('logSignCornice').checked,
                rollerballs: document.getElementById('logSignRollerballs').checked,
                windDrifting: document.getElementById('logSignWindDrift').checked,
                sluffs: document.getElementById('logSignSluffs').checked
            };
            
            // Terrain management
            const terrainMindset = document.getElementById('logTerrainMindset').value;
            const stuckToPlan = document.getElementById('logStuckToPlan').value;
            
            // Decision review
            const exposure = document.getElementById('logExposure').value.trim();
            const lessons = document.getElementById('logLessons').value.trim();
            
            // Overall experience
            const rating = parseInt(document.querySelector('input[name="rating"]:checked').value);
            const notes = document.getElementById('logTourNotes').value.trim();
            const wouldRepeat = document.getElementById('logTourWouldRepeat').checked;
            
            const tourId = getTourId(currentLogTour.name);
            const logId = `${tourId}_${date}`;
            
            const logs = getTourLogs();
            logs[logId] = {
                tourName: currentLogTour.name,
                zone: currentLogTour.zone,
                date: date,
                groupSize: groupSize,
                // Conditions
                avyDanger: avyDanger,
                avyProblem: avyProblem,
                avyProblem2: avyProblem2,
                snowConditions: snowConditions,
                weather: weather,
                precipAmount: precipAmount,
                signsOfInstability: signsOfInstability,
                // Terrain
                terrainMindset: terrainMindset,
                stuckToPlan: stuckToPlan,
                // Decision review
                exposure: exposure,
                lessons: lessons,
                // Overall
                rating: rating,
                notes: notes,
                wouldRepeat: wouldRepeat,
                loggedAt: new Date().toISOString()
            };
            
            saveTourLogs(logs);
            closeTourLogModal();
            
            // Refresh tours to update the button state and recommendations
            loadTours();
            
            // Show confirmation
            showToast(`‚úÖ Tour debrief saved - ${rating} stars!`);
        }
        
        // Delete a tour log entry
        function deleteTourLog(logId) {
            if (!confirm('Delete this tour log?')) return;
            
            const logs = getTourLogs();
            delete logs[logId];
            saveTourLogs(logs);
            
            // Refresh the My Tours section
            renderMyTours();
            loadTours();
            
            showToast('üóëÔ∏è Tour log deleted');
        }
        
        // Simple toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 2rem;
                left: 50%;
                transform: translateX(-50%);
                background: var(--forest-green);
                color: white;
                padding: 1rem 2rem;
                border-radius: 8px;
                font-weight: 600;
                z-index: 2000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideUp 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
        
        // Render the My Tours section
        function renderMyTours() {
            const container = document.getElementById('myToursContent');
            if (!container) return;
            
            const logs = getTourLogs();
            const logEntries = Object.entries(logs)
                .map(([id, log]) => ({ id, ...log }))
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (logEntries.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--topo-gray);">
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No tours logged yet</p>
                        <p style="font-size: 0.9rem;">Complete a tour and debrief it using the AIARE framework!</p>
                    </div>
                `;
                return;
            }
            
            const dangerEmojis = {
                'low': 'üü¢',
                'moderate': 'üü°',
                'considerable': 'üü†',
                'high': 'üî¥',
                'extreme': '‚ö´'
            };
            
            const snowEmojis = {
                'powder': '‚ùÑÔ∏è',
                'packed-powder': 'üéø',
                'wind-buff': 'üí®',
                'wind-crust': 'üå¨Ô∏è',
                'sun-crust': '‚òÄÔ∏è',
                'rain-crust': 'üåßÔ∏è',
                'breakable-crust': 'üíî',
                'supportable-crust': '‚úì',
                'wet-powder': 'üíß',
                'corn': 'üåΩ',
                'moist': 'üí¶',
                'wet': 'üåä',
                'slush': 'ü•§',
                'sastrugi': '„Ä∞Ô∏è',
                'ice': 'üßä',
                'facets': '‚ùÖ',
                'surface-hoar': '‚ú®',
                'variable': 'üåÄ'
            };
            
            const terrainLabels = {
                'simple': 'üü¢ Simple',
                'moderate': 'üü° Moderate',
                'complex': 'üü† Complex'
            };
            
            container.innerHTML = logEntries.map(log => {
                // Count signs of instability
                const signs = log.signsOfInstability || {};
                const signCount = Object.values(signs).filter(v => v).length;
                
                // Build signs string
                const signsList = [];
                if (signs.recentAvalanches) signsList.push('Recent avy');
                if (signs.whumpfing) signsList.push('Whumpf');
                if (signs.shootingCracks) signsList.push('Cracks');
                if (signs.heavyLoading) signsList.push('Loading');
                if (signs.corniceDevelopment) signsList.push('Cornices');
                if (signs.rollerballs) signsList.push('Rollerballs');
                if (signs.windDrifting) signsList.push('Wind drift');
                if (signs.sluffs) signsList.push('Sluffs');
                
                // Build snow conditions string (handle both old and new format)
                let snowDisplay = '';
                if (typeof log.snowConditions === 'object') {
                    const snowParts = [];
                    if (log.snowConditions.am) snowParts.push(`AM: ${snowEmojis[log.snowConditions.am] || ''} ${log.snowConditions.am.replace(/-/g, ' ')}`);
                    if (log.snowConditions.midday) snowParts.push(`Mid: ${snowEmojis[log.snowConditions.midday] || ''} ${log.snowConditions.midday.replace(/-/g, ' ')}`);
                    if (log.snowConditions.pm) snowParts.push(`PM: ${snowEmojis[log.snowConditions.pm] || ''} ${log.snowConditions.pm.replace(/-/g, ' ')}`);
                    snowDisplay = snowParts.length > 0 ? snowParts.join(' ‚Üí ') : '';
                } else if (log.snowConditions) {
                    snowDisplay = `${snowEmojis[log.snowConditions] || '‚ùÑÔ∏è'} ${log.snowConditions.replace(/-/g, ' ')}`;
                }
                
                // Build avy problems string
                let avyProblemsDisplay = '';
                if (log.avyProblem && log.avyProblem !== 'none') {
                    avyProblemsDisplay = log.avyProblem.replace(/-/g, ' ');
                    if (log.avyProblem2 && log.avyProblem2 !== 'none') {
                        avyProblemsDisplay += ` + ${log.avyProblem2.replace(/-/g, ' ')}`;
                    }
                }
                
                return `
                <div class="logged-tour-card">
                    <div class="logged-tour-header">
                        <div>
                            <div class="logged-tour-name">${log.tourName}</div>
                            <div class="logged-tour-date">
                                ${new Date(log.date).toLocaleDateString('en-US', { 
                                    weekday: 'short', 
                                    month: 'short', 
                                    day: 'numeric',
                                    year: 'numeric'
                                })}
                                ‚Ä¢ ${log.groupSize === '1' ? 'Solo' : log.groupSize + ' people'}
                            </div>
                        </div>
                        <div>
                            <div class="logged-tour-stars">${'‚òÖ'.repeat(log.rating)}${'‚òÜ'.repeat(5 - log.rating)}</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.75rem 0; font-size: 0.8rem;">
                        ${log.avyDanger ? `<span style="background: #f5f5f5; padding: 0.25rem 0.5rem; border-radius: 4px;">${dangerEmojis[log.avyDanger] || ''} ${log.avyDanger}</span>` : ''}
                        ${avyProblemsDisplay ? `<span style="background: #e3f2fd; padding: 0.25rem 0.5rem; border-radius: 4px; color: #1565c0;">${avyProblemsDisplay}</span>` : ''}
                        ${log.terrainMindset ? `<span style="background: #f5f5f5; padding: 0.25rem 0.5rem; border-radius: 4px;">${terrainLabels[log.terrainMindset] || log.terrainMindset}</span>` : ''}
                        ${signCount > 0 ? `<span style="background: #fff3e0; padding: 0.25rem 0.5rem; border-radius: 4px; color: #e65100;">‚ö†Ô∏è ${signCount} sign${signCount > 1 ? 's' : ''}</span>` : ''}
                    </div>
                    
                    ${snowDisplay ? `<div style="font-size: 0.8rem; color: #555; margin-bottom: 0.5rem;">üéø ${snowDisplay}</div>` : ''}
                    
                    ${signsList.length > 0 ? `<div style="font-size: 0.8rem; color: #e65100; margin-bottom: 0.5rem;">‚ö†Ô∏è ${signsList.join(', ')}</div>` : ''}
                    
                    ${log.lessons ? `<div style="font-size: 0.85rem; color: #7b1fa2; margin-bottom: 0.5rem; padding: 0.5rem; background: #f3e5f5; border-radius: 4px;"><strong>Lesson:</strong> ${log.lessons}</div>` : ''}
                    
                    ${log.notes ? `<div class="logged-tour-notes">"${log.notes}"</div>` : ''}
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem;">
                        <span style="font-size: 0.8rem; color: ${log.wouldRepeat ? 'var(--forest-green)' : '#999'};">
                            ${log.wouldRepeat ? '‚úì Would repeat' : '‚úó Wouldn\'t repeat'}
                        </span>
                        <button class="btn btn-danger btn-small" onclick="deleteTourLog('${log.id}')">Delete</button>
                    </div>
                </div>
            `}).join('');
        }
        
        // Toggle My Tours section visibility
        function toggleMyTours() {
            const section = document.getElementById('myToursSection');
            const btn = document.getElementById('myToursToggleBtn');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                btn.innerHTML = 'üìñ Hide My Tours';
                renderMyTours();
            } else {
                section.style.display = 'none';
                btn.innerHTML = 'üìñ My Tours (' + Object.keys(getTourLogs()).length + ')';
            }
        }
        
        // ============================================
        // TOUR SEARCH FUNCTIONS
        // ============================================
        
        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                searchTours();
            }
        }
        
        function getAllTours() {
            // Collect all tours from all zones
            const allTours = [];
            for (const [zone, tours] of Object.entries(toursByZone)) {
                tours.forEach(tour => {
                    allTours.push({ ...tour, zone: zone });
                });
            }
            return allTours;
        }
        
        function searchTours() {
            const searchInput = document.getElementById('tourSearchInput').value.trim().toLowerCase();
            const zoneFilter = document.getElementById('tourSearchZone').value;
            const resultsContainer = document.getElementById('searchResults');
            
            if (!searchInput && zoneFilter === 'all') {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const allTours = getAllTours();
            
            // Filter tours
            const matchingTours = allTours.filter(tour => {
                const nameMatch = !searchInput || tour.name.toLowerCase().includes(searchInput);
                const zoneMatch = zoneFilter === 'all' || tour.location === zoneFilter || tour.zone === zoneFilter;
                return nameMatch && zoneMatch;
            });
            
            // Sort by name
            matchingTours.sort((a, b) => a.name.localeCompare(b.name));
            
            // Render results
            if (matchingTours.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 1rem; color: var(--topo-gray);">
                        <p>No tours found matching "${searchInput || 'your criteria'}"</p>
                        <p style="font-size: 0.85rem;">Try a different search term or zone.</p>
                    </div>
                `;
            } else {
                resultsContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span style="font-size: 0.9rem; color: var(--topo-gray);">
                            Found <strong>${matchingTours.length}</strong> tour${matchingTours.length !== 1 ? 's' : ''}
                        </span>
                        <button onclick="clearSearch()" style="background: none; border: none; color: var(--forest-green); cursor: pointer; font-size: 0.85rem;">
                            ‚úï Clear
                        </button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${matchingTours.map(tour => renderSearchResult(tour)).join('')}
                    </div>
                `;
            }
            
            resultsContainer.style.display = 'block';
        }
        
        function renderSearchResult(tour) {
            const hasCoords = tour.trailheadLat && tour.trailheadLon;
            const googleMapsUrl = hasCoords ? `https://www.google.com/maps/dir/?api=1&destination=${tour.trailheadLat},${tour.trailheadLon}` : null;
            const caltopoUrl = `https://caltopo.com/map.html#ll=${hasCoords ? tour.trailheadLat + ',' + tour.trailheadLon : '47.5,-121.5'}&z=14&b=mbt`;
            
            // Escape tour name for onclick
            const escapedName = tour.name.replace(/'/g, "\\'");
            const escapedZone = (tour.zone || tour.location || '').replace(/'/g, "\\'");
            
            // Check if logged
            const isLogged = isTourLogged(tour.name);
            const avgRating = getTourAverageRating(tour.name);
            const starsHtml = avgRating !== null 
                ? `<span style="color: #FFD700; margin-left: 0.5rem;">${'‚òÖ'.repeat(Math.round(avgRating))}${'‚òÜ'.repeat(5 - Math.round(avgRating))}</span>` 
                : '';
            
            return `
                <div style="background: var(--cream); border-radius: 8px; padding: 0.75rem; margin-bottom: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 0.5rem;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-weight: 600; color: var(--forest-green); font-size: 0.95rem;">
                                ${tour.name}${starsHtml}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--topo-gray); margin-top: 0.25rem;">
                                üìç ${tour.location} ‚Ä¢ ${tour.elevationGain.toLocaleString()} ft ‚Ä¢ ${tour.distance} mi
                            </div>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 0.25rem;">
                                ‚õ∞Ô∏è ${tour.terrain} ‚Ä¢ Max: ${tour.maxElevation.toLocaleString()} ft
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            ${hasCoords ? `<a href="${googleMapsUrl}" target="_blank" style="font-size: 0.8rem; color: var(--sky-blue); text-decoration: none;">Directions</a>` : ''}
                            <a href="${caltopoUrl}" target="_blank" style="font-size: 0.8rem; color: var(--forest-green); text-decoration: none;">CalTopo</a>
                            <button class="btn btn-small ${isLogged ? 'btn-secondary' : 'btn-primary'}" 
                                onclick="openTourLogModal('${escapedName}', '${escapedZone}')" 
                                style="padding: 0.35rem 0.6rem; font-size: 0.75rem;">
                                ${isLogged ? 'üìù Log Again' : 'üìù Log'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function clearSearch() {
            document.getElementById('tourSearchInput').value = '';
            document.getElementById('tourSearchZone').value = 'all';
            document.getElementById('searchResults').style.display = 'none';
        }

        function getZoneName(zoneId) {
            const zones = {
                'west-slopes-north': 'West Slopes North (Mt Baker)',
                'stevens-pass': 'Stevens Pass',
                'west-slopes-central': 'West Slopes Central',
                'snoqualmie-pass': 'Snoqualmie Pass',
                'west-slopes-south': 'West Slopes South (White Pass)',
                'east-slopes-north': 'East Slopes North',
                'east-slopes-central': 'East Slopes Central (Mission Ridge)',
                'east-slopes-south': 'East Slopes South',
                'olympics': 'Olympics',
                'mt-hood': 'Mt Hood'
            };
            return zones[zoneId] || zoneId;
        }

        window.addEventListener('load', () => {
            // Always start fresh
            localStorage.removeItem('skiTourConfig');
            
            // Reset config to defaults
            config.fitnessLevel = 7;
            config.downhillSkill = 5;
            config.touringSkill = 5;
            config.nwacZone = null;
            config.location = null;
            
            // Reset zone selector
            document.getElementById('nwacZone').value = '';
            
            // Show welcome message, hide dashboard
            document.getElementById('welcomeMessage').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            
            // Set up slider event listeners
            const fitnessSlider = document.getElementById('fitnessSlider');
            const downhillSlider = document.getElementById('downhillSlider');
            const touringSlider = document.getElementById('touringSlider');
            
            if (fitnessSlider) {
                fitnessSlider.value = 7;
                document.getElementById('fitnessStatus').textContent = `${fitnessLabels[7]} (7/10)`;
                
                fitnessSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    config.fitnessLevel = value;
                    document.getElementById('fitnessStatus').textContent = 
                        `${fitnessLabels[value]} (${value}/10)`;
                    
                    console.log('üí™ Fitness level changed to:', value, '- Recalculating recommendations...');
                    if (config.nwacZone) loadTours();
                });
            }
            
            if (downhillSlider) {
                downhillSlider.value = 5;
                document.getElementById('downhillStatus').textContent = `${skillLabels[5]} (5/10)`;
                
                downhillSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    config.downhillSkill = value;
                    document.getElementById('downhillStatus').textContent = 
                        `${skillLabels[value]} (${value}/10)`;
                    updateSkillDescription();
                    
                    console.log('‚õ∑Ô∏è Downhill skill changed to:', value, '- Recalculating recommendations...');
                    if (config.nwacZone) loadTours();
                });
            }
            
            if (touringSlider) {
                touringSlider.value = 5;
                document.getElementById('touringStatus').textContent = `${skillLabels[5]} (5/10)`;
                
                touringSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    config.touringSkill = value;
                    document.getElementById('touringStatus').textContent = 
                        `${skillLabels[value]} (${value}/10)`;
                    updateSkillDescription();
                    
                    console.log('üéø Touring skill changed to:', value, '- Recalculating recommendations...');
                    if (config.nwacZone) loadTours();
                });
            }
            
            console.log('‚úÖ App initialized - ready for zone selection');
        });
        
        function updateSkillDescription() {
            const downhill = config.downhillSkill;
            const touring = config.touringSkill;
            let description = 'üí° ';
            
            // Downhill description
            if (downhill <= 3) {
                description += 'Comfortable on groomed runs. ';
            } else if (downhill <= 5) {
                description += 'Can ski most resort terrain. ';
            } else if (downhill <= 7) {
                description += 'Confident in variable snow and steeper terrain. ';
            } else {
                description += 'Expert skiing ability, comfortable in any conditions. ';
            }
            
            // Touring description
            if (touring <= 3) {
                description += 'New to backcountry, learning basics.';
            } else if (touring <= 5) {
                description += 'Solid skinning technique, basic avalanche awareness.';
            } else if (touring <= 7) {
                description += 'Efficient touring, good route-finding and avy skills.';
            } else {
                description += 'Expert touring, glacier travel, complex terrain navigation.';
            }
            
            document.getElementById('skillDescription').innerHTML = description;
        }
    </script>
    
    <!-- Tour Log Modal - AIARE Field Guide Aligned -->
    <div id="tourLogModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>üìù Tour Debrief</h3>
                <button class="modal-close" onclick="closeTourLogModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="logTourName" style="font-size: 1.2rem; font-weight: 700; color: var(--forest-green); margin-bottom: 0.5rem;"></div>
                <p style="font-size: 0.8rem; color: var(--topo-gray); margin-bottom: 1rem;">Based on AIARE Field Guide debrief framework</p>
                
                <!-- Basic Info -->
                <div style="background: var(--cream); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">üìÖ Trip Details</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Date</label>
                            <input type="date" id="logTourDate" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Group Size</label>
                            <select id="logTourGroupSize">
                                <option value="1">Solo</option>
                                <option value="2">2 people</option>
                                <option value="3" selected>3 people (optimal)</option>
                                <option value="4">4 people</option>
                                <option value="5+">5+ people</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Conditions Summary (AIARE: Summarize Conditions) -->
                <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: #1565c0; margin-bottom: 0.75rem;">üèîÔ∏è Summarize Conditions</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Avalanche Danger (as observed)</label>
                        <select id="logAvyDanger">
                            <option value="low">üü¢ Low - Generally safe conditions</option>
                            <option value="moderate" selected>üü° Moderate - Heightened conditions on specific terrain</option>
                            <option value="considerable">üü† Considerable - Dangerous conditions, careful route selection</option>
                            <option value="high">üî¥ High - Very dangerous, travel in avalanche terrain not recommended</option>
                            <option value="extreme">‚ö´ Extreme - Avoid all avalanche terrain</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Primary Avalanche Problem</label>
                            <select id="logAvyProblem">
                                <option value="none">None observed</option>
                                <optgroup label="New Snow / Wind">
                                    <option value="dry-loose">Dry Loose (Sluff)</option>
                                    <option value="storm-slab">Storm Slab</option>
                                    <option value="wind-slab">Wind Slab</option>
                                    <option value="cornice">Cornice Fall</option>
                                </optgroup>
                                <optgroup label="Warming / Rain">
                                    <option value="wet-loose">Wet Loose</option>
                                    <option value="wet-slab">Wet Slab</option>
                                </optgroup>
                                <optgroup label="Persistent">
                                    <option value="persistent-slab">Persistent Slab</option>
                                    <option value="deep-slab">Deep Persistent Slab</option>
                                    <option value="glide">Glide</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 0.85rem;">Secondary Problem (optional)</label>
                            <select id="logAvyProblem2">
                                <option value="none">None</option>
                                <optgroup label="New Snow / Wind">
                                    <option value="dry-loose">Dry Loose (Sluff)</option>
                                    <option value="storm-slab">Storm Slab</option>
                                    <option value="wind-slab">Wind Slab</option>
                                    <option value="cornice">Cornice Fall</option>
                                </optgroup>
                                <optgroup label="Warming / Rain">
                                    <option value="wet-loose">Wet Loose</option>
                                    <option value="wet-slab">Wet Slab</option>
                                </optgroup>
                                <optgroup label="Persistent">
                                    <option value="persistent-slab">Persistent Slab</option>
                                    <option value="deep-slab">Deep Persistent Slab</option>
                                    <option value="glide">Glide</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Snow Surface by Time of Day -->
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Snow Surface Conditions (by time of day)</label>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem; align-items: center; margin-top: 0.5rem;">
                            <span style="font-size: 0.8rem; color: #555; font-weight: 500;">üåÖ AM:</span>
                            <select id="logSnowAM" style="font-size: 0.85rem;">
                                <option value="">-- Select --</option>
                                <optgroup label="Dry Snow">
                                    <option value="powder">‚ùÑÔ∏è Powder</option>
                                    <option value="packed-powder">üéø Packed Powder</option>
                                    <option value="wind-buff">üí® Wind Buff</option>
                                    <option value="wind-crust">üå¨Ô∏è Wind Crust</option>
                                    <option value="sun-crust">‚òÄÔ∏è Sun Crust</option>
                                    <option value="rain-crust">üåßÔ∏è Rain Crust</option>
                                    <option value="breakable-crust">üíî Breakable Crust</option>
                                    <option value="supportable-crust">‚úì Supportable Crust</option>
                                </optgroup>
                                <optgroup label="Wet Snow">
                                    <option value="wet-powder">üíß Wet Powder</option>
                                    <option value="corn">üåΩ Corn</option>
                                    <option value="moist">üí¶ Moist</option>
                                    <option value="wet">üåä Wet</option>
                                    <option value="slush">ü•§ Slush</option>
                                </optgroup>
                                <optgroup label="Challenging">
                                    <option value="sastrugi">„Ä∞Ô∏è Sastrugi</option>
                                    <option value="ice">üßä Ice</option>
                                    <option value="facets">‚ùÖ Surface Facets</option>
                                    <option value="surface-hoar">‚ú® Surface Hoar</option>
                                    <option value="variable">üåÄ Variable</option>
                                </optgroup>
                            </select>
                            
                            <span style="font-size: 0.8rem; color: #555; font-weight: 500;">‚òÄÔ∏è Midday:</span>
                            <select id="logSnowMidday" style="font-size: 0.85rem;">
                                <option value="">-- Select --</option>
                                <optgroup label="Dry Snow">
                                    <option value="powder">‚ùÑÔ∏è Powder</option>
                                    <option value="packed-powder">üéø Packed Powder</option>
                                    <option value="wind-buff">üí® Wind Buff</option>
                                    <option value="wind-crust">üå¨Ô∏è Wind Crust</option>
                                    <option value="sun-crust">‚òÄÔ∏è Sun Crust</option>
                                    <option value="rain-crust">üåßÔ∏è Rain Crust</option>
                                    <option value="breakable-crust">üíî Breakable Crust</option>
                                    <option value="supportable-crust">‚úì Supportable Crust</option>
                                </optgroup>
                                <optgroup label="Wet Snow">
                                    <option value="wet-powder">üíß Wet Powder</option>
                                    <option value="corn">üåΩ Corn</option>
                                    <option value="moist">üí¶ Moist</option>
                                    <option value="wet">üåä Wet</option>
                                    <option value="slush">ü•§ Slush</option>
                                </optgroup>
                                <optgroup label="Challenging">
                                    <option value="sastrugi">„Ä∞Ô∏è Sastrugi</option>
                                    <option value="ice">üßä Ice</option>
                                    <option value="facets">‚ùÖ Surface Facets</option>
                                    <option value="surface-hoar">‚ú® Surface Hoar</option>
                                    <option value="variable">üåÄ Variable</option>
                                </optgroup>
                            </select>
                            
                            <span style="font-size: 0.8rem; color: #555; font-weight: 500;">üåÜ PM:</span>
                            <select id="logSnowPM" style="font-size: 0.85rem;">
                                <option value="">-- Select --</option>
                                <optgroup label="Dry Snow">
                                    <option value="powder">‚ùÑÔ∏è Powder</option>
                                    <option value="packed-powder">üéø Packed Powder</option>
                                    <option value="wind-buff">üí® Wind Buff</option>
                                    <option value="wind-crust">üå¨Ô∏è Wind Crust</option>
                                    <option value="sun-crust">‚òÄÔ∏è Sun Crust</option>
                                    <option value="rain-crust">üåßÔ∏è Rain Crust</option>
                                    <option value="breakable-crust">üíî Breakable Crust</option>
                                    <option value="supportable-crust">‚úì Supportable Crust</option>
                                </optgroup>
                                <optgroup label="Wet Snow">
                                    <option value="wet-powder">üíß Wet Powder</option>
                                    <option value="corn">üåΩ Corn</option>
                                    <option value="moist">üí¶ Moist</option>
                                    <option value="wet">üåä Wet</option>
                                    <option value="slush">ü•§ Slush</option>
                                </optgroup>
                                <optgroup label="Challenging">
                                    <option value="sastrugi">„Ä∞Ô∏è Sastrugi</option>
                                    <option value="ice">üßä Ice</option>
                                    <option value="facets">‚ùÖ Surface Facets</option>
                                    <option value="surface-hoar">‚ú® Surface Hoar</option>
                                    <option value="variable">üåÄ Variable</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Weather - Multi-select by category -->
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Weather Conditions (select one from each category that applies)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem;">
                            <div>
                                <span style="font-size: 0.75rem; color: #555; font-weight: 600;">Sky/Precip:</span>
                                <select id="logWeatherPrecip" style="font-size: 0.85rem; width: 100%; margin-top: 0.25rem;">
                                    <option value="clear">‚òÄÔ∏è Clear / Sunny</option>
                                    <option value="partly-cloudy">‚õÖ Partly cloudy</option>
                                    <option value="cloudy">‚òÅÔ∏è Cloudy</option>
                                    <option value="light-snow">üå®Ô∏è Light snow</option>
                                    <option value="moderate-snow">‚ùÑÔ∏è Moderate snow</option>
                                    <option value="heavy-snow">üå®Ô∏è‚ùÑÔ∏è Heavy snow</option>
                                    <option value="rain-on-snow">üåßÔ∏è Rain on snow</option>
                                    <option value="graupel">‚ö™ Graupel</option>
                                </select>
                            </div>
                            <div>
                                <span style="font-size: 0.75rem; color: #555; font-weight: 600;">Wind:</span>
                                <select id="logWeatherWind" style="font-size: 0.85rem; width: 100%; margin-top: 0.25rem;">
                                    <option value="calm">üçÉ Calm (&lt;15 mph)</option>
                                    <option value="light-wind">üí® Light (15-25 mph)</option>
                                    <option value="moderate-wind">üí®üí® Moderate (25-35 mph)</option>
                                    <option value="strong-wind">üå™Ô∏è Strong (&gt;35 mph)</option>
                                </select>
                            </div>
                            <div>
                                <span style="font-size: 0.75rem; color: #555; font-weight: 600;">Visibility:</span>
                                <select id="logWeatherVis" style="font-size: 0.85rem; width: 100%; margin-top: 0.25rem;">
                                    <option value="good">üëÅÔ∏è Good</option>
                                    <option value="flat-light">üå´Ô∏è Flat light</option>
                                    <option value="fog">üåÅ Fog / Low clouds</option>
                                    <option value="whiteout">‚¨ú Whiteout</option>
                                </select>
                            </div>
                            <div>
                                <span style="font-size: 0.75rem; color: #555; font-weight: 600;">Temperature:</span>
                                <select id="logWeatherTemp" style="font-size: 0.85rem; width: 100%; margin-top: 0.25rem;">
                                    <option value="stable-cold">ü•∂ Stable cold</option>
                                    <option value="warming">üå°Ô∏è Warming trend</option>
                                    <option value="rapid-warming">üî• Rapid warming</option>
                                    <option value="cooling">‚ùÑÔ∏è Cooling trend</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Precipitation Amount (new snow in last 48 hrs)</label>
                        <select id="logPrecipAmount">
                            <option value="none" selected>None</option>
                            <option value="trace">Trace - &lt;2 inches</option>
                            <option value="light">Light - 2-6 inches</option>
                            <option value="moderate">Moderate - 6-12 inches</option>
                            <option value="heavy">Heavy - 12-24 inches</option>
                            <option value="very-heavy">Very Heavy - &gt;24 inches</option>
                        </select>
                    </div>
                </div>
                
                <!-- Signs of Instability (AIARE: Monitor Conditions) -->
                <div style="background: #fff3e0; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: #e65100; margin-bottom: 0.5rem;">‚ö†Ô∏è Signs of Instability Observed (if any)</div>
                    <p style="font-size: 0.75rem; color: #8d6e63; margin-bottom: 0.75rem;">Check any that were observed - leave unchecked if no signs of instability</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignRecent" style="width: auto;"> Recent avalanches
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignWhumpf" style="width: auto;"> Whumpfing
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignCracking" style="width: auto;"> Shooting cracks
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignLoading" style="width: auto;"> Heavy/rapid loading
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignCornice" style="width: auto;"> Cornice development
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignRollerballs" style="width: auto;"> Rollerballs/pinwheels
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignWindDrift" style="width: auto;"> Wind drifting
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logSignSluffs" style="width: auto;"> Sluffs/point releases
                        </label>
                    </div>
                </div>
                
                <!-- Terrain Mindset (AIARE: Plan to Manage Avalanche Terrain) -->
                <div style="background: #e8f5e9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">üó∫Ô∏è Terrain Management</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Terrain Mindset Used</label>
                        <select id="logTerrainMindset">
                            <option value="simple">üü¢ Simple - Avoided avalanche terrain, stayed on low angle/forested</option>
                            <option value="moderate" selected>üü° Moderate - Limited exposure, avoided obvious paths</option>
                            <option value="complex">üü† Complex - Stepped out cautiously in consequential terrain</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">Did you stick to your planned route?</label>
                        <select id="logStuckToPlan">
                            <option value="yes">‚úÖ Yes, followed the plan</option>
                            <option value="adjusted-safer">üîÑ Adjusted to safer terrain</option>
                            <option value="adjusted-more">‚ö†Ô∏è Went into more exposed terrain than planned</option>
                            <option value="turned-back">‚Ü©Ô∏è Turned back early</option>
                        </select>
                    </div>
                </div>
                
                <!-- Review Decisions (AIARE: Review Today's Decisions) -->
                <div style="background: #f3e5f5; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: #7b1fa2; margin-bottom: 0.75rem;">üß† Review Today's Decisions</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Where were you most exposed to avalanche risk?</label>
                        <textarea id="logExposure" placeholder="e.g., Crossing below the wind-loaded slope on the north face..." style="min-height: 60px;"></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 0.85rem;">What would you do differently next time?</label>
                        <textarea id="logLessons" placeholder="e.g., Start earlier to avoid afternoon warming, bring extra layer..." style="min-height: 60px;"></textarea>
                    </div>
                </div>
                
                <!-- Overall Rating -->
                <div style="background: var(--cream); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">‚≠ê Overall Experience</div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Tour Rating</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5"><label for="star5">‚òÖ</label>
                            <input type="radio" id="star4" name="rating" value="4"><label for="star4">‚òÖ</label>
                            <input type="radio" id="star3" name="rating" value="3" checked><label for="star3">‚òÖ</label>
                            <input type="radio" id="star2" name="rating" value="2"><label for="star2">‚òÖ</label>
                            <input type="radio" id="star1" name="rating" value="1"><label for="star1">‚òÖ</label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem;">Additional Notes</label>
                        <textarea id="logTourNotes" placeholder="Route beta, memorable moments, recommendations for others..." style="min-height: 70px;"></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="logTourWouldRepeat" checked style="width: auto;">
                            Would do this tour again in similar conditions
                        </label>
                    </div>
                </div>
            </div>
