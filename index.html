<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Tour Decision - PNW Backcountry</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --cream: #F5F1E8;
            --burnt-orange: #D6622C;
            --forest-green: #2C5530;
            --dark-green: #1A3320;
            --steel-blue: #5B7C99;
            --warning-red: #C14236;
            --snow-white: #FDFCFA;
            --topo-gray: #8A8478;
            --partner-purple: #6B5B95;
            --partner-purple-light: #E8E4F0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Archivo', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #E8DCC8 100%);
            color: var(--dark-green);
            min-height: 100vh;
            padding: 2rem;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        header {
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }

        h1 { color: var(--snow-white); font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 { margin: 0; color: var(--forest-green); }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body { padding: 1.5rem; }
        
        .form-group { margin-bottom: 1rem; }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-green);
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--forest-green);
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary { background: var(--forest-green); color: white; }
        .btn-primary:hover { background: var(--dark-green); }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #ccc; }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.85rem; }

        /* Partner Directory Styles */
        .partner-directory {
            background: linear-gradient(135deg, var(--partner-purple-light) 0%, #f0edf5 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(107, 91, 149, 0.2);
        }

        .partner-directory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .partner-directory-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--partner-purple);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .partner-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .partner-filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            min-width: 130px;
        }

        .partner-filter-group label {
            font-size: 0.7rem;
            color: var(--topo-gray);
            text-transform: uppercase;
            font-weight: 600;
        }

        .partner-filter-group select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
        }

        .partner-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 2px 8px rgba(107, 91, 149, 0.1);
            border-left: 4px solid var(--partner-purple);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .partner-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(107, 91, 149, 0.15);
        }

        .partner-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--partner-purple) 0%, #8B7BA8 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .partner-name { font-weight: 700; color: var(--dark-green); font-size: 1.1rem; }
        .partner-location { font-size: 0.85rem; color: var(--topo-gray); }

        .partner-badges { display: flex; flex-wrap: wrap; gap: 0.4rem; margin: 0.75rem 0; }

        .partner-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-skill { background: #e3f2fd; color: #1565c0; }
        .badge-availability { background: #e8f5e9; color: #2e7d32; }
        .badge-gear { background: #fff3e0; color: #e65100; }
        .badge-pace { background: #f3e5f5; color: #7b1fa2; }

        .partner-intro {
            font-size: 0.9rem;
            color: #555;
            font-style: italic;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .partner-contact {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
        }

        .partner-contact a {
            color: var(--partner-purple);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .partner-count {
            background: var(--partner-purple);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .no-partners { text-align: center; padding: 2rem; color: var(--topo-gray); }
        .no-partners-icon { font-size: 3rem; margin-bottom: 0.75rem; }

        /* Opt-in Section */
        .optin-section {
            background: linear-gradient(135deg, var(--partner-purple-light) 0%, #f0edf5 100%);
            border: 2px solid var(--partner-purple);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .optin-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .optin-icon { font-size: 1.5rem; }
        .optin-title { font-weight: 700; color: var(--partner-purple); font-size: 1rem; }

        .optin-description {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .optin-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            flex-shrink: 0;
        }

        .toggle-switch input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider { background-color: var(--partner-purple); }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(24px); }

        .toggle-label { font-weight: 600; color: var(--dark-green); font-size: 0.9rem; }

        .optin-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: #856404;
        }

        .optin-active {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
        }

        /* Auth Styles */
        .auth-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .btn-google {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            justify-content: center;
        }

        .btn-google:hover { background: #f5f5f5; }
        .btn-google img { width: 18px; height: 18px; }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            color: var(--topo-gray);
            font-size: 0.85rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #ddd;
        }

        .auth-divider span { padding: 0 1rem; }

        .sync-status { font-size: 0.75rem; color: var(--topo-gray); }
        .sync-status.synced { color: var(--forest-green); }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--snow-white);
            border-radius: 10px;
            padding: 1.75rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--cream);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--forest-green);
            text-transform: uppercase;
        }

        .date-banner {
            background: var(--burnt-orange);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .my-tours-toggle {
            background: var(--cream);
            border: 2px solid var(--forest-green);
            color: var(--forest-green);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .my-tours-toggle:hover {
            background: var(--forest-green);
            color: white;
        }

        .welcome-message {
            text-align: center;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, var(--warning-red) 0%, #FFB84D 50%, var(--forest-green) 100%);
            border-radius: 4px;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--dark-green);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
        }

        .footer {
            margin-top: 3rem;
            text-align: center;
            color: var(--topo-gray);
            font-size: 0.85rem;
            padding: 2rem;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
        }

        .footer a { color: var(--forest-green); text-decoration: none; font-weight: 600; }

        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 1.8rem; }
            .dashboard { grid-template-columns: 1fr; }
            .partner-filters { flex-direction: column; }
            .partner-filter-group { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Safety Banner -->
    <div style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: white; padding: 0.75rem 1rem; text-align: center; font-weight: 600; font-size: 0.95rem;">
        ‚ö†Ô∏è DECISION SUPPORT TOOL ONLY ‚Äî Always make your own informed choices in the backcountry.
    </div>
    
    <div class="container">
        <header>
            <h1>‚õ∑Ô∏è Ski Tour Decision Dashboard</h1>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; align-items: center; margin-top: 1rem;">
                <select id="nwacZone" onchange="onZoneChange()" style="flex: 1; min-width: 200px; padding: 0.75rem; font-size: 1rem; font-weight: 600; border: 2px solid var(--forest-green); border-radius: 8px; background: white; color: var(--forest-green);">
                    <option value="">Choose your zone...</option>
                    <optgroup label="Washington Cascades - West">
                        <option value="west-slopes-north">West Slopes North (Mt Baker)</option>
                        <option value="stevens-pass">Stevens Pass</option>
                        <option value="snoqualmie-pass">Snoqualmie Pass</option>
                        <option value="west-slopes-south">West Slopes South</option>
                    </optgroup>
                    <optgroup label="Washington Cascades - East">
                        <option value="east-slopes-north">East Slopes North</option>
                        <option value="east-slopes-central">East Slopes Central</option>
                    </optgroup>
                    <optgroup label="Other Areas">
                        <option value="olympics">Olympics</option>
                        <option value="mt-hood">Mt Hood</option>
                    </optgroup>
                </select>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label for="tourDate" style="font-size: 0.9rem; color: white; font-weight: 600;">üìÖ</label>
                    <input type="date" id="tourDate" onchange="onDateChange()" style="padding: 0.7rem 1rem; font-size: 1rem; border: 2px solid var(--forest-green); border-radius: 8px; background: white; color: var(--forest-green);">
                </div>
            </div>
        </header>

        <!-- Welcome Message -->
        <div id="welcomeMessage" class="welcome-message">
            <div style="background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #3d7a5a 100%); color: white; padding: 3rem 2rem;">
                <div style="font-size: 5rem; margin-bottom: 1rem;">üèîÔ∏è</div>
                <h2 style="font-size: 2.5rem; margin-bottom: 0.75rem; font-weight: 700; color: white;">PNW Ski Tours</h2>
                <p style="font-size: 1.25rem; color: rgba(255,255,255,0.95); max-width: 600px; margin: 0 auto;">Your backcountry ski tour planning companion for the Pacific Northwest</p>
            </div>
            
            <div style="background: #e8f5e9; padding: 2rem; text-align: center;">
                <p style="font-weight: 700; color: #1b5e20; margin-bottom: 0.5rem; font-size: 1.3rem;">üëÜ Get Started</p>
                <p style="font-size: 1.1rem; color: #2e7d32;">Select your zone from the dropdown above</p>
            </div>
            
            <div style="padding: 2.5rem 2rem; max-width: 1000px; margin: 0 auto;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.25rem;">
                    <div style="background: white; padding: 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center;">
                        <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">üèîÔ∏è</div>
                        <strong style="color: #1b5e20;">200+ Tours</strong>
                        <p style="font-size: 0.85rem; margin-top: 0.4rem; color: #444;">Across 10 NWAC zones</p>
                    </div>
                    <div style="background: white; padding: 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center;">
                        <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">üìä</div>
                        <strong style="color: #1b5e20;">Live Data</strong>
                        <p style="font-size: 0.85rem; margin-top: 0.4rem; color: #444;">Real-time conditions</p>
                    </div>
                    <div style="background: white; padding: 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center;">
                        <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">üìù</div>
                        <strong style="color: #1b5e20;">Tour Logging</strong>
                        <p style="font-size: 0.85rem; margin-top: 0.4rem; color: #444;">AIARE debrief framework</p>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--partner-purple-light) 0%, #f0edf5 100%); padding: 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(107,91,149,0.15); text-align: center; border: 2px solid var(--partner-purple);">
                        <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">ü§ù</div>
                        <strong style="color: var(--partner-purple);">Find Partners</strong>
                        <p style="font-size: 0.85rem; margin-top: 0.4rem; color: #444;">Connect with tourers</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Auth Section -->
            <div id="authSection" class="auth-container">
                <div id="authLoggedOut">
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--forest-green); margin-bottom: 0.5rem;">üîê Save Your Tours</h3>
                        <p style="font-size: 0.9rem; color: var(--topo-gray);">Sign in to sync tour logs and join the partner directory</p>
                    </div>
                    <button class="btn btn-google" onclick="signInWithGoogle()">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                        Sign in with Google
                    </button>
                    <div class="auth-divider"><span>or</span></div>
                    <div id="authError" style="display: none; background: #ffebee; color: #c62828; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;"></div>
                    <form id="authForm" onsubmit="handleEmailAuth(event)">
                        <input type="email" id="authEmail" placeholder="Email" required style="width: 100%; padding: 0.75rem; margin-bottom: 0.5rem; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <input type="password" id="authPassword" placeholder="Password" required minlength="6" style="width: 100%; padding: 0.75rem; margin-bottom: 0.5rem; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="confirmPasswordGroup" style="display: none;">
                            <input type="password" id="authConfirmPassword" placeholder="Confirm Password" style="width: 100%; padding: 0.75rem; margin-bottom: 0.5rem; border: 2px solid #e0e0e0; border-radius: 8px;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;" id="authSubmitBtn">Sign In</button>
                    </form>
                    <div style="text-align: center; margin-top: 0.75rem; font-size: 0.85rem; color: var(--topo-gray);">
                        <span id="authToggleText">Don't have an account?</span>
                        <a onclick="toggleAuthMode()" style="color: var(--forest-green); cursor: pointer; font-weight: 600;"><span id="authToggleLink">Sign Up</span></a>
                    </div>
                </div>
                <div id="authLoggedIn" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div id="userAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--forest-green); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">?</div>
                            <div>
                                <div id="userName" style="font-weight: 600; color: var(--forest-green);">User</div>
                                <div id="userEmail" style="font-size: 0.8rem; color: var(--topo-gray);">user@example.com</div>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                            <button class="btn btn-secondary btn-small" onclick="signOutUser()">Sign Out</button>
                            <div class="sync-status" id="syncStatus"><span>‚è≥</span> Checking...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Partner Directory Section -->
            <div class="partner-directory">
                <div class="partner-directory-header">
                    <div class="partner-directory-title">
                        <span>ü§ù</span>
                        <span>Find Touring Partners</span>
                    </div>
                    <div class="partner-count" id="partnerCount">0 tourers listed</div>
                </div>
                
                <p style="font-size: 0.9rem; color: #555; margin-bottom: 1rem;">
                    Connect with other backcountry skiers in the PNW. Filter by skill level, availability, and more.
                </p>
                
                <!-- Filters -->
                <div class="partner-filters">
                    <div class="partner-filter-group">
                        <label>Skill Level</label>
                        <select id="filterSkill" onchange="filterPartners()">
                            <option value="all">All Levels</option>
                            <option value="1">Beginner</option>
                            <option value="2">Beginner-Int</option>
                            <option value="3">Intermediate</option>
                            <option value="4">Int-Advanced</option>
                            <option value="5">Expert</option>
                        </select>
                    </div>
                    <div class="partner-filter-group">
                        <label>Availability</label>
                        <select id="filterAvailability" onchange="filterPartners()">
                            <option value="all">Any</option>
                            <option value="weekends">Weekends</option>
                            <option value="weekdays">Weekdays</option>
                            <option value="both">Flexible</option>
                        </select>
                    </div>
                    <div class="partner-filter-group">
                        <label>Gear Type</label>
                        <select id="filterGear" onchange="filterPartners()">
                            <option value="all">Any</option>
                            <option value="ski">Skis</option>
                            <option value="splitboard">Splitboard</option>
                            <option value="both">Either</option>
                        </select>
                    </div>
                    <div class="partner-filter-group">
                        <label>Pace</label>
                        <select id="filterPace" onchange="filterPartners()">
                            <option value="all">Any</option>
                            <option value="chill">Chill</option>
                            <option value="moderate">Moderate</option>
                            <option value="fast">Fast</option>
                        </select>
                    </div>
                    <div class="partner-filter-group">
                        <label>Can Drive</label>
                        <select id="filterDrive" onchange="filterPartners()">
                            <option value="all">Any</option>
                            <option value="yes">Yes</option>
                            <option value="no">Needs Ride</option>
                        </select>
                    </div>
                </div>
                
                <!-- Partner List -->
                <div id="partnerList">
                    <div class="no-partners">
                        <div class="no-partners-icon">üéø</div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No tourers listed yet</p>
                        <p style="font-size: 0.9rem;">Be the first! Sign in and opt-in to the directory in your profile.</p>
                    </div>
                </div>
            </div>
            
            <div class="date-banner" id="dateBanner">üìÖ Loading...</div>

            <div class="dashboard">
                <!-- Avalanche Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèîÔ∏è Avalanche Forecast</div>
                    </div>
                    <div id="avalancheContent" style="text-align: center; padding: 2rem; color: var(--topo-gray);">
                        Select a zone to view forecast
                    </div>
                </div>

                <!-- Weather Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">‚õÖ Weather</div>
                    </div>
                    <div id="weatherContent" style="text-align: center; padding: 2rem; color: var(--topo-gray);">
                        Select a zone to view weather
                    </div>
                </div>

                <!-- Profile Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ My Profile</div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.25rem;">
                        <div style="font-size: 2rem; width: 50px; text-align: center;">üí™</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                <span style="font-weight: 600; color: var(--forest-green); font-size: 0.9rem;">Today's Energy</span>
                                <span id="fitnessStatus" style="font-weight: 700; color: var(--forest-green); font-size: 0.95rem;">Strong (7/10)</span>
                            </div>
                            <input type="range" id="fitnessSlider" min="1" max="10" value="7" step="1">
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 1rem; padding-top: 1.25rem; border-top: 1px solid #eee;">
                        <div style="font-size: 2rem; width: 50px; text-align: center;">‚õ∑Ô∏è</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                <span style="font-weight: 600; color: var(--forest-green); font-size: 0.9rem;">Ski Skill</span>
                                <span id="skillStatus" style="font-weight: 700; color: var(--forest-green); font-size: 0.95rem;">Intermediate (5/10)</span>
                            </div>
                            <input type="range" id="skillSlider" min="1" max="10" value="5" step="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Profile Section -->
            <div style="margin-bottom: 1rem;">
                <button id="myProfileToggleBtn" class="my-tours-toggle" onclick="toggleMyProfile()" style="background: #e8f5e9;">
                    üë§ My Profile
                </button>
                <div id="myProfileSection" style="display: none; background: var(--cream); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0; color: var(--forest-green);">üë§ My Touring Profile</h4>
                        <button class="btn btn-secondary btn-small" onclick="openProfileModal()">‚úèÔ∏è Edit</button>
                    </div>
                    <div id="myProfileContent">
                        <p style="color: var(--topo-gray); font-size: 0.9rem;">No profile set up yet. Click Edit to create your touring profile!</p>
                    </div>
                </div>
            </div>

            <div id="toursContent" style="text-align: center; padding: 2rem; color: var(--topo-gray);">
                Tours will appear here after selecting a zone
            </div>

            <div class="footer">
                <p><strong>Data Sources:</strong> <a href="https://nwac.us/">NWAC</a> ‚Ä¢ <a href="https://avalanche.org/">Avalanche.org</a> ‚Ä¢ <a href="https://www.weather.gov/">NWS</a></p>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë§ Edit My Touring Profile</h3>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: left;">
                
                <!-- PARTNER DIRECTORY OPT-IN -->
                <div class="optin-section">
                    <div class="optin-header">
                        <span class="optin-icon">ü§ù</span>
                        <span class="optin-title">Partner Directory</span>
                    </div>
                    <div class="optin-description">
                        <strong>Want to find touring partners?</strong> Opt-in to be listed in the public directory where other tourers can discover you.
                    </div>
                    <div class="optin-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="profileDirectoryOptin" onchange="updateOptinStatus()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">List me in the Partner Directory</span>
                    </div>
                    <div id="optinWarning" class="optin-warning">
                        ‚ö†Ô∏è <strong>Privacy Note:</strong> Your name, city, intro, skill level, availability, gear type, pace, and contact info will be visible to other signed-in users.
                    </div>
                    <div id="optinActive" class="optin-warning optin-active" style="display: none;">
                        ‚úÖ <strong>You're listed!</strong> Other tourers can find you. Toggle off anytime to remove your listing.
                    </div>
                </div>
                
                <!-- Basic Info -->
                <div style="background: var(--cream); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">üìã Basic Info</div>
                    <div class="form-group">
                        <label>Name <span style="color: #999; font-weight: normal;">(visible in directory)</span></label>
                        <input type="text" id="profileName" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Phone <span style="color: #999; font-weight: normal;">(optional)</span></label>
                        <input type="tel" id="profilePhone" placeholder="(555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label>Social Media <span style="color: #999; font-weight: normal;">(optional)</span></label>
                        <input type="text" id="profileSocial" placeholder="@username">
                    </div>
                    <div class="form-group">
                        <label>Nearest City</label>
                        <input type="text" id="profileCity" placeholder="Seattle, WA">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Introduction</label>
                        <textarea id="profileIntro" rows="2" placeholder="A few words about yourself..."></textarea>
                    </div>
                </div>
                
                <!-- Experience -->
                <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: #1565c0; margin-bottom: 0.75rem;">üéø Experience</div>
                    
                    <div class="form-group">
                        <label>Skill Level</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <input type="range" id="profileSkillLevel" min="1" max="5" value="3" style="flex: 1;" oninput="updateProfileSkillLabel()">
                            <span id="profileSkillLabel" style="font-weight: 600; min-width: 100px;">Intermediate</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Avalanche Training</label>
                        <input type="text" id="profileTraining" placeholder="AIARE 1, AIARE 2, WFR, etc.">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Gear Type</label>
                        <select id="profileGear">
                            <option value="">-- Select --</option>
                            <option value="ski">Skis</option>
                            <option value="splitboard">Splitboard</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                </div>
                
                <!-- Preferences -->
                <div style="background: #e8f5e9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; color: var(--forest-green); margin-bottom: 0.75rem;">‚õ∞Ô∏è Preferences</div>
                    
                    <div class="form-group">
                        <label>Preferred Pace</label>
                        <select id="profilePace">
                            <option value="">-- Select --</option>
                            <option value="chill">&lt;1000 ft/hr - Chill</option>
                            <option value="moderate">~1000 ft/hr - Moderate</option>
                            <option value="fast">&gt;1000 ft/hr - Fast</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Availability</label>
                        <select id="profileAvailability">
                            <option value="">-- Select --</option>
                            <option value="weekends">Weekends only</option>
                            <option value="weekdays">Weekdays only</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Favorite Areas</label>
                        <input type="text" id="profileFavoriteAreas" placeholder="Crystal, Baker, Alpental...">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Can you drive?</label>
                        <select id="profileCanDrive">
                            <option value="">-- Select --</option>
                            <option value="yes-awd">Yes - AWD/4WD</option>
                            <option value="yes-2wd">Yes - 2WD with chains</option>
                            <option value="no">No - need a ride</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProfileModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfile()">üíæ Save Profile</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBdsvWuplxxg3DRbT-wUb4n-u4W1HU89wY",
            authDomain: "pnw-ski-tours.firebaseapp.com",
            projectId: "pnw-ski-tours",
            storageBucket: "pnw-ski-tours.firebasestorage.app",
            messagingSenderId: "127747659158",
            appId: "1:127747659158:web:b117223702d49617adf9b7"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null;
        let isAuthModeSignUp = false;
        let allPartners = [];
        
        // ============================================
        // AUTH FUNCTIONS
        // ============================================
        
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            updateAuthUI();
            
            if (user) {
                console.log('üë§ Signed in:', user.email);
                await syncProfile();
                await loadPartnerDirectory();
            } else {
                await loadPartnerDirectory();
            }
        });
        
        function updateAuthUI() {
            const loggedOutEl = document.getElementById('authLoggedOut');
            const loggedInEl = document.getElementById('authLoggedIn');
            
            if (currentUser) {
                loggedOutEl.style.display = 'none';
                loggedInEl.style.display = 'block';
                document.getElementById('userName').textContent = currentUser.displayName || 'Ski Enthusiast';
                document.getElementById('userEmail').textContent = currentUser.email;
                
                const avatarEl = document.getElementById('userAvatar');
                if (currentUser.photoURL) {
                    avatarEl.innerHTML = `<img src="${currentUser.photoURL}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                } else {
                    avatarEl.innerHTML = (currentUser.displayName || currentUser.email || '?')[0].toUpperCase();
                }
            } else {
                loggedOutEl.style.display = 'block';
                loggedInEl.style.display = 'none';
            }
        }
        
        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                showToast('‚úÖ Signed in!');
            } catch (error) {
                showAuthError(error.message);
            }
        }
        
        async function handleEmailAuth(event) {
            event.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            
            hideAuthError();
            
            if (isAuthModeSignUp && password !== confirmPassword) {
                showAuthError('Passwords do not match.');
                return;
            }
            
            try {
                if (isAuthModeSignUp) {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showToast('‚úÖ Account created!');
                } else {
                    await auth.signInWithEmailAndPassword(email, password);
                    showToast('‚úÖ Signed in!');
                }
            } catch (error) {
                let message = error.message;
                if (error.code === 'auth/user-not-found') message = 'No account found. Click Sign Up.';
                else if (error.code === 'auth/wrong-password') message = 'Incorrect password.';
                showAuthError(message);
            }
        }
        
        function toggleAuthMode() {
            isAuthModeSignUp = !isAuthModeSignUp;
            document.getElementById('authSubmitBtn').textContent = isAuthModeSignUp ? 'Sign Up' : 'Sign In';
            document.getElementById('authToggleText').textContent = isAuthModeSignUp ? 'Already have an account?' : "Don't have an account?";
            document.getElementById('authToggleLink').textContent = isAuthModeSignUp ? 'Sign In' : 'Sign Up';
            document.getElementById('confirmPasswordGroup').style.display = isAuthModeSignUp ? 'block' : 'none';
            hideAuthError();
        }
        
        async function signOutUser() {
            await auth.signOut();
            showToast('üëã Signed out');
        }
        
        function showAuthError(message) {
            const el = document.getElementById('authError');
            el.textContent = message;
            el.style.display = 'block';
        }
        
        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }
        
        function updateSyncStatus(status) {
            const el = document.getElementById('syncStatus');
            const statuses = {
                'syncing': '<span>‚è≥</span> Syncing...',
                'synced': '<span>‚úÖ</span> Synced',
                'error': '<span>‚ö†Ô∏è</span> Error'
            };
            el.innerHTML = statuses[status] || '<span>üì±</span> Local';
            el.className = status === 'synced' ? 'sync-status synced' : 'sync-status';
        }
        
        // ============================================
        // PARTNER DIRECTORY
        // ============================================
        
        async function loadPartnerDirectory() {
            try {
                const snapshot = await db.collection('partnerDirectory').get();
                allPartners = [];
                snapshot.forEach(doc => allPartners.push({ id: doc.id, ...doc.data() }));
                
                document.getElementById('partnerCount').textContent = `${allPartners.length} tourer${allPartners.length !== 1 ? 's' : ''} listed`;
                renderPartners(allPartners);
            } catch (error) {
                console.error('Error loading partners:', error);
            }
        }
        
        function filterPartners() {
            const skill = document.getElementById('filterSkill').value;
            const availability = document.getElementById('filterAvailability').value;
            const gear = document.getElementById('filterGear').value;
            const pace = document.getElementById('filterPace').value;
            const drive = document.getElementById('filterDrive').value;
            
            let filtered = allPartners;
            
            if (skill !== 'all') filtered = filtered.filter(p => p.skillLevel == skill);
            if (availability !== 'all') filtered = filtered.filter(p => p.availability === availability || p.availability === 'both');
            if (gear !== 'all') filtered = filtered.filter(p => p.gear === gear || p.gear === 'both');
            if (pace !== 'all') filtered = filtered.filter(p => p.pace === pace);
            if (drive !== 'all') {
                if (drive === 'yes') filtered = filtered.filter(p => p.canDrive && p.canDrive.startsWith('yes'));
                else filtered = filtered.filter(p => p.canDrive === 'no');
            }
            
            renderPartners(filtered);
        }
        
        function renderPartners(partners) {
            const container = document.getElementById('partnerList');
            
            if (partners.length === 0) {
                container.innerHTML = `
                    <div class="no-partners">
                        <div class="no-partners-icon">üîç</div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">No tourers match your filters</p>
                        <p style="font-size: 0.9rem;">Try adjusting your criteria</p>
                    </div>
                `;
                return;
            }
            
            const skillLabels = ['', 'Beginner', 'Beginner-Int', 'Intermediate', 'Int-Advanced', 'Expert'];
            const availLabels = { 'weekends': 'Weekends', 'weekdays': 'Weekdays', 'both': 'Flexible' };
            const gearLabels = { 'ski': '‚õ∑Ô∏è Skis', 'splitboard': 'üèÇ Split', 'both': '‚õ∑Ô∏èüèÇ Both' };
            const paceLabels = { 'chill': 'Chill', 'moderate': 'Moderate', 'fast': 'Fast' };
            const driveLabels = { 'yes-awd': 'üöó AWD', 'yes-2wd': 'üöó 2WD', 'no': 'üöå Needs ride' };
            
            container.innerHTML = partners.map(partner => `
                <div class="partner-card">
                    <div style="display: flex; align-items: flex-start;">
                        <div class="partner-avatar">${(partner.name || '?')[0].toUpperCase()}</div>
                        <div style="flex: 1;">
                            <div class="partner-name">${partner.name || 'Anonymous'}</div>
                            ${partner.city ? `<div class="partner-location">üìç ${partner.city}</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="partner-badges">
                        ${partner.skillLevel ? `<span class="partner-badge badge-skill">üéø ${skillLabels[partner.skillLevel]}</span>` : ''}
                        ${partner.availability ? `<span class="partner-badge badge-availability">üìÖ ${availLabels[partner.availability] || partner.availability}</span>` : ''}
                        ${partner.gear ? `<span class="partner-badge badge-gear">${gearLabels[partner.gear] || partner.gear}</span>` : ''}
                        ${partner.pace ? `<span class="partner-badge badge-pace">‚è±Ô∏è ${paceLabels[partner.pace] || partner.pace}</span>` : ''}
                        ${partner.canDrive ? `<span class="partner-badge" style="background: #f5f5f5; color: #555;">${driveLabels[partner.canDrive] || partner.canDrive}</span>` : ''}
                    </div>
                    
                    ${partner.intro ? `<div class="partner-intro">"${partner.intro}"</div>` : ''}
                    ${partner.training ? `<div style="font-size: 0.85rem; color: #666;"><strong>Training:</strong> ${partner.training}</div>` : ''}
                    ${partner.favoriteAreas ? `<div style="font-size: 0.85rem; color: #666;"><strong>Areas:</strong> ${partner.favoriteAreas}</div>` : ''}
                    
                    <div class="partner-contact">
                        ${partner.phone ? `<a href="tel:${partner.phone}">üìû ${partner.phone}</a>` : ''}
                        ${partner.social ? `<span>üì± ${partner.social}</span>` : ''}
                        ${!partner.phone && !partner.social ? '<span style="color: var(--topo-gray);">No contact info provided</span>' : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function updateOptinStatus() {
            const isOptedIn = document.getElementById('profileDirectoryOptin').checked;
            document.getElementById('optinWarning').style.display = isOptedIn ? 'none' : 'block';
            document.getElementById('optinActive').style.display = isOptedIn ? 'block' : 'none';
        }
        
        async function updatePartnerDirectory(profile, isOptedIn) {
            if (!currentUser) return;
            
            const ref = db.collection('partnerDirectory').doc(currentUser.uid);
            
            if (isOptedIn && profile.name) {
                await ref.set({
                    name: profile.name,
                    city: profile.city || '',
                    intro: profile.intro || '',
                    skillLevel: profile.skillLevel || 3,
                    availability: profile.availability || '',
                    gear: profile.gear || '',
                    pace: profile.pace || '',
                    canDrive: profile.canDrive || '',
                    training: profile.training || '',
                    favoriteAreas: profile.favoriteAreas || '',
                    phone: profile.phone || '',
                    social: profile.social || '',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } else {
                try { await ref.delete(); } catch (e) {}
            }
            
            await loadPartnerDirectory();
        }
        
        // ============================================
        // PROFILE FUNCTIONS
        // ============================================
        
        const PROFILE_KEY = 'pnw_ski_tours_profile';
        
        function getProfile() {
            try { return JSON.parse(localStorage.getItem(PROFILE_KEY)) || null; }
            catch (e) { return null; }
        }
        
        function saveProfileToStorage(profile) {
            localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
            if (currentUser) saveProfileToCloud(profile);
        }
        
        async function saveProfileToCloud(profile) {
            if (!currentUser) return;
            try {
                updateSyncStatus('syncing');
                await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').set({
                    ...profile,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                await updatePartnerDirectory(profile, profile.directoryOptin);
                updateSyncStatus('synced');
            } catch (e) {
                console.error('Save error:', e);
                updateSyncStatus('error');
            }
        }
        
        async function syncProfile() {
            if (!currentUser) return;
            try {
                const doc = await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').get();
                if (doc.exists) localStorage.setItem(PROFILE_KEY, JSON.stringify(doc.data()));
                renderMyProfile();
                updateSyncStatus('synced');
            } catch (e) {
                console.error('Sync error:', e);
            }
        }
        
        function openProfileModal() {
            const profile = getProfile() || {};
            
            document.getElementById('profileDirectoryOptin').checked = profile.directoryOptin || false;
            updateOptinStatus();
            
            document.getElementById('profileName').value = profile.name || '';
            document.getElementById('profilePhone').value = profile.phone || '';
            document.getElementById('profileSocial').value = profile.social || '';
            document.getElementById('profileCity').value = profile.city || '';
            document.getElementById('profileIntro').value = profile.intro || '';
            document.getElementById('profileSkillLevel').value = profile.skillLevel || 3;
            updateProfileSkillLabel();
            document.getElementById('profileTraining').value = profile.training || '';
            document.getElementById('profileGear').value = profile.gear || '';
            document.getElementById('profilePace').value = profile.pace || '';
            document.getElementById('profileAvailability').value = profile.availability || '';
            document.getElementById('profileFavoriteAreas').value = profile.favoriteAreas || '';
            document.getElementById('profileCanDrive').value = profile.canDrive || '';
            
            document.getElementById('profileModal').classList.add('active');
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }
        
        function updateProfileSkillLabel() {
            const labels = ['Beginner', 'Beginner-Int', 'Intermediate', 'Int-Advanced', 'Expert'];
            document.getElementById('profileSkillLabel').textContent = labels[document.getElementById('profileSkillLevel').value - 1];
        }
        
        async function saveProfile() {
            const profile = {
                directoryOptin: document.getElementById('profileDirectoryOptin').checked,
                name: document.getElementById('profileName').value.trim(),
                phone: document.getElementById('profilePhone').value.trim(),
                social: document.getElementById('profileSocial').value.trim(),
                city: document.getElementById('profileCity').value.trim(),
                intro: document.getElementById('profileIntro').value.trim(),
                skillLevel: parseInt(document.getElementById('profileSkillLevel').value),
                training: document.getElementById('profileTraining').value.trim(),
                gear: document.getElementById('profileGear').value,
                pace: document.getElementById('profilePace').value,
                availability: document.getElementById('profileAvailability').value,
                favoriteAreas: document.getElementById('profileFavoriteAreas').value.trim(),
                canDrive: document.getElementById('profileCanDrive').value,
                updatedAt: new Date().toISOString()
            };
            
            if (profile.directoryOptin && !profile.name) {
                alert('Please enter your name to be listed in the directory.');
                return;
            }
            
            saveProfileToStorage(profile);
            closeProfileModal();
            renderMyProfile();
            
            showToast(profile.directoryOptin ? '‚úÖ Profile saved & listed!' : '‚úÖ Profile saved!');
        }
        
        function renderMyProfile() {
            const container = document.getElementById('myProfileContent');
            const profile = getProfile();
            
            if (!profile || !profile.name) {
                container.innerHTML = '<p style="color: var(--topo-gray);">No profile yet. Click Edit to create one!</p>';
                return;
            }
            
            const skillLabels = ['Beginner', 'Beginner-Int', 'Intermediate', 'Int-Advanced', 'Expert'];
            const directoryBadge = profile.directoryOptin 
                ? '<span style="background: var(--partner-purple); color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-left: 0.5rem;">ü§ù Listed</span>'
                : '';
            
            container.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div style="width: 50px; height: 50px; background: var(--forest-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; font-weight: 700;">
                        ${profile.name.charAt(0).toUpperCase()}
                    </div>
                    <div>
                        <div style="font-weight: 700; color: var(--forest-green);">${profile.name}${directoryBadge}</div>
                        ${profile.city ? `<div style="font-size: 0.85rem; color: var(--topo-gray);">üìç ${profile.city}</div>` : ''}
                    </div>
                </div>
                ${profile.intro ? `<p style="font-style: italic; color: #555; font-size: 0.9rem;">"${profile.intro}"</p>` : ''}
                <div style="display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem;">
                    <span style="background: #e3f2fd; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.8rem;">üéø ${skillLabels[profile.skillLevel - 1]}</span>
                    ${profile.gear ? `<span style="background: #fff3e0; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.8rem;">${profile.gear === 'ski' ? '‚õ∑Ô∏è' : 'üèÇ'} ${profile.gear}</span>` : ''}
                    ${profile.availability ? `<span style="background: #e8f5e9; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.8rem;">üìÖ ${profile.availability}</span>` : ''}
                </div>
            `;
        }
        
        function toggleMyProfile() {
            const section = document.getElementById('myProfileSection');
            const btn = document.getElementById('myProfileToggleBtn');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                btn.innerHTML = 'üë§ Hide Profile';
                renderMyProfile();
            } else {
                section.style.display = 'none';
                btn.innerHTML = 'üë§ My Profile';
            }
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
                background: var(--forest-green); color: white; padding: 1rem 2rem;
                border-radius: 8px; font-weight: 600; z-index: 2000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
        
        // ============================================
        // ZONE & INITIALIZATION
        // ============================================
        
        let config = { nwacZone: null, tourDate: new Date().toISOString().split('T')[0] };
        
        const fitnessLabels = {
            1: 'Exhausted', 2: 'Very Tired', 3: 'Tired', 4: 'Below Average',
            5: 'Average', 6: 'Good', 7: 'Strong', 8: 'Very Strong',
            9: 'Excellent', 10: 'Peak Energy'
        };
        
        const skillLabels = {
            1: 'First Timer', 2: 'Novice', 3: 'Beginner', 4: 'Developing',
            5: 'Intermediate', 6: 'Competent', 7: 'Advanced', 8: 'Expert',
            9: 'Very Expert', 10: 'Professional'
        };
        
        function onZoneChange() {
            const zone = document.getElementById('nwacZone').value;
            
            if (!zone) {
                document.getElementById('welcomeMessage').style.display = 'block';
                document.getElementById('dashboardContent').style.display = 'none';
                return;
            }
            
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';
            config.nwacZone = zone;
            
            updateDate();
        }
        
        function onDateChange() {
            config.tourDate = document.getElementById('tourDate').value;
            updateDate();
        }
        
        function updateDate() {
            const date = new Date(config.tourDate + 'T12:00:00');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateBanner').textContent = 'üìÖ ' + date.toLocaleDateString('en-US', options);
        }
        
        window.addEventListener('load', () => {
            const datePicker = document.getElementById('tourDate');
            const today = new Date();
            datePicker.value = today.toISOString().split('T')[0];
            datePicker.min = today.toISOString().split('T')[0];
            datePicker.max = new Date(today.getTime() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            document.getElementById('nwacZone').value = '';
            document.getElementById('welcomeMessage').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            
            // Slider listeners
            const fitnessSlider = document.getElementById('fitnessSlider');
            const skillSlider = document.getElementById('skillSlider');
            
            fitnessSlider?.addEventListener('input', function() {
                document.getElementById('fitnessStatus').textContent = `${fitnessLabels[this.value]} (${this.value}/10)`;
            });
            
            skillSlider?.addEventListener('input', function() {
                document.getElementById('skillStatus').textContent = `${skillLabels[this.value]} (${this.value}/10)`;
            });
            
            loadPartnerDirectory();
            console.log('‚úÖ App initialized');
        });
    </script>
</body>
</html>
